This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitattributes
.gitignore
–ó–ê–ö–ê–ó–´.md
–ó–∞–ø—Ä–æ—Å—ã.md
–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–ö–õ–ê–î–´.md
–û–ø–∏—Å–∞–Ω–∏–µ.md
API_–ó–ê–ö–ê–ó–û–í.md
components.json
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
prisma.config.ts
prisma/migrations/20250201000000_add_warehouse_workers/migration.sql
prisma/migrations/20260127193536_add_custom_db_logic/migration.sql
prisma/migrations/20260131135239_add_variant_of_products/migration.sql
prisma/migrations/20260201000000_fix_stock_availability_trigger/migration.sql
prisma/migrations/migration_lock.toml
prisma/schema.prisma
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
src/app/[product]/page.tsx
src/app/admin/dashboard/analytics/components/CustomersTab.tsx
src/app/admin/dashboard/analytics/components/OverviewTab.tsx
src/app/admin/dashboard/analytics/components/ProductsTab.tsx
src/app/admin/dashboard/analytics/components/RevenueTab.tsx
src/app/admin/dashboard/analytics/page.tsx
src/app/admin/dashboard/categories/page.tsx
src/app/admin/dashboard/layout.tsx
src/app/admin/dashboard/orders/[id]/page.tsx
src/app/admin/dashboard/orders/page.tsx
src/app/admin/dashboard/page.tsx
src/app/admin/dashboard/products/page.tsx
src/app/admin/dashboard/users/page.tsx
src/app/admin/dashboard/warehouses/page.tsx
src/app/api/uploadthing/core.ts
src/app/api/uploadthing/route.ts
src/app/favicon.ico
src/app/globals.css
src/app/layout.tsx
src/app/orders/[id]/page.tsx
src/app/orders/page.tsx
src/app/page.tsx
src/components/AddCategoryButton.tsx
src/components/AddProductButton.tsx
src/components/AddUserButton.tsx
src/components/AddWarehouseButton.tsx
src/components/AdminCreateOrderButton.tsx
src/components/AppSidebar.tsx
src/components/CancelOrderButton.tsx
src/components/CategorySocketPicker.tsx
src/components/charts/ChartComponents.tsx
src/components/charts/DataTable.tsx
src/components/CreateOrderButton.tsx
src/components/DeleteCategoryButton.tsx
src/components/DeleteProductButton.tsx
src/components/DeleteUserButton.tsx
src/components/DeleteWarehouseButton.tsx
src/components/ManageWarehouseWorkersButton.tsx
src/components/RealtimeRefresher.tsx
src/components/theme-provider.tsx
src/components/theme-toggle.tsx
src/components/ToggleProductStatusButton.tsx
src/components/ui/alert-dialog.tsx
src/components/ui/alert.tsx
src/components/ui/avatar.tsx
src/components/ui/badge.tsx
src/components/ui/button.tsx
src/components/ui/card.tsx
src/components/ui/dialog.tsx
src/components/ui/dropdown-menu.tsx
src/components/ui/input.tsx
src/components/ui/label.tsx
src/components/ui/select.tsx
src/components/ui/separator.tsx
src/components/ui/sheet.tsx
src/components/ui/sidebar.tsx
src/components/ui/skeleton.tsx
src/components/ui/table.tsx
src/components/ui/tabs.tsx
src/components/ui/textarea.tsx
src/components/ui/tooltip.tsx
src/components/UpdateOrderStatusButton.tsx
src/hooks/use-mobile.ts
src/hooks/use-refresh-on-event.ts
src/lib/date-utils.ts
src/lib/links.ts
src/lib/prisma.ts
src/lib/utils.ts
src/pages/api/socket.ts
src/providers/socket-provider.tsx
src/server-actions/analytics.action.ts
src/server-actions/categories.action.ts
src/server-actions/orders.action.ts
src/server-actions/products.action.ts
src/server-actions/users.action.ts
src/server-actions/warehouses.action.ts
src/services/analytics.service.ts
src/services/categories.service.ts
src/services/orders.service.ts
src/services/prosuct.service.ts
src/services/users.service.ts
src/services/warehouses.service.ts
src/utils/uploadthing.ts
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="–ó–ê–ö–ê–ó–´.md">
# üì¶ –°–∏—Å—Ç–µ–º–∞ –ó–∞–∫–∞–∑–æ–≤

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –∫–æ—Ä–∑–∏–Ω–æ–π –ø–æ–∫—É–ø–æ–∫.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤**

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ä–æ–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏—è
- –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤**

- **PENDING** (–û–∂–∏–¥–∞–Ω–∏–µ)
- **PROCESSING** (–í –æ–±—Ä–∞–±–æ—Ç–∫–µ)
- **SHIPPED** (–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **DELIVERED** (–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
- **CANCELED** (–û—Ç–º–µ–Ω–µ–Ω–æ)

–°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å.

### 3. **–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤, –≤—ã—Ä—É—á–∫–∞, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

### 4. **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ (—Ç–æ–≤–∞—Ä—ã, –∞–¥—Ä–µ—Å, —Å—É–º–º–∞)
- –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤ (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å PENDING –∏–ª–∏ PROCESSING)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ orders.service.ts           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
‚îú‚îÄ‚îÄ server-actions/
‚îÇ   ‚îî‚îÄ‚îÄ orders.action.ts             # Server Actions –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∑–∞–∫–∞–∑–∞–º–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ UpdateOrderStatusButton.tsx   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ CancelOrderButton.tsx         # –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îî‚îÄ‚îÄ CreateOrderButton.tsx         # –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ date-utils.ts                # –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ admin/dashboard/orders/
    ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–∞–¥–º–∏–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ [id]/page.tsx            # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–∞–¥–º–∏–Ω)
    ‚îî‚îÄ‚îÄ orders/
        ‚îú‚îÄ‚îÄ page.tsx                 # –ú–æ–∏ –∑–∞–∫–∞–∑—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        ‚îî‚îÄ‚îÄ [id]/page.tsx            # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```typescript
import { createOrderAction } from '@/server-actions/orders.action'

// –í Client Component
const result = await createOrderAction(
	userId,
	addressId,
	paymentMethodId,
	promocodeCode,
)

if (result.success) {
	// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–∞
	window.location.href = `/orders/${result.orderId}`
}
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

```typescript
import { UpdateOrderStatusButton } from '@/components/UpdateOrderStatusButton'

<UpdateOrderStatusButton
  orderId={order.id}
  currentStatus={order.status}
/>
```

### 3. –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

```typescript
import { CancelOrderButton } from '@/components/CancelOrderButton'

<CancelOrderButton
  orderId={order.id}
  canCancel={order.status === 'PENDING'}
/>
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

```typescript
import { orderService } from '@/services/orders.service'

// –í—Å–µ –∑–∞–∫–∞–∑—ã (–∞–¥–º–∏–Ω)
const orders = await orderService.getAll()

// –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userOrders = await orderService.getByUserId(userId)

// –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
const order = await orderService.getById(orderId)
```

## üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ë–î —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏:

### –§—É–Ω–∫—Ü–∏–∏:

- `get_cart_total()` - –†–∞—Å—á–µ—Ç —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
- `get_full_address()` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- `is_user_vip()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ VIP —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_promo_active()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `get_total_stock()` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
- `format_price()` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
- `estimate_delivery_days()` - –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### –ü—Ä–æ—Ü–µ–¥—É—Ä—ã:

- `create_order_from_cart()` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- `cancel_stale_orders()` - –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

### –¢—Ä–∏–≥–≥–µ—Ä—ã:

- `trg_check_promo` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞
- `trg_recalc_order` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `trg_user_spending` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ
- `trg_stock_availability` - –°–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –≤–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ (GDPR)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ total_spent –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ
- ‚úÖ –ó–∞–ø—Ä–µ—Ç –Ω–∞ –æ—Ç–º–µ–Ω—É –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö/–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:

1. –ë–µ—Ä—É—Ç—Å—è —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞—é—Ç—Å—è orderItems —Å —Ç–µ–∫—É—â–∏–º–∏ —Ü–µ–Ω–∞–º–∏
3. –ö–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `revalidatePath`

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **–¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤** - —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- **–ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤** - –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è** - —Å –≤—ã–±–æ—Ä–æ–º –∞–¥—Ä–µ—Å–∞ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä** - —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

- –î–∞—Ç–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä—É—Å—Å–∫—É—é –ª–æ–∫–∞–ª—å
- –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –∏ –≤–∞–ª—é—Ç—ã (BYN)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `basePrice` —Ç–æ–≤–∞—Ä–∞ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ –≤ –±—É–¥—É—â–µ–º, —Ü–µ–Ω—ã –≤ —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–∞–∑–∞—Ö –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏
- `address_id` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤ `delivery_city` –∏ `delivery_street`
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ userId)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `order.service.ts` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

- –£—Å–ª–æ–≤–∏—è –¥–ª—è VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–∫—É—â–∏–π –ø–æ—Ä–æ–≥: 1000 BYN)
- –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `estimate_delivery_days`
- –ü–µ—Ä–∏–æ–¥ –æ—Ç–º–µ–Ω—ã –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (—Ç–µ–∫—É—â–∏–π: 3 –¥–Ω—è)
</file>

<file path="–ó–∞–ø—Ä–æ—Å—ã.md">
–í–∞–∂–Ω–æ: –≠—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç JOIN, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã –∏ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –æ—á–µ–Ω—å —Ü–µ–Ω–∏—Ç—Å—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏.

–¢–æ–ø-5 —Å–∞–º—ã—Ö –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤:

SQL

SELECT c.name, SUM(oi.price_at_purchase \* oi.quantity) as revenue
FROM categories c
JOIN products p ON c.id = p.category_id
JOIN order_items oi ON p.id = oi.product_id
GROUP BY c.name ORDER BY revenue DESC LIMIT 5;
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ—Ç—Ä–∞—Ç–∏–≤—à–∏–µ –±–æ–ª—å—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞:

SQL

SELECT first_name, email, total_spent FROM users
WHERE total_spent > (SELECT AVG(total_price) FROM orders);
–¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏ —Ä–∞–∑—É –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏ (–ø–æ–∏—Å–∫ –Ω–µ–ª–∏–∫–≤–∏–¥–∞):

SQL

SELECT name FROM products p
LEFT JOIN order_items oi ON p.id = oi.product_id
WHERE oi.id IS NULL;
–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

SQL

SELECT c.name, ROUND(AVG(p.average_rating), 2) as avg_cat_rating
FROM categories c
JOIN products p ON c.id = p.category_id
GROUP BY c.name;
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º:

SQL

SELECT delivery_city, COUNT(\*) as order_count FROM orders
GROUP BY delivery_city ORDER BY order_count DESC;
–î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º:

SQL

SELECT DATE_TRUNC('month', created_at) as month, COUNT(\*) as new_users
FROM users GROUP BY month ORDER BY month;
–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º (–º–µ–Ω—å—à–µ 5 —à—Ç —Å—É–º–º–∞—Ä–Ω–æ):

SQL

SELECT p.name, SUM(s.quantity) as total_qty
FROM products p JOIN stocks s ON p.id = s.product_id
GROUP BY p.name HAVING SUM(s.quantity) < 5;
–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã —É VIP-–∫–ª–∏–µ–Ω—Ç–æ–≤:

SQL

SELECT pm.type, COUNT(\*) FROM payment_methods pm
JOIN orders o ON pm.id = o.payment_method_id
WHERE o.user_id IN (SELECT id FROM users WHERE total_spent > 1000)
GROUP BY pm.type;
–ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –≤ –∑–∞–∫–∞–∑–∞—Ö:

SQL

SELECT
ROUND(COUNT(promocode_id) _ 100.0 / COUNT(_), 2) as promo_usage_percent
FROM orders;
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ—Å—Ç–∞–≤–∏–≤—à–∏–µ –±–æ–ª–µ–µ 3 –æ—Ç–∑—ã–≤–æ–≤:

SQL

SELECT u.email, COUNT(r.id) as review_count
FROM users u JOIN reviews r ON u.id = r.user_id
GROUP BY u.email HAVING COUNT(r.id) > 3;
–°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–∫–ª–∞–¥–µ:

SQL

SELECT w.name, SUM(s.quantity \* p.price) as warehouse_value
FROM warehouses w
JOIN stocks s ON w.id = s.warehouse_id
JOIN products p ON s.product_id = p.id
GROUP BY w.name;
–í—ã—Ä—É—á–∫–∞ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º (LAG):

SQL

SELECT
DATE_TRUNC('month', created_at) as month,
SUM(total_price) as revenue,
LAG(SUM(total_price)) OVER (ORDER BY DATE_TRUNC('month', created_at)) as prev_revenue
FROM orders GROUP BY 1;
–¢–æ–ø-3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–û–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è):

SQL

SELECT name, price, category_id FROM (
SELECT name, price, category_id,
RANK() OVER (PARTITION BY category_id ORDER BY price DESC) as r
FROM products
) t WHERE r <= 3;
–õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é:

SQL

SELECT action, details, created_at FROM audit_logs
WHERE user_id = 1 AND created_at > NOW() - INTERVAL '7 days';
–ü–æ–∏—Å–∫ ¬´–±—Ä–æ—à–µ–Ω–Ω—ã—Ö¬ª –∫–æ—Ä–∑–∏–Ω (–µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã, –Ω–æ –Ω–µ—Ç –∑–∞–∫–∞–∑–∞ –±–æ–ª–µ–µ –º–µ—Å—è—Ü–∞):

SQL

SELECT u.email FROM users u
JOIN carts c ON u.id = c.user_id
JOIN cart_items ci ON c.id = ci.cart_id
LEFT JOIN orders o ON u.id = o.user_id AND o.created_at > c.updated_at
WHERE o.id IS NULL;
</file>

<file path="–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–ö–õ–ê–î–´.md">
# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫–ª–∞–¥–æ–≤

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–≤—è–∑—å many-to-many –º–µ–∂–¥—É User –∏ Warehouse —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É WarehouseWorker
2. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω —Å–µ—Ä–≤–∏—Å warehouses.service.ts –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
3. ‚úÖ –°–æ–∑–¥–∞–Ω—ã server actions –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–∞–º–∏ –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–∞–º–∏:
   - AddWarehouseButton - —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–æ–≤
   - DeleteWarehouseButton - —É–¥–∞–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–≤
   - ManageWarehouseWorkersButton - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ —Å–∫–ª–∞–¥–∞
5. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–ª–∞–¥–æ–≤ `/admin/dashboard/warehouses`
6. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–°–∫–ª–∞–¥—ã" —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–∫–ª–∞–¥–∞—Ö, –≥–¥–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
npx prisma migrate deploy
```

–ò–ª–∏ –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ dev —Ä–µ–∂–∏–º:

```bash
npx prisma migrate dev
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `warehouse_workers` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### 2. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma –∫–ª–∏–µ–Ω—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma –∫–ª–∏–µ–Ω—Ç:

```bash
npx prisma generate
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∫–ª–∞–¥–æ–≤: `/admin/dashboard/warehouses`
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–∫–ª–∞–¥
3. –î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Ä–æ–ª—å—é `WAREHOUSE_WORKER` –∫ —Å–∫–ª–∞–¥—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–æ–≤ - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–æ–ª–æ–Ω–∫–∞ "–°–∫–ª–∞–¥—ã"

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `WAREHOUSE_WORKER` –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∫–ª–∞–¥–∞–º–∏
- –ù–∞ –∫–∞–∂–¥–æ–º —Å–∫–ª–∞–¥–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–∫–ª–∞–¥–∞ –≤—Å–µ —Å–≤—è–∑–∏ —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (CASCADE)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ –µ–≥–æ —Å–≤—è–∑–∏ —Å–æ —Å–∫–ª–∞–¥–∞–º–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (CASCADE)
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–ª–∞–¥–æ–≤, –≥–¥–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä, –∏ –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```
User (1) ‚îÄ‚îÄ< WarehouseWorker >‚îÄ‚îÄ (1) Warehouse
```

- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∫–ª–∞–¥–∞–º–∏
- –û–¥–∏–Ω —Å–∫–ª–∞–¥ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –°–≤—è–∑—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `warehouse_workers`

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `src/app/admin/dashboard/warehouses/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–ª–∞–¥–æ–≤
- `src/components/AddWarehouseButton.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫–ª–∞–¥–æ–≤
- `src/components/DeleteWarehouseButton.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–≤
- `src/components/ManageWarehouseWorkersButton.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
- `src/server-actions/warehouses.action.ts` - server actions –¥–ª—è —Å–∫–ª–∞–¥–æ–≤
- `prisma/migrations/20250201000000_add_warehouse_workers/migration.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `prisma/schema.prisma` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å WarehouseWorker –∏ —Å–≤—è–∑–∏
- `src/services/warehouses.service.ts` - —Ä–∞—Å—à–∏—Ä–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `src/app/admin/dashboard/products/page.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–°–∫–ª–∞–¥—ã"
</file>

<file path="–û–ø–∏—Å–∞–Ω–∏–µ.md">
## 1. –û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞ —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª—å—é**, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –Ω–∞ **Next.js (App Router, –≤–µ—Ä—Å–∏—è 16.1.5) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º React 19**, TypeScript –∏ **PostgreSQL** –≤ —Å–≤—è–∑–∫–µ —Å **Prisma ORM**. –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç —Å–¥–µ–ª–∞–Ω –Ω–∞:

- **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∏ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π).
- **–°–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç –∏ –∑–∞–ø–∞—Å—ã** (—Ç–æ–≤–∞—Ä–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º, –º–æ–¥–µ–ª—å `Stock` –∏ `Warehouse`).
- **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** (–º–æ–¥–µ–ª–∏ `Order`, `OrderItem`, `Promocode`, `Review`, `AuditLog` –∏ –Ω–∞–±–æ—Ä —Å–ª–æ–∂–Ω—ã—Ö SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ `–ó–∞–ø—Ä–æ—Å—ã.md`).
- **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (`User` —Å —Ä–æ–ª—è–º–∏ `ADMIN`, `USER`, `ANALYTICS`, `WAREHOUSE_WORKER`).
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å** (`/admin/dashboard/...`) —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Ç–æ–≤–∞—Ä–æ–≤.
- **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ WebSocket (Socket.IO)** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü (–ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö `refresh` –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö —á–µ—Ä–µ–∑ —Ö—É–∫ `useRefreshOnEvent`).
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ UploadThing** (–∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π).

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Å—Ç–∏–ª–µ **shadcn/ui** –Ω–∞ –±–∞–∑–µ **Radix UI** –∏ Tailwind CSS, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **—Å–≤–µ—Ç–ª–æ–π/—Ç—ë–º–Ω–æ–π —Ç–µ–º—ã** (—á–µ—Ä–µ–∑ `next-themes` –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `ThemeProvider`, `ModeToggle`). –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`src/app/page.tsx`) –ø–æ–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º –≤–∏–¥–µ (—à–∞–±–ª–æ–Ω Next.js), –∞ –≤—Å—è –ø—Ä–∏–∫–ª–∞–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π —á–∞—Å—Ç–∏ –∏ —Å–ª–æ–µ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏:

- **–í–µ–±‚Äë—Å–ª–æ–π (Next.js App Router)**: —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `src/app` (`admin/dashboard/...`, `[product]/page.tsx` –∏ —Ç.–¥.).
- **–°–ª–æ–π —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —ç–∫—à–µ–Ω–æ–≤ (Server Actions)**: —Ñ–∞–π–ª—ã –≤ `src/server-actions` (`categories.action.ts`, `products.action.ts`) –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞ —á–µ—Ä–µ–∑ `revalidatePath`.
- **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π**: —Ñ–∞–π–ª—ã –≤ `src/services` (`categories.service.ts`, `prosuct.service.ts`) —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫—É –∏ —Ä–∞–±–æ—Ç—É —Å Prisma.
- **–°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º**: `prisma/schema.prisma` –∏ `src/lib/prisma.ts` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π Prisma –∏ –∞–¥–∞–ø—Ç–µ—Ä–æ–º `@prisma/adapter-pg`.
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–π**: —Å–æ–∫–µ—Ç—ã (`src/pages/api/socket.ts`, `src/providers/socket-provider.tsx`, —Ö—É–∫–∏ `use-refresh-on-event`, `RealtimeRefresher`, `CategorySocketPicker`) –∏ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (`src/app/api/uploadthing/*`, `src/utils/uploadthing.ts`).
- **UI‚Äë—Å–ª–æ–π**: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `src/components` –∏ `src/components/ui` (sidebar, —Ç–∞–±–ª–∏—Ü—ã, –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, —Ñ–æ—Ä–º—ã, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –∏ —Ç.–ø.).

–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ **—É—á–µ–±–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ –∫—É—Ä—Å—É –ë–î/—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**, —á—Ç–æ –≤–∏–¥–Ω–æ –ø–æ –Ω–∞–ª–∏—á–∏—é —Ñ–∞–π–ª–∞ `–ó–∞–ø—Ä–æ—Å—ã.md` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Å–ª–æ–∂–Ω—ã—Ö SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ (JOIN, –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã), –∞ —Ç–∞–∫–∂–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`"–í–æ–ª—à–µ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω (–ö–£–†–°–û–í–û–ô)"`).

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 2.1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫

- **Next.js 16.1.5** (App Router, –ø–∞–ø–∫–∞ `src/app`).
- **React 19.2.3**.
- **TypeScript** (`tsconfig.json` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Ç–∏–ø—ã `@types/react`, `@types/node`).
- **Tailwind CSS v4** –∏ `@tailwindcss/postcss` –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏.
- **Radix UI** –∏ –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ **shadcn/ui** (–ø–∞–ø–∫–∞ `src/components/ui`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@radix-ui/*`).
- **next-themes** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã (—Å–≤–µ—Ç–ª–∞—è/—Ç—ë–º–Ω–∞—è).
- **Lucide-react** ‚Äî –Ω–∞–±–æ—Ä –∏–∫–æ–Ω–æ–∫.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –í `next.config.ts` –≤–∫–ª—é—á—ë–Ω **React Compiler** (`reactCompiler: true`), —á—Ç–æ –¥–∞—ë—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
- –ì–ª–∞–≤–Ω—ã–π layout (`src/app/layout.tsx`) –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —à—Ä–∏—Ñ—Ç **Geist** –∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ `SocketProvider` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WebSocket.

### 2.2. –ë—ç–∫–µ–Ω–¥ –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL** –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–π –°–£–ë–î (datasource `db` —Å `provider = "postgresql"`).
- **Prisma ORM 7.3.0** c **Postgres‚Äë–∞–¥–∞–ø—Ç–µ—Ä–æ–º** `@prisma/adapter-pg`.
- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ Prisma –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **–∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å** `../src/generated/prisma`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –∏ –º–æ–¥–µ–ª–∏ –≤ TypeScript.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É `DATABASE_URL` –∏–∑ `.env` (—Å–º. `src/lib/prisma.ts`).

### 2.3. –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏ —Å–æ–∫–µ—Ç—ã

- **Socket.IO** (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å —á–µ—Ä–µ–∑ `socket.io` –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–µ—Ä–µ–∑ `socket.io-client`).
- –°–µ—Ä–≤–µ—Ä —Å–æ–∫–µ—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `src/pages/api/socket.ts` (—Ñ–æ—Ä–º–∞—Ç API Routes –≤ Next.js, —Å–æ–≤–º–µ—Å—Ç–∏–º —Å App Router):
  - –°–æ–∑–¥–∞—ë—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä `ServerIO` –Ω–∞ –±–∞–∑–µ `httpServer` —Å –ø—É—Ç—ë–º `path: '/api/socket'`.
  - –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è `socket.id`.
  - –ù–∞ —Å–æ–±—ã—Ç–∏–µ `update-data` —Å–µ—Ä–≤–µ—Ä —à–ª—ë—Ç –≤—Å–µ–º *–æ—Å—Ç–∞–ª—å–Ω—ã–º* –∫–ª–∏–µ–Ω—Ç–∞–º —Å–æ–±—ã—Ç–∏–µ `refresh` (`socket.broadcast.emit('refresh')`).
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:
  - `src/providers/socket-provider.tsx` —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç `SocketContext` –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–ª–∏–µ–Ω—Ç `ClientIO` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ `fetch('/api/socket')`.
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç `socket` –∏ —Ñ–ª–∞–≥ `isConnected`.
  - `CategorySocketPicker` –∏ —Ö—É–∫ `useRefreshOnEvent` –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å–æ–∫–µ—Ç–∞ –∏ –≤—ã–∑—ã–≤–∞—é—Ç `router.refresh()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

### 2.4. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (UploadThing)

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **`uploadthing`**:
  - `src/app/api/uploadthing/core.ts` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `ourFileRouter` —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º `categoryImage`, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 4MB, 1 —Ñ–∞–π–ª).
  - –ö–æ–ª–ª–±–µ–∫ `onUploadComplete` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (`file.ufsUrl`).
  - `src/app/api/uploadthing/route.ts` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `GET` –∏ `POST` —á–µ—Ä–µ–∑ `createRouteHandler`.
  - `src/utils/uploadthing.ts` —Å–æ–∑–¥–∞—ë—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `UploadButton` –∏ `UploadDropzone` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.
- –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `AddCategoryButton` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `UploadButton` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∞ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —á–µ—Ä–µ–∑ `categoryImage`.

### 2.5. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- **ESLint 9** –∏ `eslint-config-next` –ø–æ–¥–∫–ª—é—á–µ–Ω—ã, –µ—Å—Ç—å `eslint.config.mjs`.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω TypeScript (`"type": "module"` –≤ `package.json`).
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —É—Ç–∏–ª–∏—Ç—ã `clsx`, `class-variance-authority`, `tailwind-merge` (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ `src/lib/utils.ts` –∏ UI‚Äë–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö).
- –ï—Å—Ç—å `bun.lock` –∏ `package-lock.json`, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å–∫–∞–ª—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–Ω—ã–º–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ (npm/bun).

---

## 3. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (Prisma) –∏ –ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å

–§–∞–π–ª `prisma/schema.prisma` –∑–∞–¥–∞—ë—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–≥–∞—Ç—É—é –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫—Ä—ã–≤–∞—é—â—É—é –ø–æ—á—Ç–∏ –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞.

### 3.1. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã

- **`Category`**
  - –ü–æ–ª—è: `id`, `name` (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏), `description`, `parentCategoryId`, `createdAt`, `updatedAt`.
  - –°–∞–º–æ—Å—Å—ã–ª–æ—á–Ω–∞—è —Å–≤—è–∑—å `parentCategory` / `subcategories` —á–µ—Ä–µ–∑ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ `CategoryToCategory`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
  - –°–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å `CategoryImage`.
  - –ò–Ω–¥–µ–∫—Å –ø–æ `[parentCategoryId, id]` –∏ `@@map("categories")` –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î.

- **`CategoryImage`**
  - –ü–æ–ª—è: `id`, `url`, `categoryId`, `createdAt`, `updatedAt`.
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π `categoryId` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
  - –°–≤—è–∑—å `category` —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º (`onDelete: Cascade`).

- **`Product`**
  - –ü–æ–ª—è: `id`, `name`, `description`, `basePrice`, `categoryId`, `createdAt`, `updatedAt`, `isAvailable`, `averageRating`, `hasVariants`.
  - –°–≤—è–∑–∏:
    - `category`: –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    - `images`: —Å–ø–∏—Å–æ–∫ `ProductImage`.
    - `stocks`: –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º (`Stock`).
    - `cartItems`, `orderItems`, `reviews`, `attributeValues`, `productVariants`.
  - –¶–µ–Ω—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ —Ç–∏–ø `Decimal` —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é (`@db.Decimal(10, 2)` –¥–ª—è —Ü–µ–Ω—ã, `@db.Decimal(3, 2)` –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞).

### 3.2. –ê—Ç—Ä–∏–±—É—Ç—ã –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤

- **`Attribute`** –∏ **`AttributeValue`**
  - –ü–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä –∏ —Ç.–ø.).
  - `AttributeValue` —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä, —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∫–ª—é—á–æ–º `@@unique([attributeId, productId])`.

- **`ProductVariant`** –∏ **`VariantAttributeValue`**
  - `ProductVariant` —Ö—Ä–∞–Ω–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä/—Ü–≤–µ—Ç, –æ—Ç–ª–∏—á–∞—é—â–∏–µ—Å—è —Ü–µ–Ω–æ–π –∏ –æ—Å—Ç–∞—Ç–∫–æ–º).
  - –ü–æ–ª—è: `productId`, `name`, `additionalPrice`, `price`, `stock`, `createdAt`, `updatedAt`.
  - `VariantAttributeValue` —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç).

### 3.3. –°–∫–ª–∞–¥—É –∏ –∑–∞–ø–∞—Å—ã

- **`Warehouse`**
  - –ü–æ–ª—è: `id`, `location`, `name`, `createdAt`, `updatedAt`.
  - –°–≤—è–∑—å `stocks` —Å –º–æ–¥–µ–ª—å—é `Stock`.

- **`Stock`**
  - –ü–æ–ª—è: `id`, `productId`, `warehouseId`, `quantity`, `createdAt`, `updatedAt`.
  - –°–æ—Å—Ç–∞–≤–Ω–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á `@@unique([productId, warehouseId])` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–ª—è —Å–æ—á–µ—Ç–∞–Ω–∏—è ¬´—Ç–æ–≤–∞—Ä + —Å–∫–ª–∞–¥¬ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å.

### 3.4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–æ–ª–∏ –∏ –∞–¥—Ä–µ—Å–∞

- **`User`**
  - –ü–æ–ª—è: `id`, `email` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π), `password`, `role`, `firstName`, `lastName`, `avatarUrl`, `createdAt`, `updatedAt`, `totalSpent`.
  - –†–æ–ª—å (`Role`) –º–æ–∂–µ—Ç –±—ã—Ç—å `ADMIN`, `USER`, `ANALYTICS`, `WAREHOUSE_WORKER`.
  - –°–≤—è–∑–∏: `addresses`, `cart`, `orders`, `reviews`, `paymentMethods`, `auditLogs`.
  - –ü–æ–ª–µ `totalSpent` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –æ–±—ä—ë–º—É –ø–æ–∫—É–ø–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, VIP‚Äë–∫–ª–∏–µ–Ω—Ç—ã).

- **`Address`**
  - –ü–æ–ª—è: `id`, `street`, `city`, `postCode`, `userId`.
  - –°–≤—è–∑–∞–Ω–∞ —Å `User` —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º.

### 3.5. –ö–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã

- **`Cart`** –∏ **`CartItem`**
  - `Cart` ‚Äî –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–≤—è–∑–∞–Ω–∞ –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å `User` (`userId` —É–Ω–∏–∫–∞–ª–µ–Ω).
  - `CartItem` —Å–æ–¥–µ—Ä–∂–∏—Ç `cartId`, `productId`, `quantity` –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—ã `cartId + productId`.

- **`Order`**, **`OrderItem`**
  - `Order` —Ö—Ä–∞–Ω–∏—Ç –∑–∞–∫–∞–∑—ã: `userId`, `totalPrice`, `status` (enum `OrderStatus` —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ `PENDING`, `PROCESSING`, `SHIPPED`, `DELIVERED`, `CANCELED`).
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
    - `addressId` –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è `deliveryCity`, `deliveryStreet` ‚Äî –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é/–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π.
    - –°–≤—è–∑—å —Å `Promocode` –∏ `PaymentMethod`.
  - `OrderItem` —Ö—Ä–∞–Ω–∏—Ç –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ —Å —Ü–µ–Ω–æ–π –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏ (`priceAtPurchase`), —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —É—á—ë—Ç–∞.

### 3.6. –õ–æ—è–ª—å–Ω–æ—Å—Ç—å, –æ—Ç–∑—ã–≤—ã –∏ –ø–ª–∞—Ç–µ–∂–∏

- **`Review`**
  - –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ —Ç–æ–≤–∞—Ä–∞—Ö: `rating`, `comment`, `createdAt`, `updatedAt`.
  - –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `@@unique([userId, productId])` –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞ –Ω–∞ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä.

- **`Promocode`**
  - –°–∫–∏–¥–æ—á–Ω—ã–µ –∫–æ–¥—ã —Å –ø–æ–ª—è–º–∏ `code` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π), `discount`, `validFrom`, `validUntil`.

- **`PaymentMethod`**
  - –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∏–ø, –¥–µ—Ç–∞–ª–∏, —Å–≤—è–∑—å —Å –∑–∞–∫–∞–∑–∞–º–∏).

### 3.7. –õ–æ–≥–∏

- **`AuditLog`**
  - –û–±—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π: `userId`, `action`, `timestamp`, `entityId`, `entityType`, `details`.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π (–æ—Å–æ–±–µ–Ω–Ω–æ –∞–¥–º–∏–Ω–æ–≤).

### 3.8. SQL‚Äë–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–§–∞–π–ª `–ó–∞–ø—Ä–æ—Å—ã.md` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã **—Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**:

- –¢–æ–ø‚Äë5 —Å–∞–º—ã—Ö –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ—Ç—Ä–∞—Ç–∏–≤—à–∏–µ –±–æ–ª—å—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞.
- –¢–æ–≤–∞—Ä—ã –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤ (¬´–Ω–µ–ª–∏–∫–≤–∏–¥¬ª).
- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º.
- –î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º.
- –¢–æ–≤–∞—Ä—ã —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º.
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã —É VIP‚Äë–∫–ª–∏–µ–Ω—Ç–æ–≤.
- –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Ç–∑—ã–≤–æ–≤.
- –°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö.
- –ú–µ—Å—è—á–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ —Å LAG –ø–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –º–µ—Å—è—Ü—É.
- –¢–æ–ø‚Äë3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
- –õ–æ–≥–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞ –Ω–µ–¥–µ–ª—é.
- –ü–æ–∏—Å–∫ ¬´–±—Ä–æ—à–µ–Ω–Ω—ã—Ö¬ª –∫–æ—Ä–∑–∏–Ω.

–≠—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å —É—á—ë—Ç–æ–º **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ CRUD.

---

## 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –∏ —Å–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 4.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ `src`

- `src/app`
  - `layout.tsx` ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π layout (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç —à—Ä–∏—Ñ—Ç—ã, SocketProvider).
  - `page.tsx` ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω Next.js).
  - `admin/dashboard/layout.tsx` ‚Äî layout –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏ (sidebar, —Ö–µ–¥–µ—Ä, Toaster).
  - `admin/dashboard/page.tsx` ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ (—Å–µ—Ç–æ—á–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ + –ø—É—Å—Ç–æ–π –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞).
  - `admin/dashboard/categories/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏.
  - `admin/dashboard/products/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏.
  - `[product]/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–æ–¥ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è, –Ω–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∫–∞).
  - `api/uploadthing/*` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤.

- `src/components`
  - –û–±—â–∏–µ UI‚Äë–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫–Ω–æ–ø–∫–∏, —Ç–∞–±–ª–∏—Ü—ã, sidebar, –¥–∏–∞–ª–æ–≥–∏ –∏ —Ç.–¥.).
  - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - `AppSidebar`, `AddCategoryButton`, `DeleteCategoryButton`, `CategorySocketPicker`, `RealtimeRefresher`, `ToggleProductStatusButton`.
    - –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ: `theme-provider.tsx`, `theme-toggle.tsx`.

- `src/hooks`
  - `use-refresh-on-event` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ö—É–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ —Å–æ–±—ã—Ç–∏—è–º —Å–æ–∫–µ—Ç–∞.
  - `use-mobile` ‚Äî —Ö—É–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

- `src/lib`
  - `prisma.ts` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ Prisma.
  - `links.ts` ‚Äî –º–µ–Ω—é –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏.
  - `utils.ts` ‚Äî —É—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–æ–¥ –Ω–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª—Å—è, –Ω–æ –æ–±—ã—á–Ω–æ —Ç–∞–º `cn`, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–ø.).

- `src/providers`
  - `socket-provider.tsx` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä Socket.IO.

- `src/server-actions`
  - `categories.action.ts` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º prisma –∏ `revalidatePath`.
  - `products.action.ts` ‚Äî —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞.

- `src/services`
  - `categories.service.ts` ‚Äî —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–ø–æ–ª—É—á–µ–Ω–∏–µ, –ø–æ–∏—Å–∫, —Å–æ–∑–¥–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ).
  - `prosuct.service.ts` ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ (–æ–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞, –æ–ø–∏—Å–∞–Ω–æ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –Ω–∏–∂–µ).

- `src/pages/api`
  - `socket.ts` ‚Äî —Å–µ—Ä–≤–µ—Ä Socket.IO –Ω–∞ –±–∞–∑–µ API Route.

### 4.2. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–ª–æ—ë–≤

–ù–∞ –ø—Ä–∏–º–µ—Ä–µ **–∫–∞—Ç–µ–≥–æ—Ä–∏–π**:

1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ `admin/dashboard/categories/page.tsx` (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç):
   - –í—ã–∑—ã–≤–∞–µ—Ç `categoryService.getAll()` –∏–∑ `src/services/categories.service.ts`.
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º `categoryImage`.
   - –†–∏—Å—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è.
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç `CategorySocketPicker`, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `refresh` –æ—Ç —Å–æ–∫–µ—Ç–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `router.refresh()`.

2. –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `AddCategoryButton`, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏—Ç —à—Ç–æ—Ä–∫—É (`Sheet`) —Å —Ñ–æ—Ä–º–æ–π.
   - –§–æ—Ä–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UploadButton` (UploadThing) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `imageUrl`.
   - –ü—Ä–∏ —Å–∞–±–º–∏—Ç–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —ç–∫—à–µ–Ω `manageCategoryAction` –∏–∑ `src/server-actions/categories.action.ts` (—á–µ—Ä–µ–∑ `form action={onSubmit}`).
   - –≠–∫—à–µ–Ω:
     - –í —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `prisma.category.update` –∏ –ª–∏–±–æ —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `categoryImage` —á–µ—Ä–µ–∑ `upsert`.
     - –í —Ä–µ–∂–∏–º–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º `categoryImage`.
     - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `revalidatePath('/admin/categories')` (–≤–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å, —Å–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∏–∂–µ).
   - –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `toast.success(...)` –∏ —à—Ç–æ—Ä–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

3. –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   - `DeleteCategoryButton` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `AlertDialog` —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`hasSubcategories`).
   - –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `deleteCategoryAction(id)`.
   - –≠–∫—à–µ–Ω —É–¥–∞–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é —á–µ—Ä–µ–∑ Prisma –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `revalidatePath('/admin/dashboard/categories')`.

4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç—ã (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ):
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ) –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –¥–µ—Ä–≥–∞—Ç—å `io.emit('refresh')` —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –°–µ–π—á–∞—Å –º–µ—Ö–∞–Ω–∏–∑–º —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (`CategorySocketPicker`, `socket-provider`, `socket.ts`), –Ω–æ, —Å—É–¥—è –ø–æ –∫–æ–¥—É, —Å–∞–º –≤—ã–∑–æ–≤ `update-data`/`refresh` —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞ —è–≤–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ server actions (—Å–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏).

–ù–∞ –ø—Ä–∏–º–µ—Ä–µ **—Ç–æ–≤–∞—Ä–æ–≤**:

1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ `admin/dashboard/products/page.tsx`:
   - –í—ã–∑—ã–≤–∞–µ—Ç `productService.getAll()`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç `prisma.product.findMany` —Å `include: { category, images, stocks }`.
   - –í —Ç–∞–±–ª–∏—Ü–µ:
     - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`mainImage` = `images.find(isPrimary) || images[0]`).
     - –°—á–∏—Ç–∞–µ—Ç—Å—è —Å—É–º–º–∞—Ä–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ `totalStock` –∫–∞–∫ —Å—É–º–º–∞ `stock.quantity` –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º.
     - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–µ–π–¥–∂–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (`isAvailable`).
     - –ö–Ω–æ–ø–∫–∞ `ToggleProductStatusButton` –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞.

2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞:
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ToggleProductStatusButton`:
     - –•—Ä–∞–Ω–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π `optimisticStatus` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞.
     - –ü—Ä–∏ –∫–ª–∏–∫–µ –≤—ã–∑—ã–≤–∞–µ—Ç server action `toggleProductAvailabilityAction(productId, optimisticStatus)`.
     - –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `toast.error`.
     - –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `toast.success`.
   - `toggleProductAvailabilityAction`:
     - –ß–µ—Ä–µ–∑ `prisma.product.update` –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–µ `isAvailable`.
     - –í—ã–∑—ã–≤–∞–µ—Ç `revalidatePath('/admin/dashboard/products')`.

---

## 5. –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞

- **–•–æ—Ä–æ—à–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ë–î**, –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è –∫–ª—é—á–µ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏** (—Å—Ç—Ä–∞–Ω–∏—Ü—ã, server actions, —Å–µ—Ä–≤–∏—Å—ã, ORM‚Äë—Å–ª–æ–π, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∫–µ—Ç–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤).
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Next.js**:
  - App Router;
  - server components + client components;
  - `revalidatePath` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Socket.IO** –∏ –Ω–∞–ª–∏—á–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ `useRefreshOnEvent`/`RealtimeRefresher` –¥–ª—è –∂–∏–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI‚Äë—Å—Ç–µ–∫** (shadcn/ui, Radix, Tailwind, lucide) —Å –ø–æ–Ω—è—Ç–Ω–æ–π, –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
- **–£—á—ë—Ç UX**:
  - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–≤–∞—Ä–∞;
  - –õ–æ–∞–¥–µ—Ä—ã (`Loader2`), `toast`‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è;
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö.
- **–ù–∞–ª–∏—á–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤** –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ (`–ó–∞–ø—Ä–æ—Å—ã.md`), —á—Ç–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –ë–î.

---

## 6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–¥, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Ç–µ–º–∞–º. –û–Ω–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è, –Ω–æ –ø–æ–º–æ–≥—É—Ç —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–µ–∫—Ç **–±–æ–ª–µ–µ —á–∏—Å—Ç—ã–º, –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º**.

### 6.1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫–∏ –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤ –∏ —Ç–∏–ø–æ–≤**
   - –§–∞–π–ª `src/services/prosuct.service.ts` –ª—É—á—à–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `product.service.ts`, –∞ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:
     - –í `admin/dashboard/products/page.tsx` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `@/services/product.service` (–±–µ–∑ –æ–ø–µ—á–∞—Ç–∫–∏).
   - –≠—Ç–æ —É–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Å–Ω–∏–∑–∏—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–∞—Ö.

2. **–ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤**
   - –°–µ–π—á–∞—Å –≤ `src/components` –µ—Å—Ç—å –∫–∞–∫ `AddCategoryButton.tsx`, —Ç–∞–∫ –∏ —Ñ–∞–π–ª—ã –≤ `ui`‚Äë–ø–æ–¥–ø–∞–ø–∫–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –î–ª—è ¬´—Ñ–∏—á–µ–≤—ã—Ö¬ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **PascalCase** (`AddCategoryButton`, `DeleteCategoryButton`, `AppSidebar`).
     - –î–ª—è —É—Ç–∏–ª–∏—Ç –∏ —Ö—É–∫–æ–≤ ‚Äî **camelCase** (`useRefreshOnEvent`, `useIsMobile`, `uploadthing.ts`).
   - –í —Ü–µ–ª–æ–º —Å—Ç–∏–ª—å —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω, –Ω—É–∂–Ω–æ –ª–∏—à—å —É–±—Ä–∞—Ç—å –µ–¥–∏–Ω–∏—á–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.

3. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—É—Ç–µ–π –≤ `revalidatePath`**
   - –í `createCategoryAction` –∏ `manageCategoryAction` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É—Ç—å `'/admin/categories'`, —Ç–æ–≥–¥–∞ –∫–∞–∫ —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É `'/admin/dashboard/categories'` (—Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `src/app/admin/dashboard/categories/page.tsx`).
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å:
     - –õ–∏–±–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ –ø—É—Ç–∏ –∫ `/admin/dashboard/...`,
     - –õ–∏–±–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–æ—É—Ç–∏–Ω–≥–∞, –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/categories`.
   - –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI.

4. **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞**
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –Ω–æ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∏/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.
   - –î–ª—è –∫—É—Ä—Å–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ª—É—á—à–µ:
     - –õ–∏–±–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–ø–æ–¥–ø–∏—Å–∏ –∫–Ω–æ–ø–æ–∫, —Ç—É–ª—Ç–∏–ø—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏),
     - –õ–∏–±–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–º–µ—à–∞–Ω–Ω—ã–π —è–∑—ã–∫, –Ω–æ —Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ–±—ã –∫–ª—é—á–µ–≤—ã–µ –±–∏–∑–Ω–µ—Å‚Äë–ø–æ–Ω—è—Ç–∏—è –±—ã–ª–∏ –æ–ø–∏—Å–∞–Ω—ã –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ.

### 6.2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ server actions**
   - –°–µ–π—á–∞—Å —á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å Prisma –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `categories.service.ts`, –∞ —á–∞—Å—Ç—å ‚Äî –≤ `categories.action.ts` (`prisma.category.update`/`create` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ action).
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –í—ã–Ω–µ—Å—Ç–∏ –≤—Å—é —Ä–∞–±–æ—Ç—É —Å –ë–î –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (`categories.service.ts`, `product.service.ts` –∏ —Ç.–ø.).
     - Server actions –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–Ω–∫–∏–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏: —Ä–∞–∑–±–æ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤, –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞/–æ—à–∏–±–æ–∫, –≤—ã–∑–æ–≤ `revalidatePath`.
   - –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ entrypoint‚Äô–∞–º–∏ (API, server actions, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏).

2. **–û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π –¥–ª—è ¬´–¥–æ–º–µ–Ω–Ω—ã—Ö¬ª –æ–ø–µ—Ä–∞—Ü–∏–π**
   - –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞, —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Å–æ —Å–∫–ª–∞–¥–∞, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞) –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–æ –≤–≤–µ—Å—Ç–∏ **–¥–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**:
     - `orderService.createOrder(...)`,
     - `inventoryService.reserveStock(...)` –∏ —Ç.–ø.
   - –°–µ–π—á–∞—Å —ç—Ç–æ –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î –∫ —ç—Ç–æ–º—É —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç.

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ Prisma –º–æ–¥–µ–ª–µ–π**
   - –í `categories.service.ts` –∏ `prosuct.service.ts` –º–æ–∂–Ω–æ —è–≤–Ω–æ –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Ç–∏–ø—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Prisma.CategoryGetPayload`, `Prisma.ProductGetPayload` –∏–ª–∏ —Ç–∏–ø–æ–≤ –∏–∑ `@/generated/prisma/client`.
   - –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –±–æ–ª–µ–µ —Å–∏–ª—å–Ω—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (—Å—Ç—Ä–∞–Ω–∏—Ü) –∏ —É–º–µ–Ω—å—à–∏—Ç —Ä–∏—Å–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—è–º.

4. **–í—ã–¥–µ–ª–µ–Ω–∏–µ ¬´–º–æ–¥—É–ª–µ–π —Ñ–∏—á¬ª**
   - –ü–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–∂–Ω–æ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ —Ñ–∏—á–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
     - `src/features/categories` (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å–µ—Ä–≤–∏—Å—ã, server actions, —Å—Ö–µ–º—ã —Ñ–æ—Ä–º),
     - `src/features/products`,
     - `src/features/orders`.
   - –°–µ–π—á–∞—Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ–ª—å—à–µ ¬´—Å–ª–æ–π–Ω–∞—è¬ª (`components`, `services`, `server-actions`), —á—Ç–æ —Ç–æ–∂–µ –ø—Ä–∏–µ–º–ª–µ–º–æ, –Ω–æ –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —á–∞—Å—Ç–æ —É–ª—É—á—à–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### 6.3. –†–∞–±–æ—Ç–∞ —Å —Å–æ–∫–µ—Ç–∞–º–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º

1. **–ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ–±—ã—Ç–∏–π Socket.IO**
   - –°–µ–π—á–∞—Å –µ—Å—Ç—å –∂—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç–æ–µ —Å–æ–±—ã—Ç–∏–µ `'refresh'` –≤ `CategorySocketPicker` –∏ `'update-data'` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `'refresh'`).
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –í—ã–Ω–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π –≤ –µ–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `src/lib/socket-events.ts`), –≥–¥–µ –±—É–¥—É—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `SOCKET_EVENTS = { UPDATE_DATA: 'update-data', REFRESH: 'refresh', ... }`.
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è server actions —Å —Å–æ–∫–µ—Ç–∞–º–∏**
   - –°–µ–π—á–∞—Å server actions (`createCategoryAction`, `manageCategoryAction`, `deleteCategoryAction`, `toggleProductAvailabilityAction`) –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å Socket.IO.
   - –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
     - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–∑—ã–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π API‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Node‚Äë–∫–æ–¥–∞), –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏—Ç `io.emit('refresh')` –∏–ª–∏ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (`'category-updated'`, `'product-updated'`).
     - –¢–æ–≥–¥–∞ `CategorySocketPicker` –∏ `RealtimeRefresher` –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å UI –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö.

3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–∫–µ—Ç–∞**
   - –°–µ–π—á–∞—Å `socket` —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ `any`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é `Socket<ServerToClientEvents, ClientToServerEvents>` –∏–∑ `socket.io-client`, –æ–ø—Ä–µ–¥–µ–ª–∏–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–æ–±—ã—Ç–∏–π.
     - –≠—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–¥–∞ –∏ –æ–±–ª–µ–≥—á–∏—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º.

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–æ–∫–µ—Ç–∞**
   - –í `SocketProvider` –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `socket?.disconnect()`, –Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∞ ‚Äî –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`, –ø—Ä–∏ —ç—Ç–æ–º –≤ `return` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `socket` –∏–∑ –∑–∞–º—ã–∫–∞–Ω–∏—è.
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –í–Ω—É—Ç—Ä–∏ `useEffect` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `const socketInstance = ...` –∏ –≤ `return` –¥–µ–ª–∞—Ç—å `socketInstance.disconnect()`, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è `socket`.

### 6.4. –†–∞–±–æ—Ç–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**
   - UploadThing —É–∂–µ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é, –Ω–æ –¥–ª—è UX –ø–æ–ª–µ–∑–Ω–æ:
     - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏.
     - –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.
   - –í `AddCategoryButton` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º –∏ –ª–∏–º–∏—Ç–∞–º.

2. **–û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤**
   - –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
   - –î–ª—è –∫—É—Ä—Å–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –≤ –±–æ–µ–≤–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —Å—Ç–æ–∏—Ç –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏.

### 6.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ UX

1. **–ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫**
   - –í `products.action.ts` –∏ `categories.action.ts` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `try/catch` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–º `{ error: string }`.
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –í–≤–µ—Å—Ç–∏ —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `createActionError(message, code)`).
     - –Ø–≤–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (–≤–∞–ª–∏–¥–∞—Ü–∏—è) –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ (–æ—à–∏–±–∫–∏ –ë–î, —Å–µ—Ç–∏).

2. **–ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞**
   - –°–µ–π—á–∞—Å –≤ server actions –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ `name` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
     - –ü—Ä–æ–≤–µ—Ä–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è.
     - –ü—Ä–æ–≤–µ—Ä–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ `parentCategoryId` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Ü–∏–∫–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π).

3. **–°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π**
   - `AddCategoryButton` –∏ `DeleteCategoryButton` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ–ª–∞–≥ `isLoading`.
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
     - –ö–Ω–æ–ø–∫–∏ –≤—Å–µ–≥–¥–∞ –¥–∏–∑–µ–π–±–ª—è—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã.
     - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–ª—É—á–∞–π–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –¥–≤–∞–∂–¥—ã (–Ω–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Å–∞–±–º–∏—Ç–∞).

### 6.6. –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞ –∏ —Å—Ç–∏–ª—å

1. **–ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –∏–ª–∏ ESLint/Prettier).
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
     - –î–æ–±–∞–≤–∏—Ç—å `.editorconfig` –∏/–∏–ª–∏ —è–≤–Ω—ã–π `.prettierrc` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Prettier), —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—Ç—É–ø—ã, –∫–∞–≤—ã—á–∫–∏, –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏ –∏ —Ç.–¥.

2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**
   - –í –∫–æ–¥–µ –µ—Å—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–æ–±—ä—è—Å–Ω—è—é—â–∏–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥, –æ—Å–æ–±–µ–Ω–Ω–æ –≤–æ–∫—Ä—É–≥ socket –∏ UploadThing).
   - –î–ª—è —á–∏—Å—Ç–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞:
     - –ò–∑–±–µ–≥–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤–∏–¥–∞ ¬´// –õ–æ–≥–∏–∫–∞ –°–û–ó–î–ê–ù–ò–Ø¬ª –∏ ¬´// –õ–æ–≥–∏–∫–∞ –û–ë–ù–û–í–õ–ï–ù–ò–Ø¬ª, –µ—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —É–∂–µ –≤—Å—ë –≥–æ–≤–æ—Ä—è—Ç.
     - –û—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –∏ —á–∏—Å–µ–ª**
   - –ü—Ä–∏–º–µ—Ä—ã:
     - –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø—É—Ç–∏ `/admin/dashboard/products`, `/admin/dashboard/categories`, `/api/socket`.
     - –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Å—Ç–∞—Ç–æ–∫ `<= 5` —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–º).
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
     - –í—ã–Ω–µ—Å—Ç–∏ —Ç–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`ROUTES`, `STOCK_THRESHOLD`, `SOCKET_PATH`) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö.

4. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   - –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –æ–±—â–∏—Ö UI‚Äë–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö `Table`, —á—Ç–æ —Ö–æ—Ä–æ—à–æ.
   - –ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –µ—â—ë —Ç–∞–±–ª–∏—Ü—ã (–∑–∞–∫–∞–∑—ã, —Å–∫–ª–∞–¥—ã), —Å—Ç–æ–∏—Ç –≤—ã–Ω–µ—Å—Ç–∏:
     - –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ö–µ–¥–µ—Ä–∞, –ø–æ–∏—Å–∫–∞, –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

### 6.7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ

–î–ª—è –∫—É—Ä—Å–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã —á–∞—Å—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –Ω–æ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ö–æ–¥–∞ –º–æ–∂–Ω–æ:

- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ **unit‚Äë—Ç–µ—Å—Ç–æ–≤** –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–µ—Å–ª–∏ —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞–Ω–∏—è).
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ `–ó–∞–ø—Ä–æ—Å—ã.md` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –æ—Ç—á—ë—Ç).

---

## 7. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ ¬´—á–∏—Å—Ç–æ—Ç–µ¬ª –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ü–µ–ª–æ–º

–ù–∏–∂–µ ‚Äî –±–æ–ª–µ–µ –æ–±—â–∏–µ, –Ω–æ –≤–∞–∂–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç **—á–∏—Å—Ç—ã–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è**.

### 7.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **–Ø—Å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π**:
  - –î–µ—Ä–∂–∞—Ç—å —Å—Ç—Ä–æ–≥–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—è–º (`app`, `components`, `services`, `server-actions`, `lib`, `hooks`, `providers`, `utils`).
  - –ü–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (`features/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏`, `features/—Ç–æ–≤–∞—Ä—ã` –∏ —Ç.–¥.).

- **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è ¬´god‚Äë—Ñ–∞–π–ª–æ–≤¬ª**:
  - –ï—Å–ª–∏ –∫–∞–∫–æ–π‚Äë—Ç–æ —Ñ–∞–π–ª —Ä–∞–∑—Ä–∞—Å—Ç–∞–µ—Ç—Å—è (> 300‚Äì400 —Å—Ç—Ä–æ–∫), —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–±–∏–≤–∫–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–Ω–µ—Å—Ç–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª).

### 7.2. –°—Ç–∏–ª—å –∫–æ–¥–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞

- **–ï–¥–∏–Ω—ã–π –Ω–∞–±–æ—Ä –ª–∏–Ω—Ç–µ—Ä‚Äë–ø—Ä–∞–≤–∏–ª**:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ESLint —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –ø–æ–∫—Ä—ã–≤–∞–ª:
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `any` (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–±–µ–≥–∞—Ç—å).
    - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏–º–ø–æ—Ä—Ç—ã.
    - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö—É–∫–æ–≤ (–ø—Ä–∞–≤–∏–ª–æ `react-hooks/rules-of-hooks`).
  - –í–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥–∏–π TypeScript —Ä–µ–∂–∏–º (`"strict": true`), –µ—Å–ª–∏ —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ.

- **–°—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã –¥–ª—è server actions –∏ —Å–µ—Ä–≤–∏—Å–æ–≤**:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Prisma, –∏ —è–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ñ—É–Ω–∫—Ü–∏–π.
  - –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥ –∏–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.

### 7.3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `README.md` –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç**
  - –¢–µ–∫—É—â–∏–π `README.md` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω Next.js.
  - –î–ª—è –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã –∏–º–µ–µ—Ç —Å–º—ã—Å–ª:
    - –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω, –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞).
    - –£–∫–∞–∑–∞—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫.
    - –û–ø–∏—Å–∞—Ç—å —à–∞–≥–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é (—Å–æ–∑–¥–∞–Ω–∏–µ `.env`, –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma, –∑–∞–ø—É—Å–∫ `npm run dev`).
    - –û—Ç–¥–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å `–ó–∞–ø—Ä–æ—Å—ã.md` –∫–∞–∫ —á–∞—Å—Ç—å –∑–∞–¥–∞–Ω–∏—è –ø–æ –ë–î.

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
  - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `docs/architecture.md` –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —ç—Ç–æ—Ç `–û–ø–∏—Å–∞–Ω–∏–µ.md`) —Å:
    - –î–∏–∞–≥—Ä–∞–º–º–æ–π —Å—É—â–Ω–æ—Å—Ç–µ–π (ERD).
    - –û—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏, –∞–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤).

### 7.4. –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏ –ë–î

- **–ß–∏—Å—Ç—ã–π workflow –º–∏–≥—Ä–∞—Ü–∏–π Prisma**
  - –í –ø–∞–ø–∫–µ `prisma/migrations` —É–∂–µ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–π.
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
    - –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º (–≤ —É—á–µ–±–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –µ—â—ë –¥–æ–ø—É—Å—Ç–∏–º–æ, –Ω–æ –ª—É—á—à–µ –∏–º–µ—Ç—å ¬´–ø—Ä–∞–≤–∏–ª—å–Ω—É—é¬ª –∏—Å—Ç–æ—Ä–∏—é).
    - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –∑–∞–ø—É—Å–∫–∞—Ç—å `npx prisma migrate dev --name <–æ–ø–∏—Å–∞–Ω–∏–µ-–∏–∑–º–µ–Ω–µ–Ω–∏—è>`.

- **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (seed‚Äë—Å–∫—Ä–∏–ø—Ç—ã)**
  - –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –∑–∞—â–∏—Ç–µ) –ø–æ–ª–µ–∑–Ω–æ –∏–º–µ—Ç—å seed‚Äë—Å–∫—Ä–∏–ø—Ç:
    - –ó–∞–ø–æ–ª–Ω—è—é—â–∏–π –±–∞–∑—É –ø—Ä–∏–º–µ—Ä–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ç–æ–≤–∞—Ä–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏, –∑–∞–∫–∞–∑–∞–º–∏.
  - –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ñ–∞–π–ª `prisma/seed.ts` —Å –≤—ã–∑–æ–≤–æ–º `prisma.*.createMany`.

### 7.5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏/–∑–∞—â–∏—Ç–µ

- **–°—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏**
  - –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
    - –ü–æ–∫–∞–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î (Prisma schema).
    - –ü–æ–∫–∞–∑ –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è).
    - –ü–æ–∫–∞–∑ —Ä–∞–±–æ—Ç—ã —Å–æ–∫–µ—Ç–æ–≤ (–µ—Å–ª–∏ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Å–æ–±—ã—Ç–∏—é).
    - –ü–æ–∫–∞–∑ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ `–ó–∞–ø—Ä–æ—Å—ã.md` –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

- **–°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã**
  - –î–ª—è –æ—Ç—á—ë—Ç–∞ –º–æ–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å:
    - –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü `/admin/dashboard/categories` –∏ `/admin/dashboard/products`.
    - ER‚Äë–¥–∏–∞–≥—Ä–∞–º–º—É –ø–æ `schema.prisma`.
    - –§—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞ server actions –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.

---

## 8. –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É—á–µ–±–Ω–æ–µ –≤–µ–±‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞** –Ω–∞ –±–∞–∑–µ Next.js –∏ Prisma —Å –ø—Ä–æ–¥—É–º–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é –ë–î, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª—å—é –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ SQL‚Äë–∑–∞–ø—Ä–æ—Å–∞–º–∏. –£–∂–µ —Å–µ–π—á–∞—Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∏—Å—Ç–∞—è –∏ –º–æ–¥—É–ª—å–Ω–∞—è, –∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–∞—Å–∞—é—Ç—Å—è **–ø–æ–ª–∏—Ä–æ–≤–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç–∏–ª—è, —è–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–æ–∫–µ—Ç–æ–≤ —Å –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–æ–π –∏ —É–ª—É—á—à–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å–¥–µ–ª–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –µ—â—ë –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è —á—Ç–µ–Ω–∏—è, –ø—Ä–æ—â–µ –≤ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–∏ –∏ –Ω–∞–≥–ª—è–¥–Ω–µ–µ –Ω–∞ –∑–∞—â–∏—Ç–µ –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã.
</file>

<file path="API_–ó–ê–ö–ê–ó–û–í.md">
# üîå API –ó–∞–∫–∞–∑–æ–≤

## Server Actions

### createOrderAction

–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```typescript
export async function createOrderAction(
	userId: number,
	addressId: number,
	paymentMethodId?: number,
	promocodeCode?: string,
): Promise<{
	success?: boolean
	orderId?: number
	error?: string
}>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `userId` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `addressId` - ID –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `paymentMethodId` - ID —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `promocodeCode` - –ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**

- `success: true` –∏ `orderId` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- `error` –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–û—à–∏–±–∫–∏:**

- "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞"
- "–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"
- "–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
- "–ü—Ä–æ–º–æ–∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω"

---

### updateOrderStatusAction

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

```typescript
export async function updateOrderStatusAction(
	orderId: number,
	status: string,
): Promise<{
	success?: boolean
	error?: string
}>
```

**–°—Ç–∞—Ç—É—Å—ã:**

- `PENDING` - –û–∂–∏–¥–∞–Ω–∏–µ
- `PROCESSING` - –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
- `SHIPPED` - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- `DELIVERED` - –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- `CANCELED` - –û—Ç–º–µ–Ω–µ–Ω–æ

---

### cancelOrderAction

–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞.

```typescript
export async function cancelOrderAction(orderId: number): Promise<{
	success?: boolean
	error?: string
}>
```

**–û—à–∏–±–∫–∏:**

- "–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω"
- "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ —Å —ç—Ç–∏–º —Å—Ç–∞—Ç—É—Å–æ–º"

---

### getOrderDetailsAction

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞.

```typescript
export async function getOrderDetailsAction(orderId: number): Promise<{
	success?: boolean
	order?: Order
	error?: string
}>
```

---

### getUserOrdersAction

–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```typescript
export async function getUserOrdersAction(userId: number): Promise<{
	success?: boolean
	orders?: Order[]
	error?: string
}>
```

---

## Service Methods

### orderService.getAll()

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã (–∞–¥–º–∏–Ω).

```typescript
const orders = await orderService.getAll()
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Order[]` —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏

---

### orderService.getByUserId(userId)

–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```typescript
const userOrders = await orderService.getByUserId(123)
```

---

### orderService.getById(orderId)

–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ –ø–æ ID.

```typescript
const order = await orderService.getById(456)
```

---

### orderService.createFromCart(data)

–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ action).

```typescript
const order = await orderService.createFromCart({
	userId: 123,
	addressId: 456,
	deliveryCity: '–ú–∏–Ω—Å–∫',
	deliveryStreet: '—É–ª. –õ–µ–Ω–∏–Ω–∞, 10',
	promocodeId: 1,
	paymentMethodId: 2,
	items: [
		{ productId: 1, quantity: 2, priceAtPurchase: 100 },
		{ productId: 2, quantity: 1, priceAtPurchase: 50 },
	],
})
```

---

### orderService.updateStatus(orderId, status)

–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞.

```typescript
const updated = await orderService.updateStatus(123, 'SHIPPED')
```

---

### orderService.cancel(orderId)

–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑.

```typescript
const cancelled = await orderService.cancel(123)
```

**–í—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏:**

- –ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω
- –°—Ç–∞—Ç—É—Å –Ω–µ PENDING –∏–ª–∏ PROCESSING

---

### orderService.getStatistics()

–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤.

```typescript
const stats = await orderService.getStatistics()
// {
//   totalOrders: 150,
//   ordersByStatus: [...],
//   totalRevenue: 15000,
//   averageOrderValue: 100
// }
```

---

### orderService.search(query)

–ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

```typescript
const results = await orderService.search('user@email.com')
const results = await orderService.search('123') // –ø–æ ID –∑–∞–∫–∞–∑–∞
```

---

## Types

```typescript
type OrderStatus =
	| 'PENDING'
	| 'PROCESSING'
	| 'SHIPPED'
	| 'DELIVERED'
	| 'CANCELED'

interface Order {
	id: number
	userId: number
	user: User
	totalPrice: Decimal
	status: OrderStatus
	createdAt: DateTime
	updatedAt: DateTime
	addressId?: number
	deliveryCity: string
	deliveryStreet: string
	items: OrderItem[]
	promocodeId?: number
	promocode?: Promocode
	paymentMethodId?: number
	paymentMethod?: PaymentMethod
}

interface OrderItem {
	id: number
	orderId: number
	productId: number
	quantity: number
	priceAtPurchase: Decimal
	product: Product
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã

```typescript
import { orderService } from '@/services/orders.service'

export default async function OrdersPage() {
  const orders = await orderService.getAll()

  return (
    <div>
      {orders.map(order => (
        <div key={order.id}>
          <h3>–ó–∞–∫–∞–∑ #{order.id}</h3>
          <p>–°—Ç–∞—Ç—É—Å: {order.status}</p>
          <p>–°—É–º–º–∞: {order.totalPrice} BYN</p>
        </div>
      ))}
    </div>
  )
}
```

### –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –¥–∏–∞–ª–æ–≥–∞

```typescript
'use client'

import { createOrderAction } from '@/server-actions/orders.action'
import { CreateOrderButton } from '@/components/CreateOrderButton'

export default function CheckoutForm({ userId, addresses, paymentMethods }) {
  return (
    <CreateOrderButton
      userId={userId}
      cartTotal={150}
      addresses={addresses}
      paymentMethods={paymentMethods}
    />
  )
}
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞

```typescript
import { UpdateOrderStatusButton } from '@/components/UpdateOrderStatusButton'

export function OrderRow({ order }) {
  return (
    <tr>
      <td>–ó–∞–∫–∞–∑ #{order.id}</td>
      <td>
        <UpdateOrderStatusButton
          orderId={order.id}
          currentStatus={order.status}
        />
      </td>
    </tr>
  )
}
```

---

## Database Queries

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Prisma ORM –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ë–î –¥–ª—è:

- –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å—É–º–º
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–∫—Ä—ã—Ç–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏
</file>

<file path=".gitattributes">
# Auto detect text files and perform LF normalization
* text=auto
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

/src/generated/prisma
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
	/* config options here */
	reactCompiler: true,
	images: {
		remotePatterns: [
			{
				protocol: 'https',
				hostname: 'utfs.io',
				port: '',
				pathname: '/f/**',
			},
		],
	},
}

export default nextConfig
</file>

<file path="package.json">
{
	"name": "web-app",
	"version": "0.1.0",
	"private": true,
	"type": "module",
	"scripts": {
		"dev": "next dev",
		"build": "next build",
		"start": "next start",
		"lint": "eslint"
	},
	"dependencies": {
		"@prisma/adapter-pg": "^7.3.0",
		"@prisma/client": "^7.3.0",
		"@prisma/config": "^7.3.0",
		"@radix-ui/react-avatar": "^1.1.11",
		"@radix-ui/react-dialog": "^1.1.15",
		"@radix-ui/react-dropdown-menu": "^2.1.16",
		"@radix-ui/react-label": "^2.1.8",
		"@radix-ui/react-select": "^2.2.6",
		"@radix-ui/react-separator": "^1.1.8",
		"@radix-ui/react-slot": "^1.2.4",
		"@radix-ui/react-tooltip": "^1.2.8",
		"@types/pg": "^8.16.0",
		"@uploadthing/react": "^7.3.3",
		"bcryptjs": "^3.0.3",
		"class-variance-authority": "^0.7.1",
		"clsx": "^2.1.1",
		"dotenv": "^17.2.3",
		"lucide-react": "^0.563.0",
		"next": "16.1.5",
		"next-themes": "^0.4.6",
		"pg": "^8.17.2",
		"prisma": "^7.3.0",
		"radix-ui": "^1.4.3",
		"react": "19.2.3",
		"react-dom": "19.2.3",
		"recharts": "^3.7.0",
		"socket.io": "^4.8.3",
		"socket.io-client": "^4.8.3",
		"sonner": "^2.0.7",
		"tailwind-merge": "^3.4.0",
		"uploadthing": "^7.7.4"
	},
	"devDependencies": {
		"@tailwindcss/postcss": "^4",
		"@types/bcryptjs": "^3.0.0",
		"@types/node": "^25.1.0",
		"@types/react": "^19",
		"@types/react-dom": "^19",
		"babel-plugin-react-compiler": "1.0.0",
		"eslint": "^9",
		"eslint-config-next": "16.1.5",
		"tailwindcss": "^4",
		"tw-animate-css": "^1.4.0",
		"typescript": "^5"
	},
	"ignoreScripts": [
		"sharp",
		"unrs-resolver"
	],
	"trustedDependencies": [
		"sharp",
		"unrs-resolver"
	]
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="prisma.config.ts">
// This file was generated by Prisma, and assumes you have installed the following:
// npm install --save-dev prisma dotenv
import 'dotenv/config'
import { defineConfig } from 'prisma/config'

export default defineConfig({
	schema: 'prisma/schema.prisma',
	migrations: {
		path: 'prisma/migrations',
	},
	datasource: {
		url: process.env['DATABASE_URL'],
		directUrl: process.env['DIRECT_URL'],
	},
})
</file>

<file path="prisma/migrations/20250201000000_add_warehouse_workers/migration.sql">
-- CreateTable
CREATE TABLE "warehouse_workers" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER NOT NULL,
    "warehouse_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "warehouse_workers_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "warehouse_workers_user_id_warehouse_id_key" ON "warehouse_workers"("user_id", "warehouse_id");

-- AddForeignKey
ALTER TABLE "warehouse_workers" ADD CONSTRAINT "warehouse_workers_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "warehouse_workers" ADD CONSTRAINT "warehouse_workers_warehouse_id_fkey" FOREIGN KEY ("warehouse_id") REFERENCES "warehouses"("id") ON DELETE CASCADE ON UPDATE CASCADE;
</file>

<file path="prisma/migrations/20260127193536_add_custom_db_logic/migration.sql">
-- CreateEnum
CREATE TYPE "Role" AS ENUM ('ADMIN', 'USER', 'ANALYTICS', 'WAREHOUSE_WORKER');

-- CreateEnum
CREATE TYPE "OrderStatus" AS ENUM ('PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELED');

-- CreateTable
CREATE TABLE "categories" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "parent_category_id" INTEGER,

    CONSTRAINT "categories_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "category_images" (
    "id" SERIAL NOT NULL,
    "url" TEXT NOT NULL,
    "category_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "category_images_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "products" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "price" DECIMAL(10,2) NOT NULL,
    "category_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "is_available" BOOLEAN NOT NULL DEFAULT true,
    "average_rating" DECIMAL(3,2) NOT NULL,

    CONSTRAINT "products_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "product_images" (
    "id" SERIAL NOT NULL,
    "url" TEXT NOT NULL,
    "product_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "isPrimary" BOOLEAN NOT NULL DEFAULT false,

    CONSTRAINT "product_images_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "warehouses" (
    "id" SERIAL NOT NULL,
    "location" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "warehouses_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "stocks" (
    "id" SERIAL NOT NULL,
    "product_id" INTEGER NOT NULL,
    "warehouse_id" INTEGER NOT NULL,
    "quantity" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "stocks_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "users" (
    "id" SERIAL NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "role" "Role" NOT NULL DEFAULT 'USER',
    "first_name" TEXT,
    "last_name" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "avatar_url" TEXT,
    "total_spent" DECIMAL(10,2) NOT NULL DEFAULT 0,

    CONSTRAINT "users_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "addresses" (
    "id" SERIAL NOT NULL,
    "street" TEXT NOT NULL,
    "city" TEXT NOT NULL,
    "post_code" TEXT NOT NULL,
    "user_id" INTEGER NOT NULL,

    CONSTRAINT "addresses_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "carts" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER NOT NULL,

    CONSTRAINT "carts_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "cart_items" (
    "id" SERIAL NOT NULL,
    "cart_id" INTEGER NOT NULL,
    "product_id" INTEGER NOT NULL,
    "quantity" INTEGER NOT NULL,

    CONSTRAINT "cart_items_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "orders" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER NOT NULL,
    "total_price" DECIMAL(10,2) NOT NULL,
    "status" "OrderStatus" NOT NULL DEFAULT 'PENDING',
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,
    "address_id" INTEGER,
    "delivery_city" TEXT NOT NULL,
    "delivery_street" TEXT NOT NULL,
    "promocode_id" INTEGER,
    "payment_method_id" INTEGER,

    CONSTRAINT "orders_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "order_items" (
    "id" SERIAL NOT NULL,
    "order_id" INTEGER NOT NULL,
    "product_id" INTEGER NOT NULL,
    "quantity" INTEGER NOT NULL,
    "priceAtPurchase" DECIMAL(10,2) NOT NULL,

    CONSTRAINT "order_items_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "reviews" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER NOT NULL,
    "product_id" INTEGER NOT NULL,
    "rating" INTEGER NOT NULL,
    "comment" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "reviews_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "promocodes" (
    "id" SERIAL NOT NULL,
    "code" TEXT NOT NULL,
    "discount" DECIMAL(5,2) NOT NULL,
    "valid_from" TIMESTAMP(3) NOT NULL,
    "valid_until" TIMESTAMP(3) NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "promocodes_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "payment_methods" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER NOT NULL,
    "type" TEXT NOT NULL,
    "details" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "payment_methods_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "audit_logs" (
    "id" SERIAL NOT NULL,
    "user_id" INTEGER,
    "action" TEXT NOT NULL,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "entity_id" INTEGER,
    "entity_type" TEXT,
    "details" TEXT,

    CONSTRAINT "audit_logs_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "categories_name_key" ON "categories"("name");

-- CreateIndex
CREATE INDEX "categories_parent_category_id_id_idx" ON "categories"("parent_category_id", "id");

-- CreateIndex
CREATE UNIQUE INDEX "category_images_category_id_key" ON "category_images"("category_id");

-- CreateIndex
CREATE UNIQUE INDEX "stocks_product_id_warehouse_id_key" ON "stocks"("product_id", "warehouse_id");

-- CreateIndex
CREATE UNIQUE INDEX "users_email_key" ON "users"("email");

-- CreateIndex
CREATE UNIQUE INDEX "carts_user_id_key" ON "carts"("user_id");

-- CreateIndex
CREATE UNIQUE INDEX "cart_items_cart_id_product_id_key" ON "cart_items"("cart_id", "product_id");

-- CreateIndex
CREATE UNIQUE INDEX "reviews_user_id_product_id_key" ON "reviews"("user_id", "product_id");

-- CreateIndex
CREATE UNIQUE INDEX "promocodes_code_key" ON "promocodes"("code");

-- AddForeignKey
ALTER TABLE "categories" ADD CONSTRAINT "categories_parent_category_id_fkey" FOREIGN KEY ("parent_category_id") REFERENCES "categories"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "category_images" ADD CONSTRAINT "category_images_category_id_fkey" FOREIGN KEY ("category_id") REFERENCES "categories"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "products" ADD CONSTRAINT "products_category_id_fkey" FOREIGN KEY ("category_id") REFERENCES "categories"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "product_images" ADD CONSTRAINT "product_images_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "stocks" ADD CONSTRAINT "stocks_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "stocks" ADD CONSTRAINT "stocks_warehouse_id_fkey" FOREIGN KEY ("warehouse_id") REFERENCES "warehouses"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "addresses" ADD CONSTRAINT "addresses_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "carts" ADD CONSTRAINT "carts_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "cart_items" ADD CONSTRAINT "cart_items_cart_id_fkey" FOREIGN KEY ("cart_id") REFERENCES "carts"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "cart_items" ADD CONSTRAINT "cart_items_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "orders" ADD CONSTRAINT "orders_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "orders" ADD CONSTRAINT "orders_promocode_id_fkey" FOREIGN KEY ("promocode_id") REFERENCES "promocodes"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "orders" ADD CONSTRAINT "orders_payment_method_id_fkey" FOREIGN KEY ("payment_method_id") REFERENCES "payment_methods"("id") ON DELETE SET NULL ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "order_items" ADD CONSTRAINT "order_items_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "orders"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "order_items" ADD CONSTRAINT "order_items_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE RESTRICT ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "reviews" ADD CONSTRAINT "reviews_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "reviews" ADD CONSTRAINT "reviews_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "payment_methods" ADD CONSTRAINT "payment_methods_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "audit_logs" ADD CONSTRAINT "audit_logs_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE SET NULL ON UPDATE CASCADE;


-- 1. –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
CREATE OR REPLACE FUNCTION get_cart_total(c_id INT) RETURNS DECIMAL AS $$
BEGIN
    RETURN (SELECT COALESCE(SUM(p.price * ci.quantity), 0) 
            FROM cart_items ci JOIN products p ON ci.product_id = p.id 
            WHERE ci.cart_id = c_id);
END; $$ LANGUAGE plpgsql;

-- 2. –°–±–æ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
CREATE OR REPLACE FUNCTION get_full_address(addr_id INT) RETURNS TEXT AS $$
BEGIN
    RETURN (SELECT city || ', ' || street FROM addresses WHERE id = addr_id);
END; $$ LANGUAGE plpgsql;

-- 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "VIP" (–ø–æ—Ç—Ä–∞—Ç–∏–ª > 1000)
CREATE OR REPLACE FUNCTION is_user_vip(u_id INT) RETURNS BOOLEAN AS $$
BEGIN
    RETURN (SELECT total_spent > 1000 FROM users WHERE id = u_id);
END; $$ LANGUAGE plpgsql;

-- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
CREATE OR REPLACE FUNCTION is_promo_active(p_id INT) RETURNS BOOLEAN AS $$
BEGIN
    RETURN EXISTS (SELECT 1 FROM promocodes WHERE id = p_id AND valid_until > NOW());
END; $$ LANGUAGE plpgsql;

-- 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–∞—Ö
CREATE OR REPLACE FUNCTION get_total_stock(p_id INT) RETURNS INT AS $$
BEGIN
    RETURN (SELECT COALESCE(SUM(quantity), 0) FROM stocks WHERE product_id = p_id);
END; $$ LANGUAGE plpgsql;

-- 6. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã (–¥–æ–±–∞–≤–ª—è–µ—Ç –≤–∞–ª—é—Ç—É)
CREATE OR REPLACE FUNCTION format_price(val DECIMAL) RETURNS TEXT AS $$
BEGIN
    RETURN val::TEXT || ' BYN';
END; $$ LANGUAGE plpgsql;

-- 7. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—É—Ä—Å–æ–≤–æ–π)
CREATE OR REPLACE FUNCTION estimate_delivery_days(city_name TEXT) RETURNS INT AS $$
BEGIN
    IF city_name = '–ú–∏–Ω—Å–∫' THEN RETURN 1; ELSE RETURN 3; END IF;
END; $$ LANGUAGE plpgsql;

-- 1. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–ø–µ—Ä–µ–Ω–æ—Å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ –∑–∞–∫–∞–∑)
CREATE OR REPLACE PROCEDURE create_order_from_cart(u_id INT, addr_id INT) AS $$
DECLARE
    new_order_id INT;
    v_cart_id INT;
BEGIN
    SELECT id INTO v_cart_id FROM carts WHERE user_id = u_id;
    
    INSERT INTO orders (user_id, address_id, total_price, status, delivery_city, delivery_street, created_at, updated_at)
    SELECT u_id, addr_id, get_cart_total(v_cart_id), 'PENDING', a.city, a.street, NOW(), NOW()
    FROM addresses a WHERE a.id = addr_id RETURNING id INTO new_order_id;

    INSERT INTO order_items (order_id, product_id, quantity, price_at_purchase)
    SELECT new_order_id, ci.product_id, ci.quantity, p.price
    FROM cart_items ci JOIN products p ON ci.product_id = p.id WHERE ci.cart_id = v_cart_id;

    DELETE FROM cart_items WHERE cart_id = v_cart_id;
END; $$ LANGUAGE plpgsql;

-- 2. –ú–∞—Å—Å–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ (Restock)
CREATE OR REPLACE PROCEDURE bulk_restock(w_id INT, amount INT) AS $$
BEGIN
    UPDATE stocks SET quantity = quantity + amount WHERE warehouse_id = w_id;
END; $$ LANGUAGE plpgsql;

-- 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ –∫–æ –≤—Å–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ß–µ—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞)
CREATE OR REPLACE PROCEDURE apply_category_discount(cat_id INT, discount_percent DECIMAL) AS $$
BEGIN
    UPDATE products SET price = price * (1 - discount_percent / 100) WHERE category_id = cat_id;
END; $$ LANGUAGE plpgsql;

-- 4. –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (—Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π)
CREATE OR REPLACE PROCEDURE cancel_stale_orders() AS $$
BEGIN
    UPDATE orders SET status = 'CANCELED' WHERE status = 'PENDING' AND created_at < NOW() - INTERVAL '3 days';
END; $$ LANGUAGE plpgsql;

-- 5. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ –≥–æ–¥–∞)
CREATE OR REPLACE PROCEDURE archive_audit_logs() AS $$
BEGIN
    DELETE FROM audit_logs WHERE created_at < NOW() - INTERVAL '1 year';
END; $$ LANGUAGE plpgsql;

-- 6. –°–ª–∏—è–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ —é–∑–µ—Ä —Å–æ–∑–¥–∞–ª –¥—É–±–ª–∏–∫–∞—Ç)
CREATE OR REPLACE PROCEDURE merge_user_data(old_u_id INT, new_u_id INT) AS $$
BEGIN
    UPDATE orders SET user_id = new_u_id WHERE user_id = old_u_id;
    UPDATE reviews SET user_id = new_u_id WHERE user_id = old_u_id;
    DELETE FROM users WHERE id = old_u_id;
END; $$ LANGUAGE plpgsql;

-- 7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE PROCEDURE init_user_cart(u_id INT) AS $$
BEGIN
    INSERT INTO carts (user_id) VALUES (u_id) ON CONFLICT DO NOTHING;
END; $$ LANGUAGE plpgsql;

-- 1. –¢—Ä–∏–≥–≥–µ—Ä: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
CREATE OR REPLACE FUNCTION fn_update_product_rating() RETURNS TRIGGER AS $$
BEGIN
    UPDATE products SET average_rating = (SELECT AVG(rating) FROM reviews WHERE product_id = NEW.product_id)
    WHERE id = NEW.product_id;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_update_rating AFTER INSERT OR UPDATE ON reviews FOR EACH ROW EXECUTE FUNCTION fn_update_product_rating();

-- 2. –¢—Ä–∏–≥–≥–µ—Ä: –ó–∞–ø–∏—Å—å –≤ AuditLog –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION fn_log_role_change() RETURNS TRIGGER AS $$
BEGIN
    IF OLD.role <> NEW.role THEN
        INSERT INTO audit_logs (user_id, action, entity_id, entity_type, details, created_at)
        VALUES (NEW.id, 'CHANGE_ROLE', NEW.id, 'User', 'From ' || OLD.role || ' to ' || NEW.role, NOW());
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_log_role AFTER UPDATE ON users FOR EACH ROW EXECUTE FUNCTION fn_log_role_change();

-- 3. –¢—Ä–∏–≥–≥–µ—Ä: –ê–≤—Ç–æ-—Ä–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π
CREATE OR REPLACE FUNCTION fn_recalc_order_total() RETURNS TRIGGER AS $$
BEGIN
    UPDATE orders SET total_price = (SELECT SUM(price_at_purchase * quantity) FROM order_items WHERE order_id = NEW.order_id)
    WHERE id = NEW.order_id;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_recalc_order AFTER INSERT OR UPDATE ON order_items FOR EACH ROW EXECUTE FUNCTION fn_recalc_order_total();

-- 4. –¢—Ä–∏–≥–≥–µ—Ä: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞
CREATE OR REPLACE FUNCTION fn_check_promo_before_order() RETURNS TRIGGER AS $$
BEGIN
    IF NEW.promocode_id IS NOT NULL AND NOT is_promo_active(NEW.promocode_id) THEN
        RAISE EXCEPTION '–î–∞–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω!';
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_check_promo BEFORE INSERT ON orders FOR EACH ROW EXECUTE FUNCTION fn_check_promo_before_order();

-- 5. –¢—Ä–∏–≥–≥–µ—Ä: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ User.totalSpent –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞
CREATE OR REPLACE FUNCTION fn_update_user_spending() RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'DELIVERED' AND OLD.status <> 'DELIVERED' THEN
        UPDATE users SET total_spent = total_spent + NEW.total_price WHERE id = NEW.user_id;
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_user_spending AFTER UPDATE ON orders FOR EACH ROW EXECUTE FUNCTION fn_update_user_spending();

-- 6. –¢—Ä–∏–≥–≥–µ—Ä: –ó–∞–ø—Ä–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
CREATE OR REPLACE FUNCTION fn_prevent_product_delete() RETURNS TRIGGER AS $$
BEGIN
    IF EXISTS (SELECT 1 FROM order_items oi JOIN orders o ON oi.order_id = o.id WHERE oi.product_id = OLD.id AND o.status = 'PENDING') THEN
        RAISE EXCEPTION '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–∫–∞–∑–µ!';
    END IF;
    RETURN OLD;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_protect_product BEFORE DELETE ON products FOR EACH ROW EXECUTE FUNCTION fn_prevent_product_delete();

-- 7. –¢—Ä–∏–≥–≥–µ—Ä: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ (isAvailable = false) –µ—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ 0
CREATE OR REPLACE FUNCTION fn_auto_hide_product() RETURNS TRIGGER AS $$
BEGIN
    IF get_total_stock(NEW.product_id) <= 0 THEN
        UPDATE products SET is_available = false WHERE id = NEW.product_id;
    ELSE
        UPDATE products SET is_available = true WHERE id = NEW.product_id;
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_stock_availability AFTER UPDATE ON stocks FOR EACH ROW EXECUTE FUNCTION fn_auto_hide_product();
</file>

<file path="prisma/migrations/20260131135239_add_variant_of_products/migration.sql">
/*
  Warnings:

  - You are about to drop the column `price` on the `products` table. All the data in the column will be lost.
  - Added the required column `base_price` to the `products` table without a default value. This is not possible if the table is not empty.

*/
-- AlterTable
ALTER TABLE "products" DROP COLUMN "price",
ADD COLUMN     "base_price" DECIMAL(10,2) NOT NULL,
ADD COLUMN     "has_variants" BOOLEAN NOT NULL DEFAULT false;

-- CreateTable
CREATE TABLE "attributes" (
    "id" SERIAL NOT NULL,
    "name" TEXT NOT NULL,
    "value" TEXT NOT NULL,

    CONSTRAINT "attributes_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "attribute_values" (
    "id" SERIAL NOT NULL,
    "attribute_id" INTEGER NOT NULL,
    "product_id" INTEGER NOT NULL,

    CONSTRAINT "attribute_values_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "product_variants" (
    "id" SERIAL NOT NULL,
    "product_id" INTEGER NOT NULL,
    "name" TEXT NOT NULL,
    "additional_price" DECIMAL(10,2) NOT NULL,
    "stock" INTEGER NOT NULL DEFAULT 0,
    "price" DECIMAL(10,2) NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "product_variants_pkey" PRIMARY KEY ("id")
);

-- CreateTable
CREATE TABLE "variant_attribute_values" (
    "id" SERIAL NOT NULL,
    "product_variant_id" INTEGER NOT NULL,
    "attribute_value_id" INTEGER NOT NULL,

    CONSTRAINT "variant_attribute_values_pkey" PRIMARY KEY ("id")
);

-- CreateIndex
CREATE UNIQUE INDEX "attribute_values_attribute_id_product_id_key" ON "attribute_values"("attribute_id", "product_id");

-- CreateIndex
CREATE UNIQUE INDEX "variant_attribute_values_product_variant_id_attribute_value_key" ON "variant_attribute_values"("product_variant_id", "attribute_value_id");

-- AddForeignKey
ALTER TABLE "attribute_values" ADD CONSTRAINT "attribute_values_attribute_id_fkey" FOREIGN KEY ("attribute_id") REFERENCES "attributes"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "attribute_values" ADD CONSTRAINT "attribute_values_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "product_variants" ADD CONSTRAINT "product_variants_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "variant_attribute_values" ADD CONSTRAINT "variant_attribute_values_product_variant_id_fkey" FOREIGN KEY ("product_variant_id") REFERENCES "product_variants"("id") ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE "variant_attribute_values" ADD CONSTRAINT "variant_attribute_values_attribute_value_id_fkey" FOREIGN KEY ("attribute_value_id") REFERENCES "attribute_values"("id") ON DELETE CASCADE ON UPDATE CASCADE;
-- 1. –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
CREATE OR REPLACE FUNCTION get_cart_total(c_id INT) RETURNS DECIMAL AS $$
BEGIN
    RETURN (SELECT COALESCE(SUM(p.price * ci.quantity), 0) 
            FROM cart_items ci JOIN products p ON ci.product_id = p.id 
            WHERE ci.cart_id = c_id);
END; $$ LANGUAGE plpgsql;

-- 2. –°–±–æ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
CREATE OR REPLACE FUNCTION get_full_address(addr_id INT) RETURNS TEXT AS $$
BEGIN
    RETURN (SELECT city || ', ' || street FROM addresses WHERE id = addr_id);
END; $$ LANGUAGE plpgsql;

-- 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "VIP" (–ø–æ—Ç—Ä–∞—Ç–∏–ª > 1000)
CREATE OR REPLACE FUNCTION is_user_vip(u_id INT) RETURNS BOOLEAN AS $$
BEGIN
    RETURN (SELECT total_spent > 1000 FROM users WHERE id = u_id);
END; $$ LANGUAGE plpgsql;

-- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
CREATE OR REPLACE FUNCTION is_promo_active(p_id INT) RETURNS BOOLEAN AS $$
BEGIN
    RETURN EXISTS (SELECT 1 FROM promocodes WHERE id = p_id AND valid_until > NOW());
END; $$ LANGUAGE plpgsql;

-- 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–∞—Ö
CREATE OR REPLACE FUNCTION get_total_stock(p_id INT) RETURNS INT AS $$
BEGIN
    RETURN (SELECT COALESCE(SUM(quantity), 0) FROM stocks WHERE product_id = p_id);
END; $$ LANGUAGE plpgsql;

-- 6. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã (–¥–æ–±–∞–≤–ª—è–µ—Ç –≤–∞–ª—é—Ç—É)
CREATE OR REPLACE FUNCTION format_price(val DECIMAL) RETURNS TEXT AS $$
BEGIN
    RETURN val::TEXT || ' BYN';
END; $$ LANGUAGE plpgsql;

-- 7. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—É—Ä—Å–æ–≤–æ–π)
CREATE OR REPLACE FUNCTION estimate_delivery_days(city_name TEXT) RETURNS INT AS $$
BEGIN
    IF city_name = '–ú–∏–Ω—Å–∫' THEN RETURN 1; ELSE RETURN 3; END IF;
END; $$ LANGUAGE plpgsql;

-- 1. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–ø–µ—Ä–µ–Ω–æ—Å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ –∑–∞–∫–∞–∑)
CREATE OR REPLACE PROCEDURE create_order_from_cart(u_id INT, addr_id INT) AS $$
DECLARE
    new_order_id INT;
    v_cart_id INT;
BEGIN
    SELECT id INTO v_cart_id FROM carts WHERE user_id = u_id;
    
    INSERT INTO orders (user_id, address_id, total_price, status, delivery_city, delivery_street, created_at, updated_at)
    SELECT u_id, addr_id, get_cart_total(v_cart_id), 'PENDING', a.city, a.street, NOW(), NOW()
    FROM addresses a WHERE a.id = addr_id RETURNING id INTO new_order_id;

    INSERT INTO order_items (order_id, product_id, quantity, price_at_purchase)
    SELECT new_order_id, ci.product_id, ci.quantity, p.price
    FROM cart_items ci JOIN products p ON ci.product_id = p.id WHERE ci.cart_id = v_cart_id;

    DELETE FROM cart_items WHERE cart_id = v_cart_id;
END; $$ LANGUAGE plpgsql;

-- 2. –ú–∞—Å—Å–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ (Restock)
CREATE OR REPLACE PROCEDURE bulk_restock(w_id INT, amount INT) AS $$
BEGIN
    UPDATE stocks SET quantity = quantity + amount WHERE warehouse_id = w_id;
END; $$ LANGUAGE plpgsql;

-- 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ –∫–æ –≤—Å–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ß–µ—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞)
CREATE OR REPLACE PROCEDURE apply_category_discount(cat_id INT, discount_percent DECIMAL) AS $$
BEGIN
    UPDATE products SET price = price * (1 - discount_percent / 100) WHERE category_id = cat_id;
END; $$ LANGUAGE plpgsql;

-- 4. –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (—Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π)
CREATE OR REPLACE PROCEDURE cancel_stale_orders() AS $$
BEGIN
    UPDATE orders SET status = 'CANCELED' WHERE status = 'PENDING' AND created_at < NOW() - INTERVAL '3 days';
END; $$ LANGUAGE plpgsql;

-- 5. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ –≥–æ–¥–∞)
CREATE OR REPLACE PROCEDURE archive_audit_logs() AS $$
BEGIN
    DELETE FROM audit_logs WHERE created_at < NOW() - INTERVAL '1 year';
END; $$ LANGUAGE plpgsql;

-- 6. –°–ª–∏—è–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ —é–∑–µ—Ä —Å–æ–∑–¥–∞–ª –¥—É–±–ª–∏–∫–∞—Ç)
CREATE OR REPLACE PROCEDURE merge_user_data(old_u_id INT, new_u_id INT) AS $$
BEGIN
    UPDATE orders SET user_id = new_u_id WHERE user_id = old_u_id;
    UPDATE reviews SET user_id = new_u_id WHERE user_id = old_u_id;
    DELETE FROM users WHERE id = old_u_id;
END; $$ LANGUAGE plpgsql;

-- 7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE PROCEDURE init_user_cart(u_id INT) AS $$
BEGIN
    INSERT INTO carts (user_id) VALUES (u_id) ON CONFLICT DO NOTHING;
END; $$ LANGUAGE plpgsql;

-- 1. –¢—Ä–∏–≥–≥–µ—Ä: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
CREATE OR REPLACE FUNCTION fn_update_product_rating() RETURNS TRIGGER AS $$
BEGIN
    UPDATE products SET average_rating = (SELECT AVG(rating) FROM reviews WHERE product_id = NEW.product_id)
    WHERE id = NEW.product_id;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_update_rating AFTER INSERT OR UPDATE ON reviews FOR EACH ROW EXECUTE FUNCTION fn_update_product_rating();

-- 2. –¢—Ä–∏–≥–≥–µ—Ä: –ó–∞–ø–∏—Å—å –≤ AuditLog –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION fn_log_role_change() RETURNS TRIGGER AS $$
BEGIN
    IF OLD.role <> NEW.role THEN
        INSERT INTO audit_logs (user_id, action, entity_id, entity_type, details, created_at)
        VALUES (NEW.id, 'CHANGE_ROLE', NEW.id, 'User', 'From ' || OLD.role || ' to ' || NEW.role, NOW());
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_log_role AFTER UPDATE ON users FOR EACH ROW EXECUTE FUNCTION fn_log_role_change();

-- 3. –¢—Ä–∏–≥–≥–µ—Ä: –ê–≤—Ç–æ-—Ä–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π
CREATE OR REPLACE FUNCTION fn_recalc_order_total() RETURNS TRIGGER AS $$
BEGIN
    UPDATE orders SET total_price = (SELECT SUM(price_at_purchase * quantity) FROM order_items WHERE order_id = NEW.order_id)
    WHERE id = NEW.order_id;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_recalc_order AFTER INSERT OR UPDATE ON order_items FOR EACH ROW EXECUTE FUNCTION fn_recalc_order_total();

-- 4. –¢—Ä–∏–≥–≥–µ—Ä: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞
CREATE OR REPLACE FUNCTION fn_check_promo_before_order() RETURNS TRIGGER AS $$
BEGIN
    IF NEW.promocode_id IS NOT NULL AND NOT is_promo_active(NEW.promocode_id) THEN
        RAISE EXCEPTION '–î–∞–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω!';
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_check_promo BEFORE INSERT ON orders FOR EACH ROW EXECUTE FUNCTION fn_check_promo_before_order();

-- 5. –¢—Ä–∏–≥–≥–µ—Ä: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ User.totalSpent –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞
CREATE OR REPLACE FUNCTION fn_update_user_spending() RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'DELIVERED' AND OLD.status <> 'DELIVERED' THEN
        UPDATE users SET total_spent = total_spent + NEW.total_price WHERE id = NEW.user_id;
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_user_spending AFTER UPDATE ON orders FOR EACH ROW EXECUTE FUNCTION fn_update_user_spending();

-- 6. –¢—Ä–∏–≥–≥–µ—Ä: –ó–∞–ø—Ä–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
CREATE OR REPLACE FUNCTION fn_prevent_product_delete() RETURNS TRIGGER AS $$
BEGIN
    IF EXISTS (SELECT 1 FROM order_items oi JOIN orders o ON oi.order_id = o.id WHERE oi.product_id = OLD.id AND o.status = 'PENDING') THEN
        RAISE EXCEPTION '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–∫–∞–∑–µ!';
    END IF;
    RETURN OLD;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_protect_product BEFORE DELETE ON products FOR EACH ROW EXECUTE FUNCTION fn_prevent_product_delete();

-- 7. –¢—Ä–∏–≥–≥–µ—Ä: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ (isAvailable = false) –µ—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ 0
CREATE OR REPLACE FUNCTION fn_auto_hide_product() RETURNS TRIGGER AS $$
BEGIN
    IF get_total_stock(NEW.product_id) <= 0 THEN
        UPDATE products SET is_available = false WHERE id = NEW.product_id;
    ELSE
        UPDATE products SET is_available = true WHERE id = NEW.product_id;
    END IF;
    RETURN NEW;
END; $$ LANGUAGE plpgsql;
CREATE TRIGGER trg_stock_availability AFTER UPDATE ON stocks FOR EACH ROW EXECUTE FUNCTION fn_auto_hide_product();
</file>

<file path="prisma/migrations/20260201000000_fix_stock_availability_trigger/migration.sql">
-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è —Ç–æ–≤–∞—Ä–æ–≤
-- –¢—Ä–∏–≥–≥–µ—Ä –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ INSERT, UPDATE –∏ DELETE –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ stocks

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS trg_stock_availability ON stocks;

-- –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å INSERT, UPDATE –∏ DELETE
CREATE OR REPLACE FUNCTION fn_auto_hide_product() RETURNS TRIGGER AS $$
DECLARE
    v_product_id INT;
    v_total_stock INT;
BEGIN
    -- –û–ø—Ä–µ–¥–µ–ª—è–µ–º product_id –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
    IF TG_OP = 'DELETE' THEN
        v_product_id := OLD.product_id;
    ELSE
        v_product_id := NEW.product_id;
    END IF;
    
    -- –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–∞—Ö
    SELECT COALESCE(SUM(quantity), 0) INTO v_total_stock
    FROM stocks
    WHERE product_id = v_product_id;
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞
    IF v_total_stock <= 0 THEN
        UPDATE products SET is_available = false WHERE id = v_product_id;
    ELSE
        UPDATE products SET is_available = true WHERE id = v_product_id;
    END IF;
    
    -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
    IF TG_OP = 'DELETE' THEN
        RETURN OLD;
    ELSE
        RETURN NEW;
    END IF;
END; $$ LANGUAGE plpgsql;

-- –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
CREATE TRIGGER trg_stock_availability_after_insert
    AFTER INSERT ON stocks
    FOR EACH ROW
    EXECUTE FUNCTION fn_auto_hide_product();

CREATE TRIGGER trg_stock_availability_after_update
    AFTER UPDATE ON stocks
    FOR EACH ROW
    EXECUTE FUNCTION fn_auto_hide_product();

CREATE TRIGGER trg_stock_availability_after_delete
    AFTER DELETE ON stocks
    FOR EACH ROW
    EXECUTE FUNCTION fn_auto_hide_product();
</file>

<file path="prisma/migrations/migration_lock.toml">
# Please do not edit this file manually
# It should be added in your version-control system (e.g., Git)
provider = "postgresql"
</file>

<file path="prisma/schema.prisma">
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id               Int            @id @default(autoincrement())
  name             String         @unique
  description      String?
  products         Product[]
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  parentCategoryId Int?           @map("parent_category_id")
  parentCategory   Category?      @relation("CategoryToCategory", fields: [parentCategoryId], references: [id])
  subcategories    Category[]     @relation("CategoryToCategory")
  categoryImage    CategoryImage?

  @@index([parentCategoryId, id])
  @@map("categories")
}

model CategoryImage {
  id         Int      @id @default(autoincrement())
  url        String
  categoryId Int      @unique @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("category_images")
}

model Product {
  id              Int              @id @default(autoincrement())
  name            String
  description     String?
  basePrice       Decimal          @map("base_price") @db.Decimal(10, 2)
  categoryId      Int              @map("category_id")
  category        Category         @relation(fields: [categoryId], references: [id])
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  images          ProductImage[]
  isAvailable     Boolean          @default(true) @map("is_available")
  averageRating   Decimal          @map("average_rating") @db.Decimal(3, 2)
  stocks          Stock[]
  cartItems       CartItem[]
  orderItems      OrderItem[]
  reviews         Review[]
  attributeValues AttributeValue[]
  hasVariants     Boolean          @default(false) @map("has_variants")
  productVariants ProductVariant[]

  @@map("products")
}

model Attribute {
  id              Int              @id @default(autoincrement())
  name            String
  value           String
  attributeValues AttributeValue[]

  @@map("attributes")
}

model AttributeValue {
  id                     Int                     @id @default(autoincrement())
  attributeId            Int                     @map("attribute_id")
  productId              Int                     @map("product_id")
  attribute              Attribute               @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  product                Product                 @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantAttributeValues VariantAttributeValue[]

  @@unique([attributeId, productId])
  @@map("attribute_values")
}

model ProductVariant {
  id                     Int                     @id @default(autoincrement())
  productId              Int                     @map("product_id")
  name                   String
  additionalPrice        Decimal                 @map("additional_price") @db.Decimal(10, 2)
  product                Product                 @relation(fields: [productId], references: [id], onDelete: Cascade)
  stock                  Int                     @default(0)
  price                  Decimal                 @db.Decimal(10, 2)
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  variantAttributeValues VariantAttributeValue[]

  @@map("product_variants")
}

model VariantAttributeValue {
  id               Int            @id @default(autoincrement())
  productVariantId Int            @map("product_variant_id")
  attributeValueId Int            @map("attribute_value_id")
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id], onDelete: Cascade)
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id], onDelete: Cascade)

  @@unique([productVariantId, attributeValueId])
  @@map("variant_attribute_values")
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  url       String
  productId Int      @map("product_id")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isPrimary Boolean  @default(false)

  @@map("product_images")
}

model Warehouse {
  id        Int                @id @default(autoincrement())
  location  String
  name      String
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  stocks    Stock[]
  workers   WarehouseWorker[]

  @@map("warehouses")
}

model Stock {
  id          Int       @id @default(autoincrement())
  productId   Int       @map("product_id")
  warehouseId Int       @map("warehouse_id")
  quantity    Int
  product     Product   @relation(fields: [productId], references: [id])
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@unique([productId, warehouseId])
  @@map("stocks")
}

model WarehouseWorker {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  warehouseId Int       @map("warehouse_id")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@unique([userId, warehouseId])
  @@map("warehouse_workers")
}

//–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Ä–æ–ª–∏
model User {
  id             Int                @id @default(autoincrement())
  email          String             @unique
  password       String
  role           Role               @default(USER)
  firstName      String?            @map("first_name")
  lastName       String?            @map("last_name")
  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")
  avatarUrl      String?            @map("avatar_url")
  addresses      Address[]
  cart           Cart?
  orders         Order[]
  reviews        Review[]
  paymentMethods PaymentMethod[]
  auditLogs      AuditLog[]
  totalSpent     Decimal            @default(0) @map("total_spent") @db.Decimal(10, 2)
  warehouseWorkers WarehouseWorker[]

  @@map("users")
}

enum Role {
  ADMIN
  USER
  ANALYTICS
  WAREHOUSE_WORKER
}

model Address {
  id       Int    @id @default(autoincrement())
  street   String
  city     String
  postCode String @map("post_code")
  userId   Int    @map("user_id")
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

//________________________________________________
//–ö–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã
model Cart {
  id     Int  @id @default(autoincrement())
  userId Int  @unique @map("user_id")
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  items CartItem[]

  @@map("carts")
}

model CartItem {
  id        Int     @id @default(autoincrement())
  cartId    Int     @map("cart_id")
  productId Int     @map("product_id")
  quantity  Int
  cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
  @@map("cart_items")
}

//–ó–∞–∫–∞–∑—ã
model Order {
  id              Int            @id @default(autoincrement())
  userId          Int            @map("user_id")
  user            User           @relation(fields: [userId], references: [id])
  totalPrice      Decimal        @map("total_price") @db.Decimal(10, 2)
  status          OrderStatus    @default(PENDING)
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  // –°–≤—è–∑—å —Å –∞–¥—Ä–µ—Å–æ–º (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
  addressId       Int?           @map("address_id")
  // –¢–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–µ–ø–æ–∫ –∞–¥—Ä–µ—Å–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)
  deliveryCity    String         @map("delivery_city")
  deliveryStreet  String         @map("delivery_street")
  orderItems      OrderItem[]
  promocodeId     Int?           @map("promocode_id")
  promocode       Promocode?     @relation(fields: [promocodeId], references: [id])
  paymentMethodId Int?           @map("payment_method_id")
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  @@map("orders")
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELED
}

model OrderItem {
  id              Int     @id @default(autoincrement())
  orderId         Int     @map("order_id")
  productId       Int     @map("product_id")
  quantity        Int
  priceAtPurchase Decimal @db.Decimal(10, 2)
  order           Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

//–õ–æ—è–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø–ª–∞—Ç–∞ + –æ—Ç–∑—ã–≤—ã
model Review {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  productId Int      @map("product_id")
  rating    Int
  comment   String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, productId])
  @@map("reviews")
}

model Promocode {
  id         Int      @id @default(autoincrement())
  code       String   @unique
  discount   Decimal  @db.Decimal(5, 2)
  validFrom  DateTime @map("valid_from")
  validUntil DateTime @map("valid_until")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  orders     Order[]

  @@map("promocodes")
}

model PaymentMethod {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  type      String
  details   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  orders    Order[]

  @@map("payment_methods")
}

//–õ–æ–≥–∏
model AuditLog {
  id         Int      @id @default(autoincrement())
  userId     Int?     @map("user_id")
  action     String
  timestamp  DateTime @default(now())
  user       User?    @relation(fields: [userId], references: [id])
  entityId   Int?     @map("entity_id")
  entityType String?  @map("entity_type")
  details    String?

  @@map("audit_logs")
}
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="src/app/[product]/page.tsx">
export default function ProductPage() {
	return <div>Product Page</div>
}
</file>

<file path="src/app/admin/dashboard/analytics/components/CustomersTab.tsx">
'use client'

import { LineChartComponent } from '@/components/charts/ChartComponents'
import { DataTable } from '@/components/charts/DataTable'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import {
	getAboveAverageSpendersAction,
	getActiveReviewersAction,
	getUserRegistrationDynamicsAction,
} from '@/server-actions/analytics.action'
import { useEffect, useState } from 'react'

export default function CustomersTab() {
	const [loading, setLoading] = useState(true)
	const [data, setData] = useState<any>({})

	useEffect(() => {
		const loadData = async () => {
			try {
				const [spenders, dynamics, reviewers] = await Promise.all([
					getAboveAverageSpendersAction(),
					getUserRegistrationDynamicsAction(),
					getActiveReviewersAction(),
				])
				setData({ spenders, dynamics, reviewers })
			} finally {
				setLoading(false)
			}
		}
		loadData()
	}, [])

	if (loading)
		return <div className='p-8 text-center'>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö...</div>

	return (
		<div className='grid gap-6'>
			<Card>
				<CardHeader>
					<CardTitle>–î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π</CardTitle>
				</CardHeader>
				<CardContent>
					<LineChartComponent
						data={
							data.dynamics?.map((item: any) => ({
								month: new Date(item.month).toLocaleDateString('ru-RU', {
									month: 'short',
									year: 'numeric',
								}),
								users: parseInt(item.new_users),
							})) || []
						}
						dataKey='users'
						nameKey='month'
						title=''
					/>
				</CardContent>
			</Card>

			<div className='grid grid-cols-1 lg:grid-cols-2 gap-4'>
				<Card>
					<CardHeader>
						<CardTitle>–¢–æ–ø –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (–≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ)</CardTitle>
					</CardHeader>
					<CardContent>
						<DataTable
							data={data.spenders || []}
							columns={[
								{ key: 'first_name', label: '–ò–º—è' },
								{ key: 'total_spent', label: '–ü–æ—Ç—Ä–∞—á–µ–Ω–æ (‚ÇΩ)' },
							]}
						/>
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<CardTitle>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—Ü–µ–Ω–∑–µ–Ω—Ç—ã</CardTitle>
					</CardHeader>
					<CardContent>
						<DataTable
							data={data.reviewers || []}
							columns={[
								{ key: 'email', label: 'Email' },
								{ key: 'review_count', label: '–û—Ç–∑—ã–≤–æ–≤' },
							]}
						/>
					</CardContent>
				</Card>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/analytics/components/OverviewTab.tsx">
'use client'

import {
	LineChartComponent,
	PieChartComponent,
} from '@/components/charts/ChartComponents'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import {
	getAverageOrderValueAction,
	getDashboardStatsAction,
	getOrderStatusDistributionAction,
	getOrdersTrendLastMonthAction,
	getPromoUsagePercentAction,
} from '@/server-actions/analytics.action'
import { DollarSign, ShoppingCart } from 'lucide-react'
import { useEffect, useState } from 'react'

export default function OverviewTab() {
	const [loading, setLoading] = useState(true)
	const [data, setData] = useState<any>({})

	useEffect(() => {
		const loadData = async () => {
			setLoading(true)
			try {
				const [stats, avgValue, promo, trend, status] = await Promise.all([
					getDashboardStatsAction(),
					getAverageOrderValueAction(),
					getPromoUsagePercentAction(),
					getOrdersTrendLastMonthAction(),
					getOrderStatusDistributionAction(),
				])

				setData({
					stats,
					avgValue: avgValue?.[0],
					promo: promo?.[0],
					trend,
					status,
				})
			} catch (error) {
				console.error('Failed to load overview data', error)
			} finally {
				setLoading(false)
			}
		}

		loadData()
	}, [])

	if (loading) {
		return (
			<div className='h-40 flex items-center justify-center text-muted-foreground'>
				–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–∑–æ—Ä–∞...
			</div>
		)
	}

	return (
		<div className='space-y-6'>
			{/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Å—Ç–∏–ª–µ shadcn */}
			<div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4'>
				<Card>
					<CardHeader className='flex flex-row items-center justify-between pb-2'>
						<CardTitle className='text-sm font-medium'>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</CardTitle>
						<ShoppingCart className='w-4 h-4 text-muted-foreground' />
					</CardHeader>
					<CardContent>
						<div className='text-2xl font-bold'>
							{data.stats?.totalOrders || 0}
						</div>
					</CardContent>
				</Card>

				<Card>
					<CardHeader className='flex flex-row items-center justify-between pb-2'>
						<CardTitle className='text-sm font-medium'>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</CardTitle>
						<DollarSign className='w-4 h-4 text-muted-foreground' />
					</CardHeader>
					<CardContent>
						<div className='text-2xl font-bold'>
							‚ÇΩ{Number(data.stats?.totalRevenue || 0).toLocaleString('ru-RU')}
						</div>
					</CardContent>
				</Card>
				{/* –î–æ–±–∞–≤—å –µ—â–µ –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∏ –ü—Ä–æ–º–æ–∫–æ–¥—ã) –ø–æ —ç—Ç–æ–º—É –∂–µ —à–∞–±–ª–æ–Ω—É */}
			</div>

			{/* –ì—Ä–∞—Ñ–∏–∫–∏ */}
			<div className='grid grid-cols-1 lg:grid-cols-2 gap-4'>
				<Card>
					<CardHeader>
						<CardTitle>–¢—Ä–µ–Ω–¥ –∑–∞–∫–∞–∑–æ–≤</CardTitle>
					</CardHeader>
					<CardContent>
						<LineChartComponent
							data={
								data.trend?.map((item: any) => ({
									date: new Date(item.date).toLocaleDateString('ru-RU'),
									count: parseInt(item.count),
								})) || []
							}
							dataKey='count'
							nameKey='date'
							title='' // –£–±–∏—Ä–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞—Ñ–∏–∫–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –µ—Å—Ç—å –≤ CardTitle
						/>
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<CardTitle>–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤</CardTitle>
					</CardHeader>
					<CardContent>
						<PieChartComponent
							data={
								data.status?.map((item: any) => ({
									name: item.status,
									value: parseInt(item.count),
								})) || []
							}
							dataKey='value'
							nameKey='name'
							title=''
						/>
					</CardContent>
				</Card>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/analytics/components/ProductsTab.tsx">
'use client'

import { BarChartComponent } from '@/components/charts/ChartComponents'
import { DataTable } from '@/components/charts/DataTable'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import {
	getAverageRatingByCategoryAction,
	getTopRatedProductsAction,
	getUnorderedProductsAction,
} from '@/server-actions/analytics.action'
import { useEffect, useState } from 'react'

export default function ProductsTab() {
	const [loading, setLoading] = useState(true)
	const [data, setData] = useState<any>({})

	useEffect(() => {
		const loadData = async () => {
			try {
				const [topRated, unordered, ratings] = await Promise.all([
					getTopRatedProductsAction(),
					getUnorderedProductsAction(),
					getAverageRatingByCategoryAction(),
				])
				setData({ topRated, unordered, ratings })
			} finally {
				setLoading(false)
			}
		}
		loadData()
	}, [])

	if (loading)
		return <div className='p-8 text-center'>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö...</div>

	return (
		<div className='grid gap-6'>
			<Card>
				<CardHeader>
					<CardTitle>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</CardTitle>
				</CardHeader>
				<CardContent>
					<BarChartComponent
						data={
							data.ratings?.map((item: any) => ({
								name: item.category_name,
								rating: parseFloat(item.average_rating),
							})) || []
						}
						dataKey='rating'
						nameKey='name'
						title=''
					/>
				</CardContent>
			</Card>

			<div className='grid grid-cols-1 lg:grid-cols-2 gap-4'>
				<Card>
					<CardHeader>
						<CardTitle>–¢–æ–≤–∞—Ä—ã —Å –ª—É—á—à–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º</CardTitle>
					</CardHeader>
					<CardContent>
						<DataTable
							data={data.topRated || []}
							columns={[
								{ key: 'name', label: '–¢–æ–≤–∞—Ä' },
								{ key: 'average_rating', label: '–†–µ–π—Ç–∏–Ω–≥' },
							]}
						/>
					</CardContent>
				</Card>

				<Card>
					<CardHeader>
						<CardTitle>–ù–µ–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (0 –∑–∞–∫–∞–∑–æ–≤)</CardTitle>
					</CardHeader>
					<CardContent>
						<DataTable
							data={data.unordered || []}
							columns={[{ key: 'name', label: '–ù–∞–∑–≤–∞–Ω–∏–µ' }]}
						/>
					</CardContent>
				</Card>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/analytics/components/RevenueTab.tsx">
'use client'

import {
	BarChartComponent,
	LineChartComponent,
} from '@/components/charts/ChartComponents'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import {
	getMonthlyRevenueAction,
	getTopCategoriesByRevenueAction,
} from '@/server-actions/analytics.action'
import { useEffect, useState } from 'react'

export default function RevenueTab() {
	const [loading, setLoading] = useState(true)
	const [data, setData] = useState<any>({})

	useEffect(() => {
		const loadData = async () => {
			try {
				const [monthly, categories] = await Promise.all([
					getMonthlyRevenueAction(),
					getTopCategoriesByRevenueAction(),
				])
				setData({ monthly, categories })
			} finally {
				setLoading(false)
			}
		}
		loadData()
	}, [])

	if (loading)
		return <div className='p-8 text-center'>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—ã—Ä—É—á–∫–µ...</div>

	return (
		<div className='grid gap-6'>
			<Card>
				<CardHeader>
					<CardTitle>–î–∏–Ω–∞–º–∏–∫–∞ –≤—ã—Ä—É—á–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</CardTitle>
				</CardHeader>
				<CardContent>
					<LineChartComponent
						data={
							data.monthly?.map((item: any) => ({
								month: new Date(item.month).toLocaleDateString('ru-RU', {
									month: 'long',
									year: 'numeric',
								}),
								revenue: parseFloat(item.revenue),
							})) || []
						}
						dataKey='revenue'
						nameKey='month'
						title=''
					/>
				</CardContent>
			</Card>

			<Card>
				<CardHeader>
					<CardTitle>–¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –≤—ã—Ä—É—á–∫–µ</CardTitle>
				</CardHeader>
				<CardContent>
					<BarChartComponent
						data={
							data.categories?.map((item: any) => ({
								name: item.name,
								–≤—ã—Ä—É—á–∫–∞: parseFloat(item.revenue),
							})) || []
						}
						dataKey='–≤—ã—Ä—É—á–∫–∞'
						nameKey='name'
						title=''
					/>
				</CardContent>
			</Card>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/analytics/page.tsx">
'use client'

import { Button } from '@/components/ui/button'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { BarChart3, Download, Package, ShoppingCart, Users } from 'lucide-react'
import CustomersTab from './components/CustomersTab'
import OverviewTab from './components/OverviewTab' // –ü—É—Ç–∏ –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –ø–æ–ø—Ä–∞–≤–∏—à—å –ø–æ–¥ —Å–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
import ProductsTab from './components/ProductsTab'
import RevenueTab from './components/RevenueTab'

export default function AnalyticsPage() {
	const handleExport = (format: 'csv' | 'json' | 'pdf') => {
		// TODO: Implement export functionality
		console.log(`Export to ${format} clicked`)
	}

	return (
		<div className='flex flex-col gap-6 p-8'>
			<div className='flex justify-between items-center'>
				<div>
					<h1 className='text-3xl font-bold tracking-tight'>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
					<p className='text-muted-foreground mt-2'>
						–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º, –∫–ª–∏–µ–Ω—Ç–∞–º –∏ —Ç–æ–≤–∞—Ä–∞–º.
					</p>
				</div>
				<div className='flex gap-2'>
					<Button
						variant='outline'
						size='sm'
						onClick={() => handleExport('csv')}
					>
						<Download className='w-4 h-4 mr-2' /> CSV
					</Button>
					{/* –û—Å—Ç–∞–≤–∏–º –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ CSV –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—à—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ */}
				</div>
			</div>

			<Tabs defaultValue='overview' className='space-y-4'>
				<TabsList className='flex w-full justify-start overflow-x-auto'>
					<TabsTrigger value='overview' className='flex gap-2'>
						<BarChart3 className='w-4 h-4' /> –û–±–∑–æ—Ä
					</TabsTrigger>
					<TabsTrigger value='revenue' className='flex gap-2'>
						<ShoppingCart className='w-4 h-4' /> –í—ã—Ä—É—á–∫–∞
					</TabsTrigger>
					<TabsTrigger value='customers' className='flex gap-2'>
						<Users className='w-4 h-4' /> –ö–ª–∏–µ–Ω—Ç—ã
					</TabsTrigger>
					<TabsTrigger value='products' className='flex gap-2'>
						<Package className='w-4 h-4' /> –¢–æ–≤–∞—Ä—ã
					</TabsTrigger>
					{/* –î–æ–±–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ */}
				</TabsList>

				<TabsContent value='overview' className='space-y-4'>
					<OverviewTab />
				</TabsContent>

				<TabsContent value='revenue' className='space-y-4'>
					<RevenueTab />
				</TabsContent>

				<TabsContent value='customers' className='space-y-4'>
					<CustomersTab />
				</TabsContent>

				<TabsContent value='products' className='space-y-4'>
					<ProductsTab />
				</TabsContent>
			</Tabs>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/categories/page.tsx">
import AddCategoryButton from '@/components/AddCategoryButton'
import { CategorySocketPicker } from '@/components/CategorySocketPicker'
import { DeleteCategoryButton } from '@/components/DeleteCategoryButton'
import { Badge } from '@/components/ui/badge'
import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'
import { categoryService } from '@/services/categories.service'
import { FolderTree, Image as ImageIcon, Layers } from 'lucide-react'
import Image from 'next/image'

export default async function CategoriesPage() {
	const data = await categoryService.getAll()

	// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–º–µ–Ω–∏ —Ä–æ–¥–∏—Ç–µ–ª—è
	const getParentName = (parentId: number | null) => {
		if (!parentId) return null
		return data.find(c => c.id === parentId)?.name
	}

	return (
		<div className='space-y-6 p-6'>
			<CategorySocketPicker />

			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
					<p className='text-muted-foreground'>
						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
					</p>
				</div>
				<AddCategoryButton categ={data} />
			</div>

			<div className='rounded-md border bg-card'>
				<Table>
					<TableHeader>
						<TableRow className='bg-muted/50'>
							<TableHead className='w-[100px]'>–§–æ—Ç–æ</TableHead>
							<TableHead>–ù–∞–∑–≤–∞–Ω–∏–µ</TableHead>
							<TableHead>–¢–∏–ø</TableHead>
							<TableHead>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</TableHead>
							<TableHead className='text-right'>–î–µ–π—Å—Ç–≤–∏—è</TableHead>
						</TableRow>
					</TableHeader>
					<TableBody>
						{data.length === 0 ? (
							<TableRow>
								<TableCell colSpan={5} className='h-24 text-center'>
									–ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.
								</TableCell>
							</TableRow>
						) : (
							data.map(item => {
								const hasChildren = data.some(
									c => c.parentCategoryId === item.id,
								)
								return (
									<TableRow
										key={item.id}
										className='hover:bg-muted/50 transition-colors'
									>
										<TableCell>
											<div className='relative h-12 w-12 overflow-hidden rounded-lg border bg-muted'>
												{item.categoryImage?.url ? (
													<Image
														src={item.categoryImage.url}
														alt={item.name}
														fill
														className='object-cover'
													/>
												) : (
													<div className='flex h-full w-full items-center justify-center'>
														<ImageIcon className='h-6 w-6 text-muted-foreground/50' />
													</div>
												)}
											</div>
										</TableCell>
										<TableCell>
											<div className='flex flex-col'>
												<span className='font-semibold'>{item.name}</span>
												{item.description && (
													<span className='text-xs text-muted-foreground line-clamp-1'>
														{item.description}
													</span>
												)}
											</div>
										</TableCell>
										<TableCell>
											{item.parentCategoryId ? (
												<Badge variant='outline' className='font-normal'>
													<Layers className='mr-1 h-3 w-3' /> –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
												</Badge>
											) : (
												<Badge variant='secondary' className='font-normal'>
													<FolderTree className='mr-1 h-3 w-3' /> –ö–æ—Ä–Ω–µ–≤–∞—è
												</Badge>
											)}
										</TableCell>
										<TableCell>
											{item.parentCategoryId ? (
												<span className='text-sm text-medium'>
													{getParentName(item.parentCategoryId)}
												</span>
											) : (
												<span className='text-sm text-muted-foreground italic'>
													‚Äî
												</span>
											)}
										</TableCell>
										<TableCell className='text-right'>
											<div className='flex justify-end gap-2'>
												<AddCategoryButton categ={data} categoryToEdit={item} />

												{/* –¢–µ–ø–µ—Ä—å hasChildren –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏ –æ—à–∏–±–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç */}
												<DeleteCategoryButton
													categoryId={item.id}
													categoryName={item.name}
													hasSubcategories={hasChildren}
												/>
											</div>
										</TableCell>
									</TableRow>
								)
							})
						)}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/layout.tsx">
import AppSidebar from '@/components/AppSidebar'
import { SidebarProvider, SidebarTrigger } from '@/components/ui/sidebar'
import { Toaster } from 'sonner'

export default function DashboardLayout({
	children,
}: Readonly<{
	children: React.ReactNode
}>) {
	return (
		<SidebarProvider>
			<AppSidebar />
			{/* 2. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
			<main className='relative flex-1 flex flex-col min-h-screen'>
				{/* –•–µ–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≥–¥–µ –∂–∏–≤–µ—Ç –∫–Ω–æ–ø–∫–∞ */}
				<header className='flex h-16 items-center gap-2 border-b px-4'>
					<SidebarTrigger className='-ml-1' />
					{/* -ml-1 —á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–æ–¥–≤–∏–Ω–µ—Ç –∫–Ω–æ–ø–∫—É –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */}
					<div className='h-4 w-[1px] bg-border mx-2' />
					<h1 className='text-sm font-medium'>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
					<div className='flex items-center gap-4'></div>
				</header>

				{/* –°–∞–º–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */}
				<div className='p-4 flex-1'>{children}</div>
				<Toaster position='top-center' richColors />
			</main>
		</SidebarProvider>
	)
}
</file>

<file path="src/app/admin/dashboard/orders/[id]/page.tsx">
import { CancelOrderButton } from '@/components/CancelOrderButton'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { UpdateOrderStatusButton } from '@/components/UpdateOrderStatusButton'
import { formatDateTime } from '@/lib/date-utils'
import { orderService } from '@/services/orders.service'
import { ArrowLeft, DollarSign, MapPin, ShoppingCart, User } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import { notFound } from 'next/navigation'

interface OrderDetailsPageProps {
	params: {
		id: string
	}
}

export default async function OrderDetailsPage({
	params,
}: OrderDetailsPageProps) {
	const orderId = parseInt(params.id, 10)
	if (isNaN(orderId)) {
		notFound()
	}

	const order = await orderService.getById(orderId)
	if (!order) {
		notFound()
	}

	const canCancel = order.status === 'PENDING' || order.status === 'PROCESSING'

	return (
		<div className='space-y-6 p-6'>
			<Link href='/admin/dashboard/orders'>
				<Button variant='outline' size='sm'>
					<ArrowLeft className='h-4 w-4 mr-2' />
					–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
				</Button>
			</Link>

			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>
						–ó–∞–∫–∞–∑ #{order.id}
					</h2>
					<p className='text-muted-foreground'>
						{formatDateTime(order.createdAt)}
					</p>
				</div>
				<div className='flex gap-2'>
					<UpdateOrderStatusButton
						orderId={order.id}
						currentStatus={order.status}
					/>
					<CancelOrderButton orderId={order.id} canCancel={canCancel} />
				</div>
			</div>

			<div className='grid gap-6 md:grid-cols-3'>
				{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ */}
				<Card>
					<CardHeader>
						<CardTitle className='flex items-center gap-2'>
							<User className='h-5 w-5' />
							–ö–ª–∏–µ–Ω—Ç
						</CardTitle>
					</CardHeader>
					<CardContent className='space-y-2'>
						<div>
							<p className='text-sm text-muted-foreground'>–§–ò–û</p>
							<p className='font-medium'>
								{order.user.firstName} {order.user.lastName}
							</p>
						</div>
						<div>
							<p className='text-sm text-muted-foreground'>Email</p>
							<p className='font-medium'>{order.user.email}</p>
						</div>
						<div>
							<p className='text-sm text-muted-foreground'>–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</p>
							<p className='font-medium'>
								{Number(order.user.totalSpent).toFixed(2)} BYN
							</p>
						</div>
					</CardContent>
				</Card>

				{/* –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ */}
				<Card>
					<CardHeader>
						<CardTitle className='flex items-center gap-2'>
							<MapPin className='h-5 w-5' />
							–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
						</CardTitle>
					</CardHeader>
					<CardContent className='space-y-2'>
						<div>
							<p className='text-sm text-muted-foreground'>–ì–æ—Ä–æ–¥</p>
							<p className='font-medium'>{order.deliveryCity}</p>
						</div>
						<div>
							<p className='text-sm text-muted-foreground'>–£–ª–∏—Ü–∞</p>
							<p className='font-medium'>{order.deliveryStreet}</p>
						</div>
					</CardContent>
				</Card>

				{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ */}
				<Card>
					<CardHeader>
						<CardTitle className='flex items-center gap-2'>
							<DollarSign className='h-5 w-5' />
							–ü–ª–∞—Ç–µ–∂
						</CardTitle>
					</CardHeader>
					<CardContent className='space-y-2'>
						<div>
							<p className='text-sm text-muted-foreground'>–°—É–º–º–∞</p>
							<p className='text-2xl font-bold'>
								{Number(order.totalPrice).toFixed(2)} BYN
							</p>
						</div>
						{order.promocode && (
							<div>
								<p className='text-sm text-muted-foreground'>–ü—Ä–æ–º–æ–∫–æ–¥</p>
								<p className='font-medium'>
									{order.promocode.code} ({Number(order.promocode.discount)}%)
								</p>
							</div>
						)}
						{order.paymentMethod && (
							<div>
								<p className='text-sm text-muted-foreground'>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</p>
								<p className='font-medium'>{order.paymentMethod.type}</p>
							</div>
						)}
					</CardContent>
				</Card>
			</div>

			{/* –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ */}
			<Card>
				<CardHeader>
					<CardTitle className='flex items-center gap-2'>
						<ShoppingCart className='h-5 w-5' />
						–¢–æ–≤–∞—Ä—ã ({(order.orderItems as any[])?.length || 0})
					</CardTitle>
				</CardHeader>
				<CardContent>
					<div className='space-y-4'>
						{order.orderItems &&
							(order.orderItems as any[]).map((item: any) => (
								<div
									key={item.id}
									className='flex gap-4 pb-4 border-b last:border-b-0'
								>
									{/* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ */}
									<div className='relative h-24 w-24 shrink-0 overflow-hidden rounded-lg border bg-muted'>
										{item.product.images && item.product.images.length > 0 ? (
											<Image
												src={item.product.images[0].url}
												alt={item.product.name}
												fill
												className='object-cover'
											/>
										) : (
											<div className='flex h-full w-full items-center justify-center'>
												<ShoppingCart className='h-6 w-6 text-muted-foreground/50' />
											</div>
										)}
									</div>

									{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ */}
									<div className='flex-1'>
										<Link
											href={`/admin/dashboard/products`}
											className='text-lg font-semibold hover:underline'
										>
											{item.product.name}
										</Link>
										<p className='text-sm text-muted-foreground'>
											{item.product.description}
										</p>
										<div className='mt-2 flex gap-4'>
											<div>
												<p className='text-sm text-muted-foreground'>
													–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
												</p>
												<p className='font-medium'>{item.quantity}</p>
											</div>
											<div>
												<p className='text-sm text-muted-foreground'>–¶–µ–Ω–∞</p>
												<p className='font-medium'>
													{Number(item.priceAtPurchase).toFixed(2)} BYN
												</p>
											</div>
											<div>
												<p className='text-sm text-muted-foreground'>–°—É–º–º–∞</p>
												<p className='font-bold'>
													{(
														Number(item.priceAtPurchase) * item.quantity
													).toFixed(2)}{' '}
													BYN
												</p>
											</div>
										</div>
									</div>
								</div>
							))}
					</div>

					{/* –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}
					<div className='mt-6 border-t pt-4 flex justify-end'>
						<div className='w-full max-w-xs space-y-2'>
							<div className='flex justify-between text-sm'>
								<span className='text-muted-foreground'>–ü–æ–¥–∏—Ç–æ–≥:</span>
								<span>{Number(order.totalPrice).toFixed(2)} BYN</span>
							</div>
							{order.promocode && (
								<div className='flex justify-between text-sm text-green-600'>
									<span>–°–∫–∏–¥–∫–∞ ({Number(order.promocode.discount)}%):</span>
									<span>
										-
										{(
											(Number(order.totalPrice) *
												Number(order.promocode.discount)) /
											100
										).toFixed(2)}{' '}
										BYN
									</span>
								</div>
							)}
							<div className='flex justify-between text-lg font-bold border-t pt-2'>
								<span>–ò—Ç–æ–≥–æ:</span>
								<span>{Number(order.totalPrice).toFixed(2)} BYN</span>
							</div>
						</div>
					</div>
				</CardContent>
			</Card>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/orders/page.tsx">
import { AdminCreateOrderButton } from '@/components/AdminCreateOrderButton'
import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'
import { UpdateOrderStatusButton } from '@/components/UpdateOrderStatusButton'
import { formatDateShort } from '@/lib/date-utils'
import { prisma } from '@/lib/prisma'
import { orderService } from '@/services/orders.service'
import { DollarSign, ShoppingCart } from 'lucide-react'
import Link from 'next/link'

export default async function OrdersPage() {
	// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã
	const orders = await orderService.getAll()
	const stats = await orderService.getStatistics()

	// –ü–æ–ª—É—á–∞–µ–º –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é USER)
	const users = await prisma.user.findMany({
		where: { role: 'USER' },
		include: {
			addresses: true,
		},
		orderBy: {
			createdAt: 'desc',
		},
	})

	// –ü–æ–ª—É—á–∞–µ–º —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
	const paymentMethods = await prisma.paymentMethod.findMany()

	return (
		<div className='space-y-6 p-6'>
			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>–ó–∞–∫–∞–∑—ã</h2>
					<p className='text-muted-foreground'>
						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤.
					</p>
				</div>
				<AdminCreateOrderButton users={users} paymentMethods={paymentMethods} />
			</div>

			{/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
			<div className='grid gap-4 md:grid-cols-4'>
				<div className='rounded-lg border bg-card p-4'>
					<div className='flex items-center justify-between'>
						<div>
							<p className='text-sm text-muted-foreground'>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
							<p className='text-2xl font-bold'>{stats.totalOrders}</p>
						</div>
						<ShoppingCart className='h-8 w-8 text-muted-foreground/50' />
					</div>
				</div>

				<div className='rounded-lg border bg-card p-4'>
					<div className='flex items-center justify-between'>
						<div>
							<p className='text-sm text-muted-foreground'>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</p>
							<p className='text-2xl font-bold'>
								{Number(stats.totalRevenue).toFixed(2)} BYN
							</p>
						</div>
						<DollarSign className='h-8 w-8 text-muted-foreground/50' />
					</div>
				</div>

				<div className='rounded-lg border bg-card p-4'>
					<div className='flex items-center justify-between'>
						<div>
							<p className='text-sm text-muted-foreground'>–°—Ä–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</p>
							<p className='text-2xl font-bold'>
								{Number(stats.averageOrderValue).toFixed(2)} BYN
							</p>
						</div>
						<DollarSign className='h-8 w-8 text-muted-foreground/50' />
					</div>
				</div>

				<div className='rounded-lg border bg-card p-4'>
					<div>
						<p className='text-sm text-muted-foreground mb-2'>–ü–æ —Å—Ç–∞—Ç—É—Å–∞–º</p>
						<div className='space-y-1'>
							{stats.ordersByStatus.map(status => (
								<div
									key={status.status}
									className='flex justify-between text-xs'
								>
									<span className='text-muted-foreground'>{status.status}</span>
									<span className='font-semibold'>{status._count.id}</span>
								</div>
							))}
						</div>
					</div>
				</div>
			</div>

			{/* –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ */}
			<div className='rounded-md border bg-card'>
				<Table>
					<TableHeader>
						<TableRow className='bg-muted/50'>
							<TableHead className='w-20'>ID</TableHead>
							<TableHead>–ö–ª–∏–µ–Ω—Ç</TableHead>
							<TableHead>–¢–æ–≤–∞—Ä—ã</TableHead>
							<TableHead>–°—É–º–º–∞</TableHead>
							<TableHead>–ê–¥—Ä–µ—Å</TableHead>
							<TableHead>–î–∞—Ç–∞</TableHead>
							<TableHead>–°—Ç–∞—Ç—É—Å</TableHead>
							<TableHead className='text-right'>–î–µ–π—Å—Ç–≤–∏—è</TableHead>
						</TableRow>
					</TableHeader>
					<TableBody>
						{orders.length === 0 ? (
							<TableRow>
								<TableCell
									colSpan={8}
									className='h-24 text-center text-muted-foreground'
								>
									–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.
								</TableCell>
							</TableRow>
						) : (
							orders.map(order => (
								<TableRow
									key={order.id}
									className='hover:bg-muted/50 transition-colors'
								>
									<TableCell className='font-medium'>#{order.id}</TableCell>
									<TableCell>
										<div className='flex flex-col gap-1'>
											<span className='font-medium text-sm'>
												{order.user.firstName} {order.user.lastName}
											</span>
											<span className='text-xs text-muted-foreground'>
												{order.user.email}
											</span>
										</div>
									</TableCell>
									<TableCell>
										<div className='flex flex-col gap-1'>
											{order.orderItems &&
												(order.orderItems as any[]).map((item: any) => (
													<span key={item.id} className='text-xs'>
														{item.product.name} ({item.quantity}x)
													</span>
												))}
											<span className='text-xs text-muted-foreground'>
												{(order.orderItems as any[])?.length || 0} —Ç–æ–≤–∞—Ä–æ–≤
											</span>
										</div>
									</TableCell>
									<TableCell className='font-semibold'>
										{Number(order.totalPrice).toFixed(2)} BYN
									</TableCell>
									<TableCell>
										<div className='flex flex-col gap-1 text-xs'>
											<span>{order.deliveryCity}</span>
											<span className='text-muted-foreground'>
												{order.deliveryStreet}
											</span>
										</div>
									</TableCell>
									<TableCell className='text-sm'>
										{formatDateShort(order.createdAt)}
									</TableCell>
									<TableCell>
										<UpdateOrderStatusButton
											orderId={order.id}
											currentStatus={order.status}
										/>
									</TableCell>
									<TableCell className='text-right'>
										<Link
											href={`/admin/dashboard/orders/${order.id}`}
											className='text-blue-600 hover:underline text-sm'
										>
											–î–µ—Ç–∞–ª–∏
										</Link>
									</TableCell>
								</TableRow>
							))
						)}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/page.tsx">
export default function DashboardPage() {
	return (
		<div className='flex flex-1 flex-col gap-4 p-4 pt-0'>
			<div className='grid auto-rows-min gap-4 md:grid-cols-3'>
				<div className='bg-muted/50 aspect-video rounded-xl' />
				<div className='bg-muted/50 aspect-video rounded-xl' />
				<div className='bg-muted/50 aspect-video rounded-xl' />
			</div>
			<div className='bg-muted/50 min-h-[100vh] flex-1 rounded-xl md:min-h-min' />
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/products/page.tsx">
import AddProductButton from '@/components/AddProductButton'
import { DeleteProductButton } from '@/components/DeleteProductButton'
import { ToggleProductStatusButton } from '@/components/ToggleProductStatusButton'
import { Badge } from '@/components/ui/badge'
import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'
import { categoryService } from '@/services/categories.service'
import { productService } from '@/services/prosuct.service'
import { warehouseService } from '@/services/warehouses.service'
import { Image as ImageIcon, Package, Tag } from 'lucide-react'
import Image from 'next/image'

export default async function ProductsPage() {
	const [products, categories, warehouses] = await Promise.all([
		productService.getAll(),
		categoryService.getAll(),
		warehouseService.getAll(),
	])

	return (
		<div className='space-y-6 p-6'>
			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>–¢–æ–≤–∞—Ä—ã</h2>
					<p className='text-muted-foreground'>
						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏.
					</p>
				</div>
				<AddProductButton categories={categories} warehouses={warehouses} />
			</div>

			<div className='rounded-md border bg-card'>
				<Table>
					<TableHeader>
						<TableRow className='bg-muted/50'>
							<TableHead className='w-[100px]'>–§–æ—Ç–æ</TableHead>
							<TableHead>–ù–∞–∑–≤–∞–Ω–∏–µ</TableHead>
							<TableHead>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</TableHead>
							<TableHead>–¶–µ–Ω–∞</TableHead>
							<TableHead>–û—Å—Ç–∞—Ç–æ–∫</TableHead>
							<TableHead>–°–∫–ª–∞–¥—ã</TableHead>
							<TableHead>–í–∞—Ä–∏–∞–Ω—Ç—ã</TableHead>
							<TableHead>–°—Ç–∞—Ç—É—Å</TableHead>
							<TableHead className='text-right'>–î–µ–π—Å—Ç–≤–∏—è</TableHead>
						</TableRow>
					</TableHeader>
					<TableBody>
						{products.length === 0 ? (
							<TableRow>
								<TableCell
									colSpan={9}
									className='h-24 text-center text-muted-foreground'
								>
									–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.
								</TableCell>
							</TableRow>
						) : (
							products.map((item: any) => {
								// –ë–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ
								const mainImage =
									item.images?.find((img: any) => img.isPrimary) ||
									item.images?.[0]

								// –°—á–∏—Ç–∞–µ–º –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º
								const totalStock = item.stocks?.reduce(
									(sum: number, stock: any) => sum + stock.quantity,
									0,
								) || 0

								// –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤, –≥–¥–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä
								const warehousesWithStock = item.stocks
									?.filter((stock: any) => stock.quantity > 0)
									.map((stock: any) => stock.warehouse)
									.filter(Boolean) || []
								const warehousesCount = warehousesWithStock.length

								// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
								const hasVariants = item.hasVariants || false
								const variantsCount = item.productVariants?.length || 0 // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ
								//const variantsCount = 0 // –ë—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma –∫–ª–∏–µ–Ω—Ç–∞

								return (
									<TableRow
										key={item.id}
										className='hover:bg-muted/50 transition-colors'
									>
										<TableCell>
											<div className='relative h-12 w-12 overflow-hidden rounded-lg border bg-muted'>
												{mainImage?.url ? (
													<Image
														src={mainImage.url}
														alt={item.name}
														fill
														className='object-cover'
													/>
												) : (
													<div className='flex h-full w-full items-center justify-center'>
														<ImageIcon className='h-6 w-6 text-muted-foreground/50' />
													</div>
												)}
											</div>
										</TableCell>
										<TableCell>
											<div className='flex flex-col'>
												<span className='font-semibold'>{item.name}</span>
												{item.description && (
													<span className='text-xs text-muted-foreground line-clamp-1'>
														{item.description}
													</span>
												)}
											</div>
										</TableCell>
										<TableCell>
											<Badge variant='outline'>
												{item.category?.name || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}
											</Badge>
										</TableCell>
										<TableCell>
											<span className='font-medium'>
												{Number(item.basePrice).toLocaleString('ru-RU', {
													minimumFractionDigits: 2,
													maximumFractionDigits: 2,
												})}{' '}
												‚ÇΩ
											</span>
										</TableCell>
										<TableCell>
											<div className='flex items-center gap-1.5'>
												<Package className='h-3.5 w-3.5 text-muted-foreground' />
												<span
													className={
														totalStock <= 5
															? 'text-destructive font-bold'
															: totalStock === 0
																? 'text-muted-foreground'
																: ''
													}
												>
													{totalStock}
												</span>
												{totalStock === 0 && (
													<span className='text-xs text-muted-foreground'>
														(–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏)
													</span>
												)}
											</div>
										</TableCell>
										<TableCell>
											{warehousesCount > 0 ? (
												<div className='flex flex-col gap-1'>
													<Badge variant='outline' className='font-normal w-fit'>
														{warehousesCount}{' '}
														{warehousesCount === 1
															? '—Å–∫–ª–∞–¥'
															: warehousesCount < 5
																? '—Å–∫–ª–∞–¥–∞'
																: '—Å–∫–ª–∞–¥–æ–≤'}
													</Badge>
													{warehousesWithStock.length > 0 && (
														<div className='text-xs text-muted-foreground'>
															{warehousesWithStock
																.map((w: any) => w.name)
																.join(', ')}
														</div>
													)}
												</div>
											) : (
												<span className='text-sm text-muted-foreground italic'>
													‚Äî
												</span>
											)}
										</TableCell>
										<TableCell>
											{hasVariants ? (
												<Badge variant='secondary' className='font-normal'>
													<Tag className='mr-1 h-3 w-3' />
													{variantsCount} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
												</Badge>
											) : (
												<span className='text-sm text-muted-foreground italic'>
													‚Äî
												</span>
											)}
										</TableCell>
										<TableCell>
											{item.isAvailable ? (
												<Badge className='bg-emerald-100 text-emerald-700 hover:bg-emerald-100 border-none shadow-none uppercase text-[10px] font-bold'>
													–î–æ—Å—Ç—É–ø–µ–Ω
												</Badge>
											) : (
												<Badge
													variant='secondary'
													className='uppercase text-[10px] font-bold opacity-70'
												>
													–°–∫—Ä—ã—Ç
												</Badge>
											)}
										</TableCell>
										<TableCell className='text-right'>
											<div className='flex justify-end gap-2'>
												<ToggleProductStatusButton
													productId={item.id}
													isAvailable={item.isAvailable}
												/>
												<AddProductButton
													categories={categories}
													warehouses={warehouses}
													productToEdit={{
														id: item.id,
														name: item.name,
														description: item.description,
														basePrice: Number(item.basePrice),
														categoryId: item.categoryId,
														isAvailable: item.isAvailable,
														hasVariants: item.hasVariants,
														images: item.images,
														variants: item.productVariants?.map((v: any) => ({
															name: v.name,
															additionalPrice: Number(v.additionalPrice),
															stock: v.stock,
															price: Number(v.price),
														})),
														stocks: item.stocks?.map((s: any) => ({
															warehouseId: s.warehouseId,
															quantity: s.quantity,
															warehouse: s.warehouse,
														})),
													}}
												/>
												<DeleteProductButton
													productId={item.id}
													productName={item.name}
												/>
											</div>
										</TableCell>
									</TableRow>
								)
							})
						)}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/users/page.tsx">
import AddUserButton from '@/components/AddUserButton'
import { DeleteUserButton } from '@/components/DeleteUserButton'
import { Badge } from '@/components/ui/badge'
import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'
import { usersService } from '@/services/users.service'
import { Mail, Shield, User } from 'lucide-react'
import Image from 'next/image'

const ROLE_LABELS: Record<string, string> = {
	USER: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
	ADMIN: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
	WAREHOUSE_WORKER: '–†–∞–±–æ—Ç–Ω–∏–∫ —Å–∫–ª–∞–¥–∞',
	ANALYTICS: '–ê–Ω–∞–ª–∏—Ç–∏–∫',
}

const ROLE_COLORS: Record<string, string> = {
	USER: 'bg-blue-100 text-blue-800',
	ADMIN: 'bg-red-100 text-red-800',
	WAREHOUSE_WORKER: 'bg-yellow-100 text-yellow-800',
	ANALYTICS: 'bg-purple-100 text-purple-800',
}

export default async function UsersPage() {
	const users = await usersService.getAll()

	return (
		<div className='space-y-6 p-6'>
			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
					<p className='text-muted-foreground'>
						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏ –∏ –¥–æ—Å—Ç—É–ø–æ–º.
					</p>
				</div>
				<AddUserButton />
			</div>

			<div className='rounded-md border bg-card overflow-hidden'>
				<Table>
					<TableHeader>
						<TableRow className='bg-muted/50'>
							<TableHead className='w-[80px]'>–§–æ—Ç–æ</TableHead>
							<TableHead>Email</TableHead>
							<TableHead>–ò–º—è</TableHead>
							<TableHead>–†–æ–ª—å</TableHead>
							<TableHead>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</TableHead>
							<TableHead className='text-right'>–î–µ–π—Å—Ç–≤–∏—è</TableHead>
						</TableRow>
					</TableHeader>
					<TableBody>
						{users.length === 0 ? (
							<TableRow>
								<TableCell colSpan={6} className='h-24 text-center'>
									<div className='flex flex-col items-center justify-center gap-2 text-muted-foreground'>
										<User className='h-8 w-8 opacity-40' />
										<p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—â–µ –Ω–µ—Ç</p>
									</div>
								</TableCell>
							</TableRow>
						) : (
							users.map(user => (
								<TableRow key={user.id}>
									<TableCell>
										{user.avatarUrl ? (
											<div className='relative w-12 h-12 rounded-lg overflow-hidden'>
												<Image
													src={user.avatarUrl}
													alt={user.email}
													fill
													className='object-cover'
												/>
											</div>
										) : (
											<div className='w-12 h-12 rounded-lg bg-muted flex items-center justify-center'>
												<User className='h-6 w-6 text-muted-foreground' />
											</div>
										)}
									</TableCell>
									<TableCell className='font-medium'>
										<div className='flex items-center gap-2'>
											<Mail className='h-4 w-4 text-muted-foreground' />
											{user.email}
										</div>
									</TableCell>
									<TableCell>
										{user.firstName && user.lastName
											? `${user.firstName} ${user.lastName}`
											: user.firstName || user.lastName || '‚Äî'}
									</TableCell>
									<TableCell>
										<Badge className={ROLE_COLORS[user.role]}>
											<Shield className='mr-1 h-3 w-3' />
											{ROLE_LABELS[user.role]}
										</Badge>
									</TableCell>
									<TableCell className='text-sm text-muted-foreground'>
										{new Date(user.createdAt).toLocaleDateString('ru-RU')}
									</TableCell>
									<TableCell className='text-right'>
										<div className='flex items-center justify-end gap-2'>
											<AddUserButton userToEdit={user} />
											<DeleteUserButton
												userId={user.id}
												userName={
													user.firstName && user.lastName
														? `${user.firstName} ${user.lastName}`
														: user.email
												}
											/>
										</div>
									</TableCell>
								</TableRow>
							))
						)}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}
</file>

<file path="src/app/admin/dashboard/warehouses/page.tsx">
import AddWarehouseButton from '@/components/AddWarehouseButton'
import { DeleteWarehouseButton } from '@/components/DeleteWarehouseButton'
import { ManageWarehouseWorkersButton } from '@/components/ManageWarehouseWorkersButton'
import { Badge } from '@/components/ui/badge'
import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'
import { warehouseService } from '@/services/warehouses.service'
import { MapPin, Package, Users } from 'lucide-react'

export default async function WarehousesPage() {
	const warehouses = await warehouseService.getAll()

	return (
		<div className='space-y-6 p-6'>
			<div className='flex items-center justify-between'>
				<div>
					<h2 className='text-3xl font-bold tracking-tight'>–°–∫–ª–∞–¥—ã</h2>
					<p className='text-muted-foreground'>
						–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞–º–∏ –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
					</p>
				</div>
				<AddWarehouseButton />
			</div>

			<div className='rounded-md border bg-card'>
				<Table>
					<TableHeader>
						<TableRow className='bg-muted/50'>
							<TableHead>–ù–∞–∑–≤–∞–Ω–∏–µ</TableHead>
							<TableHead>–ê–¥—Ä–µ—Å</TableHead>
							<TableHead>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</TableHead>
							<TableHead>–¢–æ–≤–∞—Ä—ã</TableHead>
							<TableHead className='text-right'>–î–µ–π—Å—Ç–≤–∏—è</TableHead>
						</TableRow>
					</TableHeader>
					<TableBody>
						{warehouses.length === 0 ? (
							<TableRow>
								<TableCell
									colSpan={5}
									className='h-24 text-center text-muted-foreground'
								>
									–°–∫–ª–∞–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.
								</TableCell>
							</TableRow>
						) : (
							warehouses.map((warehouse: any) => {
								const workersCount = warehouse.workers?.length || 0
								const stocksCount = warehouse.stocks?.length || 0

								return (
									<TableRow
										key={warehouse.id}
										className='hover:bg-muted/50 transition-colors'
									>
										<TableCell>
											<div className='flex flex-col'>
												<span className='font-semibold'>{warehouse.name}</span>
											</div>
										</TableCell>
										<TableCell>
											<div className='flex items-center gap-1.5'>
												<MapPin className='h-3.5 w-3.5 text-muted-foreground' />
												<span className='text-sm'>{warehouse.location}</span>
											</div>
										</TableCell>
										<TableCell>
											<div className='flex items-center gap-1.5'>
												<Users className='h-3.5 w-3.5 text-muted-foreground' />
												<Badge variant='secondary' className='font-normal'>
													{workersCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
												</Badge>
											</div>
										</TableCell>
										<TableCell>
											<div className='flex items-center gap-1.5'>
												<Package className='h-3.5 w-3.5 text-muted-foreground' />
												<span className='text-sm'>
													{stocksCount} –ø–æ–∑–∏—Ü–∏–π
												</span>
											</div>
										</TableCell>
										<TableCell className='text-right'>
											<div className='flex justify-end gap-2'>
												<ManageWarehouseWorkersButton
													warehouseId={warehouse.id}
													warehouseName={warehouse.name}
													workers={warehouse.workers || []}
												/>
												<AddWarehouseButton warehouseToEdit={warehouse} />
												<DeleteWarehouseButton
													warehouseId={warehouse.id}
													warehouseName={warehouse.name}
													hasStocks={stocksCount > 0}
													hasWorkers={workersCount > 0}
												/>
											</div>
										</TableCell>
									</TableRow>
								)
							})
						)}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}
</file>

<file path="src/app/api/uploadthing/core.ts">
import { createUploadthing, type FileRouter } from 'uploadthing/next'

const f = createUploadthing()

export const ourFileRouter = {
	// –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
	categoryImage: f({
		image: { maxFileSize: '4MB', maxFileCount: 1 },
	}).onUploadComplete(async ({ metadata, file }) => {
		console.log('Upload complete for userId:', metadata)
		console.log('file url', file.ufsUrl)
		// –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL –∫–ª–∏–µ–Ω—Ç—É
		return { url: file.ufsUrl }
	}),
	// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
	productImage: f({
		image: { maxFileSize: '4MB', maxFileCount: 10 },
	}).onUploadComplete(async ({ metadata, file }) => {
		console.log('Upload complete for product image:', file.ufsUrl)
		return { url: file.ufsUrl }
	}),
} satisfies FileRouter

export type OurFileRouter = typeof ourFileRouter
</file>

<file path="src/app/api/uploadthing/route.ts">
import { createRouteHandler } from 'uploadthing/next'
import { ourFileRouter } from './core' // –ú—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–≤–æ–π —Ä–æ—É—Ç–µ—Ä –∏–∑ —Å–æ—Å–µ–¥–Ω–µ–≥–æ —Ñ–∞–π–ª–∞ core.ts

// –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è GET –∏ POST –∑–∞–ø—Ä–æ—Å–æ–≤
export const { GET, POST } = createRouteHandler({
	router: ourFileRouter,
	// –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä callback-–ª–æ–≥–∏
})
</file>

<file path="src/app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="src/app/layout.tsx">
import { SocketProvider } from '@/providers/socket-provider'
import type { Metadata } from 'next'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
	variable: '--font-geist-sans',
	subsets: ['latin'],
})

const geistMono = Geist_Mono({
	variable: '--font-geist-mono',
	subsets: ['latin'],
})

export const metadata: Metadata = {
	title: '–í–æ–ª—à–µ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω (–ö–£–†–°–û–í–û–ô)',
	description: 'asdasdas',
}

export default function RootLayout({
	children,
}: Readonly<{
	children: React.ReactNode
}>) {
	return (
		<html lang='en'>
			<body
				className={`${geistSans.variable} ${geistMono.variable} antialiased`}
			>
				<SocketProvider>{children}</SocketProvider>
			</body>
		</html>
	)
}
</file>

<file path="src/app/orders/[id]/page.tsx">
import { CancelOrderButton } from '@/components/CancelOrderButton'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { OrderStatusBadge } from '@/components/UpdateOrderStatusButton'
import { orderService } from '@/services/orders.service'
import { ArrowLeft, DollarSign, MapPin, ShoppingCart } from 'lucide-react'
import Image from 'next/image'
import Link from 'next/link'
import { notFound } from 'next/navigation'

interface OrderDetailsPageProps {
	params: {
		id: string
	}
}

export default async function OrderDetailsPage({
	params,
}: OrderDetailsPageProps) {
	const orderId = parseInt(params.id, 10)
	if (isNaN(orderId)) {
		notFound()
	}

	const order = await orderService.getById(orderId)
	if (!order) {
		notFound()
	}

	const canCancel = order.status === 'PENDING' || order.status === 'PROCESSING'

	return (
		<div className='space-y-6 p-6'>
			<Link href='/orders'>
				<Button variant='outline' size='sm'>
					<ArrowLeft className='h-4 w-4 mr-2' />
					–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
				</Button>
			</Link>

			<div className='flex items-center justify-between'>
				<div>
					<h1 className='text-3xl font-bold tracking-tight'>
						–ó–∞–∫–∞–∑ #{order.id}
					</h1>
					<p className='text-muted-foreground'>
						{formatDateTime(order.createdAt)}
					</p>
				</div>
				<div className='flex gap-2'>
					<OrderStatusBadge status={order.status} />
					<CancelOrderButton orderId={order.id} canCancel={canCancel} />
				</div>
			</div>

			<div className='grid gap-6 md:grid-cols-2'>
				{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ */}
				<Card>
					<CardHeader>
						<CardTitle className='flex items-center gap-2'>
							<MapPin className='h-5 w-5' />
							–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
						</CardTitle>
					</CardHeader>
					<CardContent className='space-y-2'>
						<div>
							<p className='text-sm text-muted-foreground'>–ì–æ—Ä–æ–¥</p>
							<p className='font-medium'>{order.deliveryCity}</p>
						</div>
						<div>
							<p className='text-sm text-muted-foreground'>–£–ª–∏—Ü–∞</p>
							<p className='font-medium'>{order.deliveryStreet}</p>
						</div>
					</CardContent>
				</Card>

				{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ */}
				<Card>
					<CardHeader>
						<CardTitle className='flex items-center gap-2'>
							<DollarSign className='h-5 w-5' />
							–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
						</CardTitle>
					</CardHeader>
					<CardContent className='space-y-2'>
						<div>
							<p className='text-sm text-muted-foreground'>–û–±—â–∞—è —Å—É–º–º–∞</p>
							<p className='text-2xl font-bold'>
								{Number(order.totalPrice).toFixed(2)} BYN
							</p>
						</div>
						{order.promocode && (
							<div className='border-t pt-2'>
								<p className='text-sm text-muted-foreground'>
									–ü—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–æ–º–æ–∫–æ–¥
								</p>
								<p className='font-medium'>
									{order.promocode.code} (-{order.promocode.discount}%)
								</p>
							</div>
						)}
					</CardContent>
				</Card>
			</div>

			{/* –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ */}
			<Card>
				<CardHeader>
					<CardTitle className='flex items-center gap-2'>
						<ShoppingCart className='h-5 w-5' />
						–¢–æ–≤–∞—Ä—ã ({order.orderItems.length})
					</CardTitle>
				</CardHeader>
				<CardContent>
					<div className='space-y-4'>
						{order.orderItems.map(item => (
							<div
								key={item.id}
								className='flex gap-4 pb-4 border-b last:border-b-0'
							>
								{/* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ */}
								<div className='relative h-20 w-20 shrink-0 overflow-hidden rounded-lg border bg-muted'>
									{item.product.images && item.product.images.length > 0 ? (
										<Image
											src={item.product.images[0].url}
											alt={item.product.name}
											fill
											className='object-cover'
										/>
									) : (
										<div className='flex h-full w-full items-center justify-center'>
											<ShoppingCart className='h-6 w-6 text-muted-foreground/50' />
										</div>
									)}
								</div>

								{/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ */}
								<div className='flex-1 min-w-0'>
									<Link
										href={`/[product]/${item.product.id}`}
										className='font-semibold hover:underline line-clamp-2'
									>
										{item.product.name}
									</Link>
									<p className='text-sm text-muted-foreground line-clamp-1'>
										{item.product.description}
									</p>
									<div className='mt-2 flex gap-4 flex-wrap'>
										<div>
											<p className='text-xs text-muted-foreground'>
												–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
											</p>
											<p className='font-medium'>{item.quantity}</p>
										</div>
										<div>
											<p className='text-xs text-muted-foreground'>–¶–µ–Ω–∞</p>
											<p className='font-medium'>
												{Number(item.priceAtPurchase).toFixed(2)} BYN
											</p>
										</div>
										<div>
											<p className='text-xs text-muted-foreground'>–í—Å–µ–≥–æ</p>
											<p className='font-bold'>
												{(Number(item.priceAtPurchase) * item.quantity).toFixed(
													2,
												)}{' '}
												BYN
											</p>
										</div>
									</div>
								</div>
							</div>
						))}
					</div>

					{/* –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ */}
					<div className='mt-6 border-t pt-4'>
						<div className='flex justify-end'>
							<div className='w-full max-w-xs space-y-2'>
								<div className='flex justify-between text-sm'>
									<span>–ü–æ–¥–∏—Ç–æ–≥:</span>
									<span>{Number(order.totalPrice).toFixed(2)} BYN</span>
								</div>
								{order.promocode && (
									<div className='flex justify-between text-sm text-green-600'>
										<span>–°–∫–∏–¥–∫–∞ ({order.promocode.discount}%):</span>
										<span>
											-
											{(
												(Number(order.totalPrice) *
													Number(order.promocode.discount)) /
												100
											).toFixed(2)}{' '}
											BYN
										</span>
									</div>
								)}
								<div className='flex justify-between font-bold border-t pt-2'>
									<span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
									<span>{Number(order.totalPrice).toFixed(2)} BYN</span>
								</div>
							</div>
						</div>
					</div>
				</CardContent>
			</Card>
		</div>
	)
}
</file>

<file path="src/app/orders/page.tsx">
import { CancelOrderButton } from '@/components/CancelOrderButton'
import { Button } from '@/components/ui/button'
import { Card, CardContent } from '@/components/ui/card'
import { OrderStatusBadge } from '@/components/UpdateOrderStatusButton'
import { formatDateShort } from '@/lib/date-utils'
import { orderService } from '@/services/orders.service'
import { ArrowRight, ShoppingCart } from 'lucide-react'
import Link from 'next/link'

interface OrdersPageProps {
	searchParams: {
		userId?: string
	}
}

export default async function UserOrdersPage({
	searchParams,
}: OrdersPageProps) {
	// –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ –æ–Ω–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
	// –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è userId –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
	const userId = searchParams.userId ? parseInt(searchParams.userId, 10) : 1

	const orders = await orderService.getByUserId(userId)

	return (
		<div className='space-y-6 p-6'>
			<div>
				<h1 className='text-3xl font-bold tracking-tight'>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
				<p className='text-muted-foreground'>
					–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –∑–∞–∫–∞–∑–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã
				</p>
			</div>

			{orders.length === 0 ? (
				<Card>
					<CardContent className='flex flex-col items-center justify-center py-12'>
						<ShoppingCart className='h-12 w-12 text-muted-foreground/50 mb-4' />
						<p className='text-lg font-medium text-muted-foreground mb-2'>
							–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤
						</p>
						<p className='text-sm text-muted-foreground mb-4'>
							–ù–∞—á–Ω–∏—Ç–µ —Å–æ–≤–µ—Ä—à–∞—Ç—å –ø–æ–∫—É–ø–∫–∏, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤–∞—à–∏ –∑–∞–∫–∞–∑—ã –∑–¥–µ—Å—å
						</p>
						<Link href='/'>
							<Button variant='default'>–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</Button>
						</Link>
					</CardContent>
				</Card>
			) : (
				<div className='grid gap-4'>
					{orders.map(order => (
						<Card key={order.id} className='hover:shadow-lg transition-shadow'>
							<CardContent className='p-6'>
								<div className='grid gap-4 md:grid-cols-5'>
									{/* ID –∏ –¥–∞—Ç–∞ */}
									<div>
										<p className='text-sm text-muted-foreground'>
											–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
										</p>
										<p className='text-lg font-bold'>#{order.id}</p>
										<p className='text-xs text-muted-foreground mt-1'>
											{formatDateShort(order.createdAt)}
										</p>
									</div>

									{/* –¢–æ–≤–∞—Ä—ã */}
									<div>
										<p className='text-sm text-muted-foreground'>–¢–æ–≤–∞—Ä—ã</p>
										<p className='text-lg font-semibold'>
											{(order.orderItems as any[])?.length || 0} —à—Ç
										</p>
										<p className='text-xs text-muted-foreground mt-1'>
											{order.orderItems &&
												(order.orderItems as any[])
													?.slice(0, 2)
													.map((i: any) => i.product.name)
													.join(', ')}
											{((order.orderItems as any[])?.length || 0) > 2 && '...'}
										</p>
									</div>

									{/* –°—É–º–º–∞ */}
									<div>
										<p className='text-sm text-muted-foreground'>–°—É–º–º–∞</p>
										<p className='text-lg font-bold'>
											{Number(order.totalPrice).toFixed(2)} BYN
										</p>
									</div>

									{/* –ê–¥—Ä–µ—Å */}
									<div>
										<p className='text-sm text-muted-foreground'>–ê–¥—Ä–µ—Å</p>
										<p className='text-sm font-medium'>{order.deliveryCity}</p>
										<p className='text-xs text-muted-foreground'>
											{order.deliveryStreet}
										</p>
									</div>

									{/* –°—Ç–∞—Ç—É—Å –∏ –¥–µ–π—Å—Ç–≤–∏—è */}
									<div className='flex flex-col gap-2 justify-between'>
										<div>
											<p className='text-sm text-muted-foreground mb-1'>
												–°—Ç–∞—Ç—É—Å
											</p>
											<OrderStatusBadge status={order.status} />
										</div>
										<div className='flex gap-2'>
											<Link href={`/orders/${order.id}`} className='flex-1'>
												<Button variant='outline' size='sm' className='w-full'>
													–î–µ—Ç–∞–ª–∏
													<ArrowRight className='h-4 w-4 ml-2' />
												</Button>
											</Link>
											<CancelOrderButton
												orderId={order.id}
												canCancel={
													order.status === 'PENDING' ||
													order.status === 'PROCESSING'
												}
											/>
										</div>
									</div>
								</div>
							</CardContent>
						</Card>
					))}
				</div>
			)}
		</div>
	)
}
</file>

<file path="src/app/page.tsx">
import Image from 'next/image'

export default function Home() {
	return (
		<div className='flex min-h-screen items-center justify-center bg-zinc-50 font-sans dark:bg-black'>
			<main className='flex min-h-screen w-full max-w-3xl flex-col items-center justify-between py-32 px-16 bg-white dark:bg-black sm:items-start'>
				<Image
					className='dark:invert'
					src='/next.svg'
					alt='Next.js logo'
					width={100}
					height={20}
					priority
				/>
				<div className='flex flex-col items-center gap-6 text-center sm:items-start sm:text-left'>
					<h1 className='max-w-xs text-3xl font-semibold leading-10 tracking-tight text-black dark:text-zinc-50'>
						To get started, edit the page.tsx file.
					</h1>
					<p className='max-w-md text-lg leading-8 text-zinc-600 dark:text-zinc-400'>
						Looking for a starting point or more instructions? Head over to{' '}
						<a
							href='https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app'
							className='font-medium text-zinc-950 dark:text-zinc-50'
						>
							Templates
						</a>{' '}
						or the{' '}
						<a
							href='https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app'
							className='font-medium text-zinc-950 dark:text-zinc-50'
						>
							Learning
						</a>{' '}
						center.
					</p>
				</div>
				<div className='flex flex-col gap-4 text-base font-medium sm:flex-row'>
					<a
						className='flex h-12 w-full items-center justify-center gap-2 rounded-full bg-foreground px-5 text-background transition-colors hover:bg-[#383838] dark:hover:bg-[#ccc] md:w-[158px]'
						href='https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app'
						target='_blank'
						rel='noopener noreferrer'
					>
						<Image
							className='dark:invert'
							src='/vercel.svg'
							alt='Vercel logomark'
							width={16}
							height={16}
						/>
						Deploy Now
					</a>
					<a
						className='flex h-12 w-full items-center justify-center rounded-full border border-solid border-black/[.08] px-5 transition-colors hover:border-transparent hover:bg-black/[.04] dark:border-white/[.145] dark:hover:bg-[#1a1a1a] md:w-[158px]'
						href='https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app'
						target='_blank'
						rel='noopener noreferrer'
					>
						Documentation
					</a>
				</div>
			</main>
		</div>
	)
}
</file>

<file path="src/components/AddCategoryButton.tsx">
'use client'

import { Category } from '@/generated/prisma/client' // –¢–≤–æ–π –ø—É—Ç—å –∫ —Ç–∏–ø–∞–º
import { manageCategoryAction } from '@/server-actions/categories.action'
import { UploadButton } from '@/utils/uploadthing' // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ UploadThing
import { Loader2, Pencil, Plus, X } from 'lucide-react'
import Image from 'next/image'
import { useEffect, useState } from 'react'
import { toast } from 'sonner' // –ò–ª–∏ useToast –∏–∑ shadcn/ui, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –µ–≥–æ
import { Button } from './ui/button'
import { Input } from './ui/input'
import { Label } from './ui/label'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from './ui/select'
import {
	Sheet,
	SheetContent,
	SheetDescription,
	SheetHeader,
	SheetTitle,
	SheetTrigger,
} from './ui/sheet'
import { Textarea } from './ui/textarea' // –î–æ–±–∞–≤–∏–º –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è

interface AddCategoryButtonProps {
	categ: Category[]
	categoryToEdit?:
		| (Category & { categoryImage?: { url: string } | null })
		| null
}

export default function AddCategoryButton({
	categ,
	categoryToEdit,
}: AddCategoryButtonProps) {
	const [isMounted, setIsMounted] = useState(false)
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)

	// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏. –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º ‚Äî –±–µ—Ä–µ–º –∏–∑ –ø—Ä–æ–ø—Å–æ–≤, –∏–Ω–∞—á–µ –ø—É—Å—Ç–æ
	const [imageUrl, setImageUrl] = useState<string>('')

	useEffect(() => {
		setIsMounted(true)
		if (categoryToEdit?.categoryImage?.url) {
			setImageUrl(categoryToEdit.categoryImage.url)
		} else {
			setImageUrl('')
		}
	}, [categoryToEdit])

	// –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏/–æ—Ç–∫—Ä—ã—Ç–∏–∏ (–¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è)
	useEffect(() => {
		if (isOpen && !categoryToEdit) {
			setImageUrl('')
		}
		if (isOpen && categoryToEdit?.categoryImage?.url) {
			setImageUrl(categoryToEdit.categoryImage.url)
		}
	}, [isOpen, categoryToEdit])

	if (!isMounted) return null

	const isEditMode = !!categoryToEdit

	// –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª–µ–π (–Ω–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å —Å–µ–±—è –∏–ª–∏ —Å–≤–æ–∏—Ö –¥–µ—Ç–µ–π, –Ω–æ –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–µ–±—è)
	const availableParents = isEditMode
		? categ.filter(c => c.id !== categoryToEdit.id)
		: categ

	// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
	async function onSubmit(formData: FormData) {
		setIsLoading(true)
		try {
			const res = await manageCategoryAction(formData)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success(isEditMode ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞')
				setIsOpen(false) // –ó–∞–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	return (
		<Sheet open={isOpen} onOpenChange={setIsOpen}>
			<SheetTrigger asChild>
				{isEditMode ? (
					<Button variant='ghost' size='icon'>
						<Pencil className='h-4 w-4' />
					</Button>
				) : (
					<Button variant='outline' size='sm'>
						<Plus className='mr-2 h-4 w-4' />
						–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
					</Button>
				)}
			</SheetTrigger>

			<SheetContent className='overflow-y-auto'>
				<SheetHeader>
					<SheetTitle>
						{isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' : '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è'}
					</SheetTitle>
					<SheetDescription>
						{isEditMode
							? '–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.'
							: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.'}
					</SheetDescription>
				</SheetHeader>

				<form action={onSubmit} className='grid w-full gap-6 py-4'>
					{/* –°–ö–†–´–¢–´–ï –ü–û–õ–Ø –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Server Action */}
					{isEditMode && (
						<input type='hidden' name='id' value={categoryToEdit.id} />
					)}
					<input type='hidden' name='imageUrl' value={imageUrl} />

					{/* --- –ë–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è --- */}
					<div className='space-y-2'>
						<Label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</Label>
						<div className='flex flex-col items-center justify-center gap-4 rounded-md border p-4 border-dashed'>
							{imageUrl ? (
								<div className='relative aspect-video w-full h-40 overflow-hidden rounded-md'>
									<Image
										src={imageUrl}
										alt='Category Image'
										fill
										className='object-cover'
									/>
									<Button
										type='button'
										onClick={() => setImageUrl('')}
										variant='destructive'
										size='icon'
										className='absolute right-2 top-2 h-6 w-6'
									>
										<X className='h-4 w-4' />
									</Button>
								</div>
							) : (
								<div className='flex flex-col items-center'>
									<UploadButton
										endpoint='categoryImage'
										onClientUploadComplete={res => {
											if (res?.[0]) {
												setImageUrl(res[0].url)
												toast.success('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ')
											}
										}}
										onUploadError={(error: Error) => {
											toast.error(`–û—à–∏–±–∫–∞: ${error.message}`)
										}}
										appearance={{
											button:
												'bg-primary text-primary-foreground hover:bg-primary/90 text-sm h-9 px-4',
											allowedContent: 'text-xs text-muted-foreground',
										}}
									/>
								</div>
							)}
						</div>
					</div>

					{/* --- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è --- */}
					<div className='space-y-2'>
						<Label htmlFor='name'>–ù–∞–∑–≤–∞–Ω–∏–µ</Label>
						<Input
							id='name'
							name='name'
							placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã'
							required
							defaultValue={categoryToEdit?.name || ''}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='description'>–û–ø–∏—Å–∞–Ω–∏–µ</Label>
						<Textarea
							id='description'
							name='description'
							placeholder='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...'
							defaultValue={categoryToEdit?.description || ''}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='parentCategoryId'>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</Label>
						<Select
							name='parentCategoryId'
							defaultValue={categoryToEdit?.parentCategoryId?.toString() || '0'}
						>
							<SelectTrigger>
								<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è' />
							</SelectTrigger>
							<SelectContent>
								<SelectItem value='0'>‚Äî –ë–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—è (–ö–æ—Ä–Ω–µ–≤–∞—è) ‚Äî</SelectItem>
								{availableParents.map(item => (
									<SelectItem key={item.id} value={item.id.toString()}>
										{item.name}
									</SelectItem>
								))}
							</SelectContent>
						</Select>
					</div>

					<Button type='submit' disabled={isLoading} className='mt-2'>
						{isLoading && <Loader2 className='mr-2 h-4 w-4 animate-spin' />}
						{isEditMode ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}
					</Button>
				</form>
			</SheetContent>
		</Sheet>
	)
}
</file>

<file path="src/components/AddProductButton.tsx">
'use client'

import { Category } from '@/generated/prisma/client'
import { manageProductAction } from '@/server-actions/products.action'
import { UploadButton } from '@/utils/uploadthing'
import { Loader2, Pencil, Plus, X, Trash2 } from 'lucide-react'
import Image from 'next/image'
import { useEffect, useState } from 'react'
import { toast } from 'sonner'
import { Button } from './ui/button'
import { Input } from './ui/input'
import { Label } from './ui/label'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from './ui/select'
import {
	Sheet,
	SheetContent,
	SheetDescription,
	SheetHeader,
	SheetTitle,
	SheetTrigger,
} from './ui/sheet'
import { Textarea } from './ui/textarea'
// Using checkbox instead of Switch for now

interface Variant {
	name: string
	additionalPrice: number
	stock: number
	price: number
}

interface Stock {
	warehouseId: number
	quantity: number
}

interface Warehouse {
	id: number
	name: string
	location: string
}

interface AddProductButtonProps {
	categories: Category[]
	warehouses: Warehouse[]
	productToEdit?: {
		id: number
		name: string
		description?: string | null
		basePrice: number
		categoryId: number
		isAvailable: boolean
		hasVariants: boolean
		images?: { url: string; isPrimary: boolean }[]
		variants?: Variant[]
		stocks?: Array<{
			warehouseId: number
			quantity: number
			warehouse?: Warehouse
		}>
	} | null
}

export default function AddProductButton({
	categories,
	warehouses,
	productToEdit,
}: AddProductButtonProps) {
	const [isMounted, setIsMounted] = useState(false)
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)

	// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
	const [imageUrls, setImageUrls] = useState<string[]>([])
	const [primaryImageIndex, setPrimaryImageIndex] = useState(0)

	// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
	const [variants, setVariants] = useState<Variant[]>([])
	const [hasVariants, setHasVariants] = useState(false)

	// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Å—Ç–∞—Ç–∫–æ–≤
	const [stocks, setStocks] = useState<Stock[]>([])

	useEffect(() => {
		setIsMounted(true)
		if (productToEdit?.images) {
			const urls = productToEdit.images.map(img => img.url)
			setImageUrls(urls)
			const primaryIdx = productToEdit.images.findIndex(img => img.isPrimary)
			setPrimaryImageIndex(primaryIdx >= 0 ? primaryIdx : 0)
		} else {
			setImageUrls([])
			setPrimaryImageIndex(0)
		}

		if (productToEdit?.variants) {
			setVariants(productToEdit.variants)
			setHasVariants(true)
		} else {
			setVariants([])
			setHasVariants(productToEdit?.hasVariants || false)
		}

		if (productToEdit?.stocks) {
			setStocks(
				productToEdit.stocks.map(s => ({
					warehouseId: s.warehouseId,
					quantity: s.quantity,
				})),
			)
		} else {
			setStocks([])
		}
	}, [productToEdit])

	// –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏/–æ—Ç–∫—Ä—ã—Ç–∏–∏ (–¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è)
	useEffect(() => {
		if (isOpen && !productToEdit) {
			setImageUrls([])
			setPrimaryImageIndex(0)
			setVariants([])
			setHasVariants(false)
			setStocks([])
		}
		if (isOpen && productToEdit) {
			if (productToEdit.images) {
				const urls = productToEdit.images.map(img => img.url)
				setImageUrls(urls)
				const primaryIdx = productToEdit.images.findIndex(img => img.isPrimary)
				setPrimaryImageIndex(primaryIdx >= 0 ? primaryIdx : 0)
			}
			if (productToEdit.variants) {
				setVariants(productToEdit.variants)
				setHasVariants(true)
			}
			if (productToEdit.stocks) {
				setStocks(
					productToEdit.stocks.map(s => ({
						warehouseId: s.warehouseId,
						quantity: s.quantity,
					})),
				)
			}
		}
	}, [isOpen, productToEdit])

	if (!isMounted) return null

	const isEditMode = !!productToEdit

	// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
	async function onSubmit(formData: FormData) {
		setIsLoading(true)
		try {
			// –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–∫, —á—Ç–æ–±—ã –æ—Å–Ω–æ–≤–Ω–æ–µ –±—ã–ª–æ –ø–µ—Ä–≤—ã–º
			const orderedImages = [...imageUrls]
			if (primaryImageIndex > 0 && orderedImages.length > 0) {
				const primary = orderedImages[primaryImageIndex]
				orderedImages.splice(primaryImageIndex, 1)
				orderedImages.unshift(primary)
			}

			formData.set('imageUrls', JSON.stringify(orderedImages))
			formData.set('variants', JSON.stringify(variants))
			formData.set('stocks', JSON.stringify(stocks))

			const res = await manageProductAction(formData)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success(isEditMode ? '–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω' : '–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω')
				setIsOpen(false) // –ó–∞–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	const handleImageUpload = (res: { url: string }[]) => {
		if (res && res.length > 0) {
			const newUrls = res.map(file => file.url)
			setImageUrls(prev => [...prev, ...newUrls])
			toast.success('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ')
		}
	}

	const removeImage = (index: number) => {
		setImageUrls(prev => prev.filter((_, i) => i !== index))
		if (primaryImageIndex === index) {
			setPrimaryImageIndex(0)
		} else if (primaryImageIndex > index) {
			setPrimaryImageIndex(prev => prev - 1)
		}
	}

	const setAsPrimary = (index: number) => {
		setPrimaryImageIndex(index)
	}

	// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
	const addVariant = () => {
		setVariants([
			...variants,
			{
				name: '',
				additionalPrice: 0,
				stock: 0,
				price: 0,
			},
		])
	}

	const removeVariant = (index: number) => {
		setVariants(variants.filter((_, i) => i !== index))
	}

	const updateVariant = (index: number, field: keyof Variant, value: string | number) => {
		const updated = [...variants]
		updated[index] = { ...updated[index], [field]: value }
		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Ü–µ–Ω—É –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω—ã
		if (field === 'additionalPrice') {
			const basePriceInput = document.querySelector<HTMLInputElement>('#basePrice')
			const basePrice = basePriceInput ? Number(basePriceInput.value) || 0 : 0
			updated[index].price = basePrice + Number(value)
		}
		setVariants(updated)
	}

	// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏
	const addStock = () => {
		// –ù–∞—Ö–æ–¥–∏–º —Å–∫–ª–∞–¥, –∫–æ—Ç–æ—Ä—ã–π –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
		const usedWarehouseIds = stocks.map(s => s.warehouseId)
		const availableWarehouse = warehouses.find(w => !usedWarehouseIds.includes(w.id))
		
		if (availableWarehouse) {
			setStocks([
				...stocks,
				{
					warehouseId: availableWarehouse.id,
					quantity: 0,
				},
			])
		} else {
			toast.error('–í—Å–µ —Å–∫–ª–∞–¥—ã —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã')
		}
	}

	const removeStock = (index: number) => {
		setStocks(stocks.filter((_, i) => i !== index))
	}

	const updateStock = (index: number, field: keyof Stock, value: number) => {
		const updated = [...stocks]
		updated[index] = { ...updated[index], [field]: value }
		setStocks(updated)
	}

	return (
		<Sheet open={isOpen} onOpenChange={setIsOpen}>
			<SheetTrigger asChild>
				{isEditMode ? (
					<Button variant='ghost' size='icon'>
						<Pencil className='h-4 w-4' />
					</Button>
				) : (
					<Button variant='outline' size='sm'>
						<Plus className='mr-2 h-4 w-4' />
						–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
					</Button>
				)}
			</SheetTrigger>

			<SheetContent className='overflow-y-auto'>
				<SheetHeader>
					<SheetTitle>
						{isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä' : '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä'}
					</SheetTitle>
					<SheetDescription>
						{isEditMode
							? '–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.'
							: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.'}
					</SheetDescription>
				</SheetHeader>

				<form action={onSubmit} className='grid w-full gap-6 py-4'>
					{/* –°–ö–†–´–¢–´–ï –ü–û–õ–Ø –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Server Action */}
					{isEditMode && (
						<input type='hidden' name='id' value={productToEdit.id} />
					)}
					<input type='hidden' name='imageUrls' value={JSON.stringify(imageUrls)} />

					{/* --- –ë–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π --- */}
					<div className='space-y-2'>
						<Label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</Label>
						<div className='space-y-3'>
							{imageUrls.length > 0 && (
								<div className='grid grid-cols-2 gap-3'>
									{imageUrls.map((url, index) => (
										<div
											key={index}
											className='relative aspect-square w-full overflow-hidden rounded-md border'
										>
											<Image
												src={url}
												alt={`Product image ${index + 1}`}
												fill
												className='object-cover'
											/>
											<div className='absolute right-2 top-2 flex gap-1'>
												{index !== primaryImageIndex && (
													<Button
														type='button'
														onClick={() => setAsPrimary(index)}
														variant='secondary'
														size='icon'
														className='h-7 w-7 bg-white/90 hover:bg-white'
														title='–°–¥–µ–ª–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–º'
													>
														‚≠ê
													</Button>
												)}
												{index === primaryImageIndex && (
													<div className='flex h-7 w-7 items-center justify-center rounded bg-primary text-xs font-bold text-primary-foreground'>
														‚≠ê
													</div>
												)}
												<Button
													type='button'
													onClick={() => removeImage(index)}
													variant='destructive'
													size='icon'
													className='h-7 w-7'
												>
													<X className='h-4 w-4' />
												</Button>
											</div>
										</div>
									))}
								</div>
							)}
							{imageUrls.length < 10 && (
								<div className='flex flex-col items-center justify-center gap-2 rounded-md border border-dashed p-4'>
									<UploadButton
										endpoint='productImage'
										onClientUploadComplete={handleImageUpload}
										onUploadError={(error: Error) => {
											toast.error(`–û—à–∏–±–∫–∞: ${error.message}`)
										}}
										appearance={{
											button:
												'bg-primary text-primary-foreground hover:bg-primary/90 text-sm h-9 px-4',
											allowedContent: 'text-xs text-muted-foreground',
										}}
									/>
									<p className='text-xs text-muted-foreground'>
										–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ {10 - imageUrls.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
									</p>
								</div>
							)}
						</div>
					</div>

					{/* --- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è --- */}
					<div className='space-y-2'>
						<Label htmlFor='name'>–ù–∞–∑–≤–∞–Ω–∏–µ</Label>
						<Input
							id='name'
							name='name'
							placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 15 Pro'
							required
							defaultValue={productToEdit?.name || ''}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='description'>–û–ø–∏—Å–∞–Ω–∏–µ</Label>
						<Textarea
							id='description'
							name='description'
							placeholder='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...'
							defaultValue={productToEdit?.description || ''}
							rows={4}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='basePrice'>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞</Label>
						<Input
							id='basePrice'
							name='basePrice'
							type='number'
							step='0.01'
							min='0'
							placeholder='0.00'
							required
							defaultValue={productToEdit?.basePrice?.toString() || ''}
							onChange={e => {
								// –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Ü–µ–Ω—É –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã
								const basePrice = Number(e.target.value) || 0
								setVariants(prev =>
									prev.map(v => ({
										...v,
										price: basePrice + v.additionalPrice,
									})),
								)
							}}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='categoryId'>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</Label>
						<Select
							name='categoryId'
							defaultValue={productToEdit?.categoryId?.toString() || ''}
							required
						>
							<SelectTrigger>
								<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é' />
							</SelectTrigger>
							<SelectContent>
								{categories.map(category => (
									<SelectItem key={category.id} value={category.id.toString()}>
										{category.name}
									</SelectItem>
								))}
							</SelectContent>
						</Select>
					</div>

					<div className='flex items-center justify-between space-x-2 rounded-md border p-4'>
						<div className='space-y-0.5'>
							<Label htmlFor='hasVariants'>–¢–æ–≤–∞—Ä —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏</Label>
							<p className='text-xs text-muted-foreground'>
								–í–∫–ª—é—á–∏—Ç–µ, –µ—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã (—Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç –∏ —Ç.–¥.)
							</p>
						</div>
						<input
							id='hasVariants'
							name='hasVariants'
							type='checkbox'
							checked={hasVariants}
							onChange={e => {
								setHasVariants(e.target.checked)
								if (!e.target.checked) {
									setVariants([])
								}
							}}
							className='h-4 w-4 rounded border-gray-300'
							value='true'
						/>
					</div>

					{/* --- –ë–ª–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞ --- */}
					{hasVariants && (
						<div className='space-y-3 rounded-md border p-4'>
							<div className='flex items-center justify-between'>
								<Label>–í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞</Label>
								<Button
									type='button'
									onClick={addVariant}
									variant='outline'
									size='sm'
								>
									<Plus className='mr-2 h-4 w-4' />
									–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
								</Button>
							</div>
							{variants.length === 0 ? (
								<p className='text-sm text-muted-foreground'>
									–î–æ–±–∞–≤—å—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç)
								</p>
							) : (
								<div className='space-y-3'>
									{variants.map((variant, index) => (
										<div
											key={index}
											className='rounded-md border bg-muted/50 p-3 space-y-2'
										>
											<div className='flex items-center justify-between'>
												<span className='text-sm font-medium'>
													–í–∞—Ä–∏–∞–Ω—Ç {index + 1}
												</span>
												<Button
													type='button'
													onClick={() => removeVariant(index)}
													variant='ghost'
													size='icon'
													className='h-7 w-7 text-destructive'
												>
													<Trash2 className='h-4 w-4' />
												</Button>
											</div>
											<div className='grid grid-cols-2 gap-2'>
												<div className='space-y-1'>
													<Label className='text-xs'>–ù–∞–∑–≤–∞–Ω–∏–µ</Label>
													<Input
														placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—Ä–∞—Å–Ω—ã–π, XL'
														value={variant.name}
														onChange={e =>
															updateVariant(index, 'name', e.target.value)
														}
														required
													/>
												</div>
												<div className='space-y-1'>
													<Label className='text-xs'>–î–æ–ø. —Ü–µ–Ω–∞</Label>
													<Input
														type='number'
														step='0.01'
														placeholder='0.00'
														value={variant.additionalPrice}
														onChange={e =>
															updateVariant(
																index,
																'additionalPrice',
																Number(e.target.value) || 0,
															)
														}
													/>
												</div>
												<div className='space-y-1'>
													<Label className='text-xs'>–û—Å—Ç–∞—Ç–æ–∫</Label>
													<Input
														type='number'
														min='0'
														placeholder='0'
														value={variant.stock}
														onChange={e =>
															updateVariant(
																index,
																'stock',
																Number(e.target.value) || 0,
															)
														}
													/>
												</div>
												<div className='space-y-1'>
													<Label className='text-xs'>–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞</Label>
													<Input
														type='number'
														step='0.01'
														value={variant.price}
														onChange={e =>
															updateVariant(
																index,
																'price',
																Number(e.target.value) || 0,
															)
														}
														disabled
														className='bg-muted'
													/>
												</div>
											</div>
										</div>
									))}
								</div>
							)}
						</div>
					)}

					{/* --- –ë–ª–æ–∫ –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö --- */}
					<div className='space-y-3 rounded-md border p-4'>
						<div className='flex items-center justify-between'>
							<Label>–û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö</Label>
							<Button
								type='button'
								onClick={addStock}
								variant='outline'
								size='sm'
								disabled={stocks.length >= warehouses.length}
							>
								<Plus className='mr-2 h-4 w-4' />
								–î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
							</Button>
						</div>
						{stocks.length === 0 ? (
							<p className='text-sm text-muted-foreground'>
								–î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
							</p>
						) : (
							<div className='space-y-2'>
								{stocks.map((stock, index) => {
									const warehouse = warehouses.find(w => w.id === stock.warehouseId)
									return (
										<div
											key={index}
											className='flex items-center gap-2 rounded-md border bg-muted/50 p-2'
										>
											<div className='flex-1'>
												<Label className='text-xs'>
													{warehouse?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–∫–ª–∞–¥'}
												</Label>
												<p className='text-xs text-muted-foreground'>
													{warehouse?.location}
												</p>
											</div>
											<div className='w-24'>
												<Input
													type='number'
													min='0'
													placeholder='0'
													value={stock.quantity}
													onChange={e =>
														updateStock(
															index,
															'quantity',
															Number(e.target.value) || 0,
														)
													}
												/>
											</div>
											<Button
												type='button'
												onClick={() => removeStock(index)}
												variant='ghost'
												size='icon'
												className='h-8 w-8 text-destructive'
											>
												<X className='h-4 w-4' />
											</Button>
										</div>
									)
								})}
							</div>
						)}
					</div>

					<div className='flex items-center justify-between space-x-2 rounded-md border p-4'>
						<div className='space-y-0.5'>
							<Label htmlFor='isAvailable'>–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏</Label>
							<p className='text-xs text-muted-foreground'>
								–¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º
							</p>
						</div>
						<input
							id='isAvailable'
							name='isAvailable'
							type='checkbox'
							defaultChecked={productToEdit?.isAvailable ?? true}
							className='h-4 w-4 rounded border-gray-300'
							value='true'
						/>
					</div>

					<Button type='submit' disabled={isLoading} className='mt-2'>
						{isLoading && <Loader2 className='mr-2 h-4 w-4 animate-spin' />}
						{isEditMode ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}
					</Button>
				</form>
			</SheetContent>
		</Sheet>
	)
}
</file>

<file path="src/components/AddUserButton.tsx">
'use client'

import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from '@/components/ui/select'
import {
	Sheet,
	SheetContent,
	SheetDescription,
	SheetHeader,
	SheetTitle,
	SheetTrigger,
} from '@/components/ui/sheet'
import {
	createUserAction,
	updateUserAction,
} from '@/server-actions/users.action'
import { UploadButton } from '@/utils/uploadthing'
import { Loader2, Pencil, Plus, X } from 'lucide-react'
import Image from 'next/image'
import { useEffect, useState } from 'react'
import { toast } from 'sonner'

interface User {
	id: number
	email: string
	firstName: string | null
	lastName: string | null
	role: string
	avatarUrl: string | null
	createdAt: Date
	updatedAt: Date
}

interface AddUserButtonProps {
	userToEdit?: User | null
}

const ROLES = [
	{ value: 'USER', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' },
	{ value: 'ADMIN', label: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' },
	{ value: 'WAREHOUSE_WORKER', label: '–†–∞–±–æ—Ç–Ω–∏–∫ —Å–∫–ª–∞–¥–∞' },
	{ value: 'ANALYTICS', label: '–ê–Ω–∞–ª–∏—Ç–∏–∫' },
]

export default function AddUserButton({ userToEdit }: AddUserButtonProps) {
	const [isMounted, setIsMounted] = useState(false)
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)
	const [avatarUrl, setAvatarUrl] = useState<string>('')
	const [password, setPassword] = useState('')
	const [showPassword, setShowPassword] = useState(false)

	const isEditMode = !!userToEdit

	useEffect(() => {
		setIsMounted(true)
		if (userToEdit?.avatarUrl) {
			setAvatarUrl(userToEdit.avatarUrl)
		} else {
			setAvatarUrl('')
		}
		if (!isEditMode) {
			setPassword('')
		}
	}, [userToEdit, isEditMode])

	if (!isMounted) return null

	async function onSubmit(e: React.FormEvent<HTMLFormElement>) {
		e.preventDefault()
		setIsLoading(true)

		const formData = new FormData(e.currentTarget)
		formData.set('avatarUrl', avatarUrl)

		try {
			const res = isEditMode
				? await updateUserAction(formData)
				: await createUserAction(formData)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success(
					isEditMode ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω',
				)
				setIsOpen(false)
				setPassword('')
				setAvatarUrl('')
			}
		} catch (error) {
			toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏')
		} finally {
			setIsLoading(false)
		}
	}

	return (
		<Sheet open={isOpen} onOpenChange={setIsOpen}>
			<SheetTrigger asChild>
				{isEditMode ? (
					<Button variant='ghost' size='icon'>
						<Pencil className='h-4 w-4' />
					</Button>
				) : (
					<Button>
						<Plus className='mr-2 h-4 w-4' />
						–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
					</Button>
				)}
			</SheetTrigger>
			<SheetContent className='w-96 overflow-y-auto'>
				<SheetHeader>
					<SheetTitle>
						{isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' : '–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
					</SheetTitle>
					<SheetDescription>
						{isEditMode
							? '–ò–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'
							: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ'}
					</SheetDescription>
				</SheetHeader>

				<form onSubmit={onSubmit} className='space-y-6 py-6'>
					{isEditMode && (
						<input type='hidden' name='id' value={userToEdit?.id} />
					)}

					{/* –ê–≤–∞—Ç–∞—Ä */}
					<div className='space-y-2'>
						<Label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</Label>
						<div className='flex flex-col gap-2'>
							{avatarUrl && (
								<div className='relative w-full h-32 rounded-lg overflow-hidden bg-muted'>
									<Image
										src={avatarUrl}
										alt='Avatar'
										fill
										className='object-cover'
									/>
									<button
										type='button'
										onClick={() => setAvatarUrl('')}
										className='absolute top-1 right-1 p-1 bg-red-500/80 rounded-full hover:bg-red-600'
									>
										<X className='h-3 w-3 text-white' />
									</button>
								</div>
							)}
							<UploadButton
								endpoint='imageUploader'
								onClientUploadComplete={res => {
									if (res?.[0]?.url) {
										setAvatarUrl(res[0].url)
										toast.success('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞')
									}
								}}
								onUploadError={error => {
									toast.error(`–û—à–∏–±–∫–∞: ${error.message}`)
								}}
							/>
						</div>
					</div>

					{/* Email */}
					<div className='space-y-2'>
						<Label htmlFor='email'>Email *</Label>
						<Input
							id='email'
							name='email'
							type='email'
							defaultValue={userToEdit?.email || ''}
							placeholder='user@example.com'
							required
						/>
					</div>

					{/* –ü–∞—Ä–æ–ª—å */}
					<div className='space-y-2'>
						<Label htmlFor='password'>
							–ü–∞—Ä–æ–ª—å {isEditMode ? '(–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å)' : '*'}
						</Label>
						<div className='flex gap-2'>
							<Input
								id='password'
								name='password'
								type={showPassword ? 'text' : 'password'}
								placeholder='–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å'
								value={password}
								onChange={e => setPassword(e.target.value)}
								required={!isEditMode}
							/>
							<Button
								type='button'
								variant='outline'
								size='sm'
								onClick={() => setShowPassword(!showPassword)}
							>
								{showPassword ? 'üôà' : 'üëÅ'}
							</Button>
						</div>
					</div>

					{/* –ò–º—è */}
					<div className='space-y-2'>
						<Label htmlFor='firstName'>–ò–º—è</Label>
						<Input
							id='firstName'
							name='firstName'
							defaultValue={userToEdit?.firstName || ''}
							placeholder='–ò–≤–∞–Ω'
						/>
					</div>

					{/* –§–∞–º–∏–ª–∏—è */}
					<div className='space-y-2'>
						<Label htmlFor='lastName'>–§–∞–º–∏–ª–∏—è</Label>
						<Input
							id='lastName'
							name='lastName'
							defaultValue={userToEdit?.lastName || ''}
							placeholder='–ò–≤–∞–Ω–æ–≤'
						/>
					</div>

					{/* –†–æ–ª—å */}
					<div className='space-y-2'>
						<Label htmlFor='role'>–†–æ–ª—å *</Label>
						<Select
							defaultValue={userToEdit?.role || 'USER'}
							name='role'
							required
						>
							<SelectTrigger>
								<SelectValue />
							</SelectTrigger>
							<SelectContent>
								{ROLES.map(role => (
									<SelectItem key={role.value} value={role.value}>
										{role.label}
									</SelectItem>
								))}
							</SelectContent>
						</Select>
					</div>

					{/* –ö–Ω–æ–ø–∫–∏ */}
					<div className='flex gap-2 pt-4'>
						<Button type='submit' disabled={isLoading} className='flex-1'>
							{isLoading && <Loader2 className='mr-2 h-4 w-4 animate-spin' />}
							{isEditMode ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}
						</Button>
						<Button
							type='button'
							variant='outline'
							onClick={() => setIsOpen(false)}
						>
							–û—Ç–º–µ–Ω–∞
						</Button>
					</div>
				</form>
			</SheetContent>
		</Sheet>
	)
}
</file>

<file path="src/components/AddWarehouseButton.tsx">
'use client'

import { manageWarehouseAction } from '@/server-actions/warehouses.action'
import { Loader2, Pencil, Plus } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'
import { Button } from './ui/button'
import { Input } from './ui/input'
import { Label } from './ui/label'
import {
	Sheet,
	SheetContent,
	SheetDescription,
	SheetHeader,
	SheetTitle,
	SheetTrigger,
} from './ui/sheet'

interface Warehouse {
	id: number
	name: string
	location: string
}

interface AddWarehouseButtonProps {
	warehouseToEdit?: Warehouse | null
}

export default function AddWarehouseButton({
	warehouseToEdit,
}: AddWarehouseButtonProps) {
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)

	const isEditMode = !!warehouseToEdit

	async function onSubmit(formData: FormData) {
		setIsLoading(true)
		try {
			const res = await manageWarehouseAction(formData)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success(
					isEditMode ? '–°–∫–ª–∞–¥ –æ–±–Ω–æ–≤–ª–µ–Ω' : '–°–∫–ª–∞–¥ —Å–æ–∑–¥–∞–Ω',
				)
				setIsOpen(false)
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	return (
		<Sheet open={isOpen} onOpenChange={setIsOpen}>
			<SheetTrigger asChild>
				{isEditMode ? (
					<Button variant='ghost' size='icon'>
						<Pencil className='h-4 w-4' />
					</Button>
				) : (
					<Button variant='outline' size='sm'>
						<Plus className='mr-2 h-4 w-4' />
						–î–æ–±–∞–≤–∏—Ç—å —Å–∫–ª–∞–¥
					</Button>
				)}
			</SheetTrigger>

			<SheetContent className='overflow-y-auto'>
				<SheetHeader>
					<SheetTitle>
						{isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–ª–∞–¥' : '–ù–æ–≤—ã–π —Å–∫–ª–∞–¥'}
					</SheetTitle>
					<SheetDescription>
						{isEditMode
							? '–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.'
							: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–ª–∞–¥–∞.'}
					</SheetDescription>
				</SheetHeader>

				<form action={onSubmit} className='grid w-full gap-6 py-4'>
					{isEditMode && (
						<input type='hidden' name='id' value={warehouseToEdit.id} />
					)}

					<div className='space-y-2'>
						<Label htmlFor='name'>–ù–∞–∑–≤–∞–Ω–∏–µ</Label>
						<Input
							id='name'
							name='name'
							placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∫–ª–∞–¥ ‚Ññ1'
							required
							defaultValue={warehouseToEdit?.name || ''}
						/>
					</div>

					<div className='space-y-2'>
						<Label htmlFor='location'>–ê–¥—Ä–µ—Å</Label>
						<Input
							id='location'
							name='location'
							placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1'
							required
							defaultValue={warehouseToEdit?.location || ''}
						/>
					</div>

					<Button type='submit' disabled={isLoading} className='mt-2'>
						{isLoading && <Loader2 className='mr-2 h-4 w-4 animate-spin' />}
						{isEditMode ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}
					</Button>
				</form>
			</SheetContent>
		</Sheet>
	)
}
</file>

<file path="src/components/AdminCreateOrderButton.tsx">
'use client'

import { Button } from '@/components/ui/button'
import {
	Dialog,
	DialogContent,
	DialogDescription,
	DialogHeader,
	DialogTitle,
	DialogTrigger,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from '@/components/ui/select'
import { createOrderAction } from '@/server-actions/orders.action'
import { Loader2, Plus } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'

interface User {
	id: number
	email: string
	firstName: string | null
	lastName: string | null
	addresses: Array<{
		id: number
		street: string
		city: string
		postCode: string
	}>
}

interface PaymentMethod {
	id: number
	type: string
}

interface AdminCreateOrderButtonProps {
	users: User[]
	paymentMethods: PaymentMethod[]
}

export function AdminCreateOrderButton({
	users,
	paymentMethods,
}: AdminCreateOrderButtonProps) {
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)
	const [selectedUserId, setSelectedUserId] = useState<string>('')
	const [selectedAddressId, setSelectedAddressId] = useState<string>('')
	const [selectedPaymentId, setSelectedPaymentId] = useState<string>('')
	const [promocode, setPromocode] = useState('')

	const selectedUser = users.find(u => u.id === Number(selectedUserId))
	const userAddresses = selectedUser?.addresses || []

	const handleSubmit = async (e: React.FormEvent) => {
		e.preventDefault()

		if (!selectedUserId || !selectedAddressId) {
			toast.error('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏')
			return
		}

		setIsLoading(true)
		try {
			const result = await createOrderAction(
				Number(selectedUserId),
				Number(selectedAddressId),
				selectedPaymentId ? Number(selectedPaymentId) : undefined,
				promocode || undefined,
			)

			if (result?.error) {
				toast.error(result.error)
			} else if (result?.success && result?.orderId) {
				toast.success('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω')
				setIsOpen(false)
				setSelectedUserId('')
				setSelectedAddressId('')
				setSelectedPaymentId('')
				setPromocode('')
			}
		} catch (error) {
			toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞')
			console.error(error)
		} finally {
			setIsLoading(false)
		}
	}

	return (
		<Dialog open={isOpen} onOpenChange={setIsOpen}>
			<DialogTrigger asChild>
				<Button variant='default' size='sm' className='gap-2'>
					<Plus className='h-4 w-4' />
					–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
				</Button>
			</DialogTrigger>
			<DialogContent className='sm:max-w-md'>
				<DialogHeader>
					<DialogTitle>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</DialogTitle>
					<DialogDescription>
						–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∏–∑ –µ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã
					</DialogDescription>
				</DialogHeader>

				<form onSubmit={handleSubmit} className='space-y-4'>
					{/* –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */}
					<div className='space-y-2'>
						<Label htmlFor='user-select'>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</Label>
						<Select value={selectedUserId} onValueChange={setSelectedUserId}>
							<SelectTrigger id='user-select'>
								<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è' />
							</SelectTrigger>
							<SelectContent>
								{users.map(user => (
									<SelectItem key={user.id} value={String(user.id)}>
										{user.firstName && user.lastName
											? `${user.firstName} ${user.lastName}`
											: user.email}{' '}
										({user.email})
									</SelectItem>
								))}
							</SelectContent>
						</Select>
					</div>

					{/* –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ */}
					{userAddresses.length > 0 && (
						<div className='space-y-2'>
							<Label htmlFor='address-select'>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</Label>
							<Select
								value={selectedAddressId}
								onValueChange={setSelectedAddressId}
							>
								<SelectTrigger id='address-select'>
									<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å' />
								</SelectTrigger>
								<SelectContent>
									{userAddresses.map(address => (
										<SelectItem key={address.id} value={String(address.id)}>
											{address.city}, {address.street}
										</SelectItem>
									))}
								</SelectContent>
							</Select>
						</div>
					)}

					{selectedUser && userAddresses.length === 0 && (
						<div className='rounded-md bg-destructive/10 p-3 text-sm text-destructive'>
							–£ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∞–¥—Ä–µ—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
						</div>
					)}

					{/* –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã */}
					{paymentMethods.length > 0 && (
						<div className='space-y-2'>
							<Label htmlFor='payment-select'>
								–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
							</Label>
							<Select
								value={selectedPaymentId}
								onValueChange={setSelectedPaymentId}
							>
								<SelectTrigger id='payment-select'>
									<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã' />
								</SelectTrigger>
								<SelectContent>
									{paymentMethods.map(method => (
										<SelectItem key={method.id} value={String(method.id)}>
											{method.type}
										</SelectItem>
									))}
								</SelectContent>
							</Select>
						</div>
					)}

					{/* –ü—Ä–æ–º–æ–∫–æ–¥ */}
					<div className='space-y-2'>
						<Label htmlFor='promo-input'>–ü—Ä–æ–º–æ–∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</Label>
						<Input
							id='promo-input'
							placeholder='–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥'
							value={promocode}
							onChange={e => setPromocode(e.target.value)}
							disabled={isLoading}
						/>
					</div>

					<Button
						type='submit'
						disabled={!selectedUserId || !selectedAddressId || isLoading}
						className='w-full'
					>
						{isLoading && <Loader2 className='mr-2 h-4 w-4 animate-spin' />}
						{isLoading ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑'}
					</Button>
				</form>
			</DialogContent>
		</Dialog>
	)
}
</file>

<file path="src/components/AppSidebar.tsx">
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import {
	DropdownMenu,
	DropdownMenuContent,
	DropdownMenuItem,
	DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import {
	Sidebar,
	SidebarContent,
	SidebarFooter,
	SidebarGroup,
	SidebarHeader,
	SidebarMenu,
	SidebarMenuButton,
	SidebarMenuItem,
} from '@/components/ui/sidebar'
import { MENU_ADMIN } from '@/lib/links'
import { ChevronDown } from 'lucide-react'

export default function AppSidebar() {
	return (
		<Sidebar collapsible='icon'>
			{/* –®–ê–ü–ö–ê –° –ü–†–û–§–ò–õ–ï–ú */}
			<SidebarHeader className='p-4'>
				<SidebarMenu>
					<SidebarMenuItem>
						<DropdownMenu>
							<DropdownMenuTrigger asChild>
								<SidebarMenuButton
									size='lg'
									className='data-[state=open]:bg-sidebar-accent'
								>
									{/* –ó–∞–≥–ª—É—à–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ */}
									<Avatar className='h-8 w-8 rounded-lg'>
										<AvatarImage src='https://github.com/shadcn.png' />
										<AvatarFallback>–ò–õ</AvatarFallback>
									</Avatar>

									{/* –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–æ—é—Ç—Å—è –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! */}
									<div className='grid flex-1 text-left text-sm leading-tight'>
										<span className='truncate font-semibold'>–ò–ª—å—è</span>
										<span className='truncate text-xs'>admin@project.com</span>
									</div>
									<ChevronDown className='ml-auto size-4' />
								</SidebarMenuButton>
							</DropdownMenuTrigger>
							<DropdownMenuContent
								className='w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg'
								align='start'
							>
								<DropdownMenuItem>–ü—Ä–æ—Ñ–∏–ª—å</DropdownMenuItem>
								<DropdownMenuItem>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</DropdownMenuItem>
								<DropdownMenuItem className='text-red-500'>
									–í—ã–π—Ç–∏
								</DropdownMenuItem>
							</DropdownMenuContent>
						</DropdownMenu>
					</SidebarMenuItem>
				</SidebarMenu>
			</SidebarHeader>
			<SidebarContent>
				<SidebarGroup>
					{MENU_ADMIN.map(item => {
						return (
							<SidebarMenuButton asChild key={item.href}>
								<a href={item.href}>
									<item.icon />
									<span>{item.label}</span>
								</a>
							</SidebarMenuButton>
						)
					})}
				</SidebarGroup>
				<SidebarGroup />
			</SidebarContent>
			<SidebarFooter />
		</Sidebar>
	)
}
</file>

<file path="src/components/CancelOrderButton.tsx">
'use client'

import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogHeader,
	AlertDialogTitle,
	AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { Button } from '@/components/ui/button'
import { cancelOrderAction } from '@/server-actions/orders.action'
import { Trash2 } from 'lucide-react'
import { useState } from 'react'

interface CancelOrderButtonProps {
	orderId: number
	disabled?: boolean
	canCancel: boolean
}

export function CancelOrderButton({
	orderId,
	disabled = false,
	canCancel = true,
}: CancelOrderButtonProps) {
	const [isLoading, setIsLoading] = useState(false)

	const handleCancel = async () => {
		setIsLoading(true)
		try {
			const result = await cancelOrderAction(orderId)
			if (result.error) {
				alert(result.error)
			}
		} catch (error) {
			alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞')
		} finally {
			setIsLoading(false)
		}
	}

	if (!canCancel) {
		return null
	}

	return (
		<AlertDialog>
			<AlertDialogTrigger asChild>
				<Button
					variant='destructive'
					size='sm'
					disabled={disabled || isLoading}
				>
					<Trash2 className='h-4 w-4 mr-2' />
					–û—Ç–º–µ–Ω–∏—Ç—å
				</Button>
			</AlertDialogTrigger>
			<AlertDialogContent>
				<AlertDialogHeader>
					<AlertDialogTitle>–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?</AlertDialogTitle>
					<AlertDialogDescription>
						–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è
						–±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å.
					</AlertDialogDescription>
				</AlertDialogHeader>
				<div className='flex justify-end gap-2'>
					<AlertDialogCancel>–ù–µ—Ç, –æ—Å—Ç–∞–≤–∏—Ç—å</AlertDialogCancel>
					<AlertDialogAction onClick={handleCancel}>
						–î–∞, –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
					</AlertDialogAction>
				</div>
			</AlertDialogContent>
		</AlertDialog>
	)
}
</file>

<file path="src/components/CategorySocketPicker.tsx">
'use client'

import { useSocket } from '@/providers/socket-provider'
import { useRouter } from 'next/navigation'
import { useEffect } from 'react'

export function CategorySocketPicker() {
	const { socket } = useSocket()
	const router = useRouter()

	useEffect(() => {
		if (!socket) return

		// –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä —Å–æ–∫–µ—Ç–æ–≤ —Å–∫–∞–∂–µ—Ç 'refresh',
		// Next.js –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Ç–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç CategoriesPage
		socket.on('refresh', () => {
			router.refresh()
		})

		return () => {
			socket.off('refresh')
		}
	}, [socket, router])

	return null // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∏—Å—É–µ—Ç, –æ–Ω –ø—Ä–æ—Å—Ç–æ "—Å–ª—É—à–∞–µ—Ç"
}
</file>

<file path="src/components/charts/ChartComponents.tsx">
'use client'

import {
	Bar,
	BarChart,
	CartesianGrid,
	Cell,
	Legend,
	Line,
	LineChart,
	Pie,
	PieChart,
	ResponsiveContainer,
	Tooltip,
	XAxis,
	YAxis,
} from 'recharts'

const COLORS = [
	'#3b82f6',
	'#ef4444',
	'#10b981',
	'#f59e0b',
	'#8b5cf6',
	'#ec4899',
	'#14b8a6',
	'#f97316',
]

export function BarChartComponent({
	data,
	dataKey,
	nameKey = 'name',
	title,
}: {
	data: any[]
	dataKey: string
	nameKey?: string
	title?: string
}) {
	return (
		<div className='w-full h-full'>
			{title && <h3 className='text-lg font-semibold mb-4'>{title}</h3>}
			<ResponsiveContainer width='100%' height={300}>
				<BarChart data={data}>
					<CartesianGrid strokeDasharray='3 3' />
					<XAxis dataKey={nameKey} angle={-45} textAnchor='end' height={80} />
					<YAxis />
					<Tooltip />
					<Legend />
					<Bar dataKey={dataKey} fill='#3b82f6' />
				</BarChart>
			</ResponsiveContainer>
		</div>
	)
}

export function LineChartComponent({
	data,
	dataKey,
	dataKey2,
	nameKey = 'name',
	title,
}: {
	data: any[]
	dataKey: string
	dataKey2?: string
	nameKey?: string
	title?: string
}) {
	return (
		<div className='w-full h-full'>
			{title && <h3 className='text-lg font-semibold mb-4'>{title}</h3>}
			<ResponsiveContainer width='100%' height={300}>
				<LineChart data={data}>
					<CartesianGrid strokeDasharray='3 3' />
					<XAxis dataKey={nameKey} />
					<YAxis />
					<Tooltip />
					<Legend />
					<Line
						type='monotone'
						dataKey={dataKey}
						stroke='#3b82f6'
						strokeWidth={2}
					/>
					{dataKey2 && (
						<Line
							type='monotone'
							dataKey={dataKey2}
							stroke='#ef4444'
							strokeWidth={2}
						/>
					)}
				</LineChart>
			</ResponsiveContainer>
		</div>
	)
}

export function PieChartComponent({
	data,
	dataKey,
	nameKey = 'name',
	title,
}: {
	data: any[]
	dataKey: string
	nameKey?: string
	title?: string
}) {
	return (
		<div className='w-full h-full'>
			{title && <h3 className='text-lg font-semibold mb-4'>{title}</h3>}
			<ResponsiveContainer width='100%' height={300}>
				<PieChart>
					<Pie
						data={data}
						dataKey={dataKey}
						nameKey={nameKey}
						cx='50%'
						cy='50%'
						labelLine={true}
						label={{ position: 'right', offset: 10 }}
						outerRadius={100}
					>
						{data.map((_, index) => (
							<Cell
								key={`cell-${index}`}
								fill={COLORS[index % COLORS.length]}
							/>
						))}
					</Pie>
					<Tooltip />
				</PieChart>
			</ResponsiveContainer>
		</div>
	)
}
</file>

<file path="src/components/charts/DataTable.tsx">
'use client'

import {
	Table,
	TableBody,
	TableCell,
	TableHead,
	TableHeader,
	TableRow,
} from '@/components/ui/table'

interface Column<T> {
	key: keyof T
	label: string
	format?: (value: any) => string
}

export function DataTable<T extends Record<string, any>>({
	data,
	columns,
	title,
	maxHeight,
}: {
	data: T[]
	columns: Column<T>[]
	title?: string
	maxHeight?: string
}) {
	if (data.length === 0) {
		return (
			<div className='w-full'>
				{title && <h3 className='text-lg font-semibold mb-4'>{title}</h3>}
				<div className='text-center py-8 text-muted-foreground'>
					–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
				</div>
			</div>
		)
	}

	return (
		<div className='w-full'>
			{title && <h3 className='text-lg font-semibold mb-4'>{title}</h3>}
			<div
				className={`border rounded-lg overflow-x-auto ${maxHeight ? `max-h-[${maxHeight}] overflow-y-auto` : ''}`}
			>
				<Table>
					<TableHeader>
						<TableRow>
							{columns.map(col => (
								<TableHead key={String(col.key)} className='font-semibold'>
									{col.label}
								</TableHead>
							))}
						</TableRow>
					</TableHeader>
					<TableBody>
						{data.map((row, idx) => (
							<TableRow key={idx}>
								{columns.map(col => (
									<TableCell key={String(col.key)}>
										{col.format
											? col.format(row[col.key])
											: String(row[col.key])}
									</TableCell>
								))}
							</TableRow>
						))}
					</TableBody>
				</Table>
			</div>
		</div>
	)
}

export function StatsCard({
	label,
	value,
	unit,
	icon,
	className,
}: {
	label: string
	value: string | number
	unit?: string
	icon?: React.ReactNode
	className?: string
}) {
	return (
		<div
			className={`bg-white dark:bg-slate-900 border rounded-lg p-6 ${className}`}
		>
			<div className='flex items-center justify-between'>
				<div>
					<p className='text-sm text-muted-foreground font-medium'>{label}</p>
					<p className='text-2xl font-bold mt-2'>
						{value}
						{unit && (
							<span className='text-lg text-muted-foreground ml-1'>{unit}</span>
						)}
					</p>
				</div>
				{icon && <div className='text-4xl opacity-20'>{icon}</div>}
			</div>
		</div>
	)
}
</file>

<file path="src/components/CreateOrderButton.tsx">
'use client'

import { Button } from '@/components/ui/button'
import {
	Dialog,
	DialogContent,
	DialogDescription,
	DialogHeader,
	DialogTitle,
	DialogTrigger,
} from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from '@/components/ui/select'
import { createOrderAction } from '@/server-actions/orders.action'
import { Loader2, ShoppingCart } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'

interface CreateOrderButtonProps {
	userId: number
	cartTotal: number
	addresses: Array<{
		id: number
		street: string
		city: string
		postCode: string
	}>
	paymentMethods?: Array<{
		id: number
		type: string
	}>
}

export function CreateOrderButton({
	userId,
	cartTotal,
	addresses,
	paymentMethods = [],
}: CreateOrderButtonProps) {
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)
	const [selectedAddressId, setSelectedAddressId] = useState<string>('')
	const [selectedPaymentId, setSelectedPaymentId] = useState<string>('')
	const [promocodeCode, setPromocodeCode] = useState('')

	const handleCreateOrder = async () => {
		if (!selectedAddressId) {
			toast.error('–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏')
			return
		}

		setIsLoading(true)
		try {
			const result = await createOrderAction(
				userId,
				parseInt(selectedAddressId, 10),
				selectedPaymentId ? parseInt(selectedPaymentId, 10) : undefined,
				promocodeCode || undefined,
			)

			if (result.success) {
				toast.success('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!')
				setIsOpen(false)
				setSelectedAddressId('')
				setSelectedPaymentId('')
				setPromocodeCode('')
				// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ router.push
				window.location.href = `/orders/${result.orderId}`
			} else {
				toast.error(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞')
			}
		} catch (error) {
			toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞')
		} finally {
			setIsLoading(false)
		}
	}

	if (addresses.length === 0) {
		return (
			<Button disabled>
				<ShoppingCart className='h-4 w-4 mr-2' />
				–î–æ–±–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
			</Button>
		)
	}

	return (
		<Dialog open={isOpen} onOpenChange={setIsOpen}>
			<DialogTrigger asChild>
				<Button size='lg'>
					<ShoppingCart className='h-4 w-4 mr-2' />
					–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ({cartTotal.toFixed(2)} BYN)
				</Button>
			</DialogTrigger>
			<DialogContent className='sm:max-w-md'>
				<DialogHeader>
					<DialogTitle>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</DialogTitle>
					<DialogDescription>
						–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
					</DialogDescription>
				</DialogHeader>

				<div className='space-y-6'>
					{/* –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ */}
					<div className='space-y-2'>
						<Label htmlFor='address'>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</Label>
						<Select
							value={selectedAddressId}
							onValueChange={setSelectedAddressId}
						>
							<SelectTrigger id='address'>
								<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏' />
							</SelectTrigger>
							<SelectContent>
								{addresses.map(address => (
									<SelectItem key={address.id} value={address.id.toString()}>
										{address.city}, {address.street}
									</SelectItem>
								))}
							</SelectContent>
						</Select>
					</div>

					{/* –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã */}
					{paymentMethods.length > 0 && (
						<div className='space-y-2'>
							<Label htmlFor='payment'>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</Label>
							<Select
								value={selectedPaymentId}
								onValueChange={setSelectedPaymentId}
							>
								<SelectTrigger id='payment'>
									<SelectValue placeholder='–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã' />
								</SelectTrigger>
								<SelectContent>
									{paymentMethods.map(method => (
										<SelectItem key={method.id} value={method.id.toString()}>
											{method.type}
										</SelectItem>
									))}
								</SelectContent>
							</Select>
						</div>
					)}

					{/* –ü—Ä–æ–º–æ–∫–æ–¥ */}
					<div className='space-y-2'>
						<Label htmlFor='promo'>–ü—Ä–æ–º–æ–∫–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</Label>
						<Input
							id='promo'
							placeholder='–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞'
							value={promocodeCode}
							onChange={e => setPromocodeCode(e.target.value.toUpperCase())}
							disabled={isLoading}
						/>
					</div>

					{/* –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ */}
					<div className='border-t pt-4'>
						<div className='flex justify-between items-center'>
							<span className='text-lg font-semibold'>–ò—Ç–æ–≥–æ:</span>
							<span className='text-2xl font-bold'>
								{cartTotal.toFixed(2)} BYN
							</span>
						</div>
					</div>

					{/* –ö–Ω–æ–ø–∫–∏ */}
					<div className='flex gap-2 justify-end'>
						<Button
							variant='outline'
							onClick={() => setIsOpen(false)}
							disabled={isLoading}
						>
							–û—Ç–º–µ–Ω–∞
						</Button>
						<Button onClick={handleCreateOrder} disabled={isLoading}>
							{isLoading && <Loader2 className='h-4 w-4 mr-2 animate-spin' />}
							–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
						</Button>
					</div>
				</div>
			</DialogContent>
		</Dialog>
	)
}
</file>

<file path="src/components/DeleteCategoryButton.tsx">
'use client'

import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogFooter,
	AlertDialogHeader,
	AlertDialogTitle,
	AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { Button } from '@/components/ui/button'
import { deleteCategoryAction } from '@/server-actions/categories.action'
import { AlertTriangle, Trash2 } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'

interface DeleteCategoryButtonProps {
	categoryId: number
	categoryName: string
	hasSubcategories: boolean
}

export function DeleteCategoryButton({
	categoryId,
	categoryName,
	hasSubcategories,
}: DeleteCategoryButtonProps) {
	const [isLoading, setIsLoading] = useState(false)

	const onDelete = async () => {
		setIsLoading(true)
		const result = await deleteCategoryAction(categoryId)
		setIsLoading(false)

		if (result.success) {
			toast.success(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${categoryName}" —É–¥–∞–ª–µ–Ω–∞`)
		} else {
			toast.error(result.error)
		}
	}

	return (
		<AlertDialog>
			<AlertDialogTrigger asChild>
				<Button
					variant='ghost'
					size='icon'
					className='text-destructive hover:bg-destructive/10'
				>
					<Trash2 className='h-4 w-4' />
				</Button>
			</AlertDialogTrigger>
			<AlertDialogContent>
				<AlertDialogHeader>
					<AlertDialogTitle className='flex items-center gap-2'>
						<AlertTriangle className='h-5 w-5 text-destructive' />
						–í—ã —É–≤–µ—Ä–µ–Ω—ã?
					</AlertDialogTitle>
					<AlertDialogDescription className='space-y-3'>
						<p>
							–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é <strong>"{categoryName}"</strong>
							.
						</p>

						{hasSubcategories && (
							<div className='p-3 bg-destructive/10 border border-destructive/20 rounded-md text-destructive font-medium text-sm'>
								–í–Ω–∏–º–∞–Ω–∏–µ: –£ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
								—Ä–æ–¥–∏—Ç–µ–ª—è, —Å–≤—è–∑—å –±—É–¥–µ—Ç —Ä–∞–∑–æ—Ä–≤–∞–Ω–∞, –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—Ç–∞–Ω—É—Ç
								—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–º–∏ (–∫–æ—Ä–Ω–µ–≤—ã–º–∏).
							</div>
						)}

						<p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</AlertDialogDescription>
				</AlertDialogHeader>
				<AlertDialogFooter>
					<AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>
					<AlertDialogAction
						onClick={onDelete}
						className='bg-destructive text-white hover:bg-destructive/90'
						disabled={isLoading}
					>
						{isLoading ? '–£–¥–∞–ª–µ–Ω–∏–µ...' : '–£–¥–∞–ª–∏—Ç—å'}
					</AlertDialogAction>
				</AlertDialogFooter>
			</AlertDialogContent>
		</AlertDialog>
	)
}
</file>

<file path="src/components/DeleteProductButton.tsx">
'use client'

import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogFooter,
	AlertDialogHeader,
	AlertDialogTitle,
	AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { Button } from '@/components/ui/button'
import { deleteProductAction } from '@/server-actions/products.action'
import { AlertTriangle, Trash2 } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'

interface DeleteProductButtonProps {
	productId: number
	productName: string
	hasOrders?: boolean
}

export function DeleteProductButton({
	productId,
	productName,
	hasOrders = false,
}: DeleteProductButtonProps) {
	const [isLoading, setIsLoading] = useState(false)

	const onDelete = async () => {
		setIsLoading(true)
		const result = await deleteProductAction(productId)
		setIsLoading(false)

		if (result.success) {
			toast.success(`–¢–æ–≤–∞—Ä "${productName}" —É–¥–∞–ª–µ–Ω`)
		} else {
			toast.error(result.error)
		}
	}

	return (
		<AlertDialog>
			<AlertDialogTrigger asChild>
				<Button
					variant='ghost'
					size='icon'
					className='text-destructive hover:bg-destructive/10'
				>
					<Trash2 className='h-4 w-4' />
				</Button>
			</AlertDialogTrigger>
			<AlertDialogContent>
				<AlertDialogHeader>
					<AlertDialogTitle className='flex items-center gap-2'>
						<AlertTriangle className='h-5 w-5 text-destructive' />
						–í—ã —É–≤–µ—Ä–µ–Ω—ã?
					</AlertDialogTitle>
					<AlertDialogDescription className='space-y-3'>
						<p>
							–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä <strong>"{productName}"</strong>.
						</p>

						{hasOrders && (
							<div className='p-3 bg-destructive/10 border border-destructive/20 rounded-md text-destructive font-medium text-sm'>
								–í–Ω–∏–º–∞–Ω–∏–µ: –£ —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã. –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç
								–±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π.
							</div>
						)}

						<p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
					</AlertDialogDescription>
				</AlertDialogHeader>
				<AlertDialogFooter>
					<AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>
					<AlertDialogAction
						onClick={onDelete}
						className='bg-destructive text-white hover:bg-destructive/90'
						disabled={isLoading}
					>
						{isLoading ? '–£–¥–∞–ª–µ–Ω–∏–µ...' : '–£–¥–∞–ª–∏—Ç—å'}
					</AlertDialogAction>
				</AlertDialogFooter>
			</AlertDialogContent>
		</AlertDialog>
	)
}
</file>

<file path="src/components/DeleteUserButton.tsx">
'use client'

import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogFooter,
	AlertDialogHeader,
	AlertDialogTitle,
	AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { Button } from '@/components/ui/button'
import { deleteUserAction } from '@/server-actions/users.action'
import { AlertTriangle, Trash2 } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'

interface DeleteUserButtonProps {
	userId: number
	userName: string
}

export function DeleteUserButton({ userId, userName }: DeleteUserButtonProps) {
	const [isLoading, setIsLoading] = useState(false)

	const onDelete = async () => {
		setIsLoading(true)
		const result = await deleteUserAction(userId)
		setIsLoading(false)

		if (result.success) {
			toast.success(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${userName}" —É–¥–∞–ª–µ–Ω`)
		} else {
			toast.error(result.error)
		}
	}

	return (
		<AlertDialog>
			<AlertDialogTrigger asChild>
				<Button
					variant='ghost'
					size='icon'
					className='text-destructive hover:bg-destructive/10'
				>
					<Trash2 className='h-4 w-4' />
				</Button>
			</AlertDialogTrigger>
			<AlertDialogContent>
				<AlertDialogHeader>
					<AlertDialogTitle className='flex items-center gap-2'>
						<AlertTriangle className='h-5 w-5 text-destructive' />
						–í—ã —É–≤–µ—Ä–µ–Ω—ã?
					</AlertDialogTitle>
					<AlertDialogDescription className='space-y-3'>
						<p>
							–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è <strong>"{userName}"</strong>.
						</p>
						<div className='p-3 bg-destructive/10 border border-destructive/20 rounded-md text-destructive font-medium text-sm'>
							–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç
							—É–¥–∞–ª–µ–Ω—ã.
						</div>
					</AlertDialogDescription>
				</AlertDialogHeader>
				<AlertDialogFooter>
					<AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>
					<AlertDialogAction
						onClick={onDelete}
						disabled={isLoading}
						className='bg-destructive hover:bg-destructive/90'
					>
						{isLoading ? '–£–¥–∞–ª–µ–Ω–∏–µ...' : '–£–¥–∞–ª–∏—Ç—å'}
					</AlertDialogAction>
				</AlertDialogFooter>
			</AlertDialogContent>
		</AlertDialog>
	)
}
</file>

<file path="src/components/DeleteWarehouseButton.tsx">
'use client'

import { deleteWarehouseAction } from '@/server-actions/warehouses.action'
import { Trash2 } from 'lucide-react'
import { useState } from 'react'
import { toast } from 'sonner'
import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogFooter,
	AlertDialogHeader,
	AlertDialogTitle,
	AlertDialogTrigger,
} from './ui/alert-dialog'
import { Button } from './ui/button'

interface DeleteWarehouseButtonProps {
	warehouseId: number
	warehouseName: string
	hasStocks?: boolean
	hasWorkers?: boolean
}

export function DeleteWarehouseButton({
	warehouseId,
	warehouseName,
	hasStocks = false,
	hasWorkers = false,
}: DeleteWarehouseButtonProps) {
	const [isLoading, setIsLoading] = useState(false)

	async function handleDelete() {
		setIsLoading(true)
		try {
			const res = await deleteWarehouseAction(warehouseId)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success('–°–∫–ª–∞–¥ —É–¥–∞–ª–µ–Ω')
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	return (
		<AlertDialog>
			<AlertDialogTrigger asChild>
				<Button variant='ghost' size='icon' disabled={isLoading}>
					<Trash2 className='h-4 w-4 text-destructive' />
				</Button>
			</AlertDialogTrigger>
			<AlertDialogContent>
				<AlertDialogHeader>
					<AlertDialogTitle>–£–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥?</AlertDialogTitle>
					<AlertDialogDescription>
						–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥ "{warehouseName}"?
						{hasStocks && (
							<span className='block mt-2 text-destructive font-semibold'>
								–í–Ω–∏–º–∞–Ω–∏–µ: –Ω–∞ —ç—Ç–æ–º —Å–∫–ª–∞–¥–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã!
							</span>
						)}
						{hasWorkers && (
							<span className='block mt-2 text-destructive font-semibold'>
								–í–Ω–∏–º–∞–Ω–∏–µ: –Ω–∞ —ç—Ç–æ–º —Å–∫–ª–∞–¥–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏!
							</span>
						)}
						–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
					</AlertDialogDescription>
				</AlertDialogHeader>
				<AlertDialogFooter>
					<AlertDialogCancel>–û—Ç–º–µ–Ω–∞</AlertDialogCancel>
					<AlertDialogAction
						onClick={handleDelete}
						disabled={isLoading}
						className='bg-destructive text-destructive-foreground hover:bg-destructive/90'
					>
						–£–¥–∞–ª–∏—Ç—å
					</AlertDialogAction>
				</AlertDialogFooter>
			</AlertDialogContent>
		</AlertDialog>
	)
}
</file>

<file path="src/components/ManageWarehouseWorkersButton.tsx">
'use client'

import {
	addWorkerToWarehouseAction,
	getUsersWithWarehouseRoleAction,
	removeWorkerFromWarehouseAction,
} from '@/server-actions/warehouses.action'
import { Loader2, Plus, Trash2, Users } from 'lucide-react'
import { useRouter } from 'next/navigation'
import { useEffect, useState } from 'react'
import { toast } from 'sonner'
import {
	AlertDialog,
	AlertDialogAction,
	AlertDialogCancel,
	AlertDialogContent,
	AlertDialogDescription,
	AlertDialogFooter,
	AlertDialogHeader,
	AlertDialogTitle,
} from './ui/alert-dialog'
import { Badge } from './ui/badge'
import { Button } from './ui/button'
import {
	Dialog,
	DialogContent,
	DialogDescription,
	DialogHeader,
	DialogTitle,
	DialogTrigger,
} from './ui/dialog'
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from './ui/select'

interface User {
	id: number
	email: string
	firstName: string | null
	lastName: string | null
	role: string
}

interface WarehouseWorker {
	id: number
	userId: number
	warehouseId: number
	user: User
}

interface ManageWarehouseWorkersButtonProps {
	warehouseId: number
	warehouseName: string
	workers: WarehouseWorker[]
}

export function ManageWarehouseWorkersButton({
	warehouseId,
	warehouseName,
	workers: initialWorkers,
}: ManageWarehouseWorkersButtonProps) {
	const router = useRouter()
	const [isOpen, setIsOpen] = useState(false)
	const [isLoading, setIsLoading] = useState(false)
	const [workers, setWorkers] = useState(initialWorkers)
	const [availableUsers, setAvailableUsers] = useState<User[]>([])
	const [selectedUserId, setSelectedUserId] = useState<string>('')
	const [userToRemove, setUserToRemove] = useState<number | null>(null)

	useEffect(() => {
		if (isOpen) {
			loadAvailableUsers()
		}
	}, [isOpen])

	async function loadAvailableUsers() {
		try {
			const res = await getUsersWithWarehouseRoleAction()
			if (res.success && res.users) {
				// –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –∑–∞ —ç—Ç–∏–º —Å–∫–ª–∞–¥–æ–º
				const assignedUserIds = workers.map(w => w.userId)
				const available = res.users.filter(
					u => !assignedUserIds.includes(u.id),
				)
				setAvailableUsers(available)
			}
		} catch (error) {
			console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error)
		}
	}

	async function handleAddWorker() {
		if (!selectedUserId) {
			toast.error('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞')
			return
		}

		setIsLoading(true)
		try {
			const res = await addWorkerToWarehouseAction(
				warehouseId,
				Number(selectedUserId),
			)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω')
				setSelectedUserId('')
				// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
				await loadAvailableUsers()
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
				router.refresh()
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	async function handleRemoveWorker(userId: number) {
		setIsLoading(true)
		try {
			const res = await removeWorkerFromWarehouseAction(warehouseId, userId)

			if (res.error) {
				toast.error(res.error)
			} else {
				toast.success('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª–µ–Ω')
				setUserToRemove(null)
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
				setWorkers(workers.filter(w => w.userId !== userId))
				await loadAvailableUsers()
			}
		} catch (error) {
			toast.error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫')
		} finally {
			setIsLoading(false)
		}
	}

	const getUserDisplayName = (user: User) => {
		if (user.firstName || user.lastName) {
			return `${user.firstName || ''} ${user.lastName || ''}`.trim()
		}
		return user.email
	}

	return (
		<>
			<Dialog open={isOpen} onOpenChange={setIsOpen}>
				<DialogTrigger asChild>
					<Button variant='outline' size='sm'>
						<Users className='mr-2 h-4 w-4' />
						–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ({workers.length})
					</Button>
				</DialogTrigger>
				<DialogContent className='max-w-2xl'>
					<DialogHeader>
						<DialogTitle>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ —Å–∫–ª–∞–¥–∞</DialogTitle>
						<DialogDescription>
							–°–∫–ª–∞–¥: {warehouseName}
						</DialogDescription>
					</DialogHeader>

					<div className='space-y-4'>
						{/* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */}
						<div className='space-y-2'>
							<label className='text-sm font-medium'>
								–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
							</label>
							<div className='flex gap-2'>
								<Select
									value={selectedUserId}
									onValueChange={setSelectedUserId}
									disabled={isLoading || availableUsers.length === 0}
								>
									<SelectTrigger className='flex-1'>
										<SelectValue
											placeholder={
												availableUsers.length === 0
													? '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'
													: '–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞'
											}
										/>
									</SelectTrigger>
									<SelectContent>
										{availableUsers.map(user => (
											<SelectItem
												key={user.id}
												value={user.id.toString()}
											>
												{getUserDisplayName(user)} ({user.email})
											</SelectItem>
										))}
									</SelectContent>
								</Select>
								<Button
									onClick={handleAddWorker}
									disabled={isLoading || !selectedUserId}
									size='sm'
								>
									{isLoading ? (
										<Loader2 className='h-4 w-4 animate-spin' />
									) : (
										<Plus className='h-4 w-4' />
									)}
								</Button>
							</div>
						</div>

						{/* –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */}
						<div className='space-y-2'>
							<label className='text-sm font-medium'>
								–¢–µ–∫—É—â–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ({workers.length})
							</label>
							{workers.length === 0 ? (
								<p className='text-sm text-muted-foreground'>
									–ù–∞ —ç—Ç–æ–º —Å–∫–ª–∞–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
								</p>
							) : (
								<div className='space-y-2'>
									{workers.map(worker => (
										<div
											key={worker.id}
											className='flex items-center justify-between rounded-md border p-3'
										>
											<div className='flex-1'>
												<div className='font-medium'>
													{getUserDisplayName(worker.user)}
												</div>
												<div className='text-sm text-muted-foreground'>
													{worker.user.email}
												</div>
											</div>
											<Button
												variant='ghost'
												size='icon'
												onClick={() => setUserToRemove(worker.userId)}
												disabled={isLoading}
											>
												<Trash2 className='h-4 w-4 text-destructive' />
											</Button>
										</div>
									))}
								</div>
							)}
						</div>
					</div>
				</DialogContent>
			</Dialog>

			{/* –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è */}
			<AlertDialog
				open={userToRemove !== null}
				onOpenChange={open => !open && setUserToRemove(null)}
			>
				<AlertDialogContent>
					<AlertDialogHeader>
						<AlertDialogTitle>–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?</AlertDialogTitle>
						<AlertDialogDescription>
							–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å–æ —Å–∫–ª–∞–¥–∞?
							–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
						</AlertDialogDescription>
					</AlertDialogHeader>
					<AlertDialogFooter>
						<AlertDialogCancel onClick={() => setUserToRemove(null)}>
							–û—Ç–º–µ–Ω–∞
						</AlertDialogCancel>
						<AlertDialogAction
							onClick={() => {
								if (userToRemove !== null) {
									handleRemoveWorker(userToRemove)
								}
							}}
							disabled={isLoading}
							className='bg-destructive text-destructive-foreground hover:bg-destructive/90'
						>
							–£–¥–∞–ª–∏—Ç—å
						</AlertDialogAction>
					</AlertDialogFooter>
				</AlertDialogContent>
			</AlertDialog>
		</>
	)
}
</file>

<file path="src/components/RealtimeRefresher.tsx">
'use client'
import { useRefreshOnEvent } from '@/hooks/use-refresh-on-event'

export const RealtimeRefresher = ({ eventName }: { eventName: string }) => {
	useRefreshOnEvent(eventName)
	return null
}
</file>

<file path="src/components/theme-provider.tsx">
'use client'

import { ThemeProvider as NextThemesProvider } from 'next-themes'
import * as React from 'react'

export function ThemeProvider({
	children,
	...props
}: React.ComponentProps<typeof NextThemesProvider>) {
	return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
</file>

<file path="src/components/theme-toggle.tsx">
'use client'

import { Button } from '@/components/ui/button'
import { Moon, Sun } from 'lucide-react'
import { useTheme } from 'next-themes'
import * as React from 'react'

export function ModeToggle() {
	const { theme, setTheme, resolvedTheme } = useTheme()
	const [mounted, setMounted] = React.useState(false)

	// –ñ–¥–µ–º, –ø–æ–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏
	React.useEffect(() => {
		setMounted(true)
	}, [])

	if (!mounted) {
		return (
			<Button variant='outline' size='icon' disabled className='opacity-50' />
		)
	}

	// –ò—Å–ø–æ–ª—å–∑—É–µ–º resolvedTheme, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
	const isDark = resolvedTheme === 'dark'

	return (
		<Button
			variant='outline'
			size='icon'
			onClick={() => setTheme(isDark ? 'light' : 'dark')}
			title={isDark ? '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–í–∫–ª—é—á–∏—Ç—å —Ç–µ–º–Ω—É—é —Ç–µ–º—É'}
		>
			{isDark ? <Sun className='h-4 w-4' /> : <Moon className='h-4 w-4' />}
		</Button>
	)
}
</file>

<file path="src/components/ToggleProductStatusButton.tsx">
'use client'

import { Button } from '@/components/ui/button'
import { toggleProductAvailabilityAction } from '@/server-actions/products.action'
import { Eye, EyeOff } from 'lucide-react'
import { useState, useTransition } from 'react'
import { toast } from 'sonner'

interface ToggleProps {
	productId: number
	isAvailable: boolean
}

export function ToggleProductStatusButton({
	productId,
	isAvailable,
}: ToggleProps) {
	const [isPending, startTransition] = useTransition()
	// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
	const [optimisticStatus, setOptimisticStatus] = useState(isAvailable)

	const handleToggle = () => {
		const newStatus = !optimisticStatus
		setOptimisticStatus(newStatus) // –ú–µ–Ω—è–µ–º —Å—Ä–∞–∑—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

		startTransition(async () => {
			const result = await toggleProductAvailabilityAction(
				productId,
				optimisticStatus,
			)
			if (result.error) {
				setOptimisticStatus(!newStatus) // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
				toast.error(result.error)
			} else {
				toast.success(newStatus ? '–¢–æ–≤–∞—Ä —Ç–µ–ø–µ—Ä—å –≤–∏–¥–µ–Ω' : '–¢–æ–≤–∞—Ä —Å–∫—Ä—ã—Ç')
			}
		})
	}

	return (
		<Button
			variant='ghost'
			size='icon'
			onClick={handleToggle}
			disabled={isPending}
			className={optimisticStatus ? 'text-green-600' : 'text-muted-foreground'}
			title={optimisticStatus ? '–°–∫—Ä—ã—Ç—å —Ç–æ–≤–∞—Ä' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä'}
		>
			{optimisticStatus ? (
				<Eye className='h-4 w-4' />
			) : (
				<EyeOff className='h-4 w-4' />
			)}
		</Button>
	)
}
</file>

<file path="src/components/ui/alert-dialog.tsx">
"use client"

import * as React from "react"
import { AlertDialog as AlertDialogPrimitive } from "radix-ui"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  )
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  )
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogContent({
  className,
  size = "default",
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content> & {
  size?: "default" | "sm"
}) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        data-size={size}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 group/alert-dialog-content fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 data-[size=sm]:max-w-xs data-[size=default]:sm:max-w-lg",
          className
        )}
        {...props}
      />
    </AlertDialogPortal>
  )
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn(
        "grid grid-rows-[auto_1fr] place-items-center gap-1.5 text-center has-data-[slot=alert-dialog-media]:grid-rows-[auto_auto_1fr] has-data-[slot=alert-dialog-media]:gap-x-6 sm:group-data-[size=default]/alert-dialog-content:place-items-start sm:group-data-[size=default]/alert-dialog-content:text-left sm:group-data-[size=default]/alert-dialog-content:has-data-[slot=alert-dialog-media]:grid-rows-[auto_1fr]",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 group-data-[size=sm]/alert-dialog-content:grid group-data-[size=sm]/alert-dialog-content:grid-cols-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn(
        "text-lg font-semibold sm:group-data-[size=default]/alert-dialog-content:group-has-data-[slot=alert-dialog-media]/alert-dialog-content:col-start-2",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function AlertDialogMedia({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-media"
      className={cn(
        "bg-muted mb-2 inline-flex size-16 items-center justify-center rounded-md sm:group-data-[size=default]/alert-dialog-content:row-span-2 *:[svg:not([class*='size-'])]:size-8",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogAction({
  className,
  variant = "default",
  size = "default",
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action> &
  Pick<React.ComponentProps<typeof Button>, "variant" | "size">) {
  return (
    <Button variant={variant} size={size} asChild>
      <AlertDialogPrimitive.Action
        data-slot="alert-dialog-action"
        className={cn(className)}
        {...props}
      />
    </Button>
  )
}

function AlertDialogCancel({
  className,
  variant = "outline",
  size = "default",
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel> &
  Pick<React.ComponentProps<typeof Button>, "variant" | "size">) {
  return (
    <Button variant={variant} size={size} asChild>
      <AlertDialogPrimitive.Cancel
        data-slot="alert-dialog-cancel"
        className={cn(className)}
        {...props}
      />
    </Button>
  )
}

export {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogMedia,
  AlertDialogOverlay,
  AlertDialogPortal,
  AlertDialogTitle,
  AlertDialogTrigger,
}
</file>

<file path="src/components/ui/alert.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="src/components/ui/avatar.tsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  size = "default",
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root> & {
  size?: "default" | "sm" | "lg"
}) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      data-size={size}
      className={cn(
        "group/avatar relative flex size-8 shrink-0 overflow-hidden rounded-full select-none data-[size=lg]:size-10 data-[size=sm]:size-6",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted text-muted-foreground flex size-full items-center justify-center rounded-full text-sm group-data-[size=sm]/avatar:text-xs",
        className
      )}
      {...props}
    />
  )
}

function AvatarBadge({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="avatar-badge"
      className={cn(
        "bg-primary text-primary-foreground ring-background absolute right-0 bottom-0 z-10 inline-flex items-center justify-center rounded-full ring-2 select-none",
        "group-data-[size=sm]/avatar:size-2 group-data-[size=sm]/avatar:[&>svg]:hidden",
        "group-data-[size=default]/avatar:size-2.5 group-data-[size=default]/avatar:[&>svg]:size-2",
        "group-data-[size=lg]/avatar:size-3 group-data-[size=lg]/avatar:[&>svg]:size-2",
        className
      )}
      {...props}
    />
  )
}

function AvatarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="avatar-group"
      className={cn(
        "*:data-[slot=avatar]:ring-background group/avatar-group flex -space-x-2 *:data-[slot=avatar]:ring-2",
        className
      )}
      {...props}
    />
  )
}

function AvatarGroupCount({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="avatar-group-count"
      className={cn(
        "bg-muted text-muted-foreground ring-background relative flex size-8 shrink-0 items-center justify-center rounded-full text-sm ring-2 group-has-data-[size=lg]/avatar-group:size-10 group-has-data-[size=sm]/avatar-group:size-6 [&>svg]:size-4 group-has-data-[size=lg]/avatar-group:[&>svg]:size-5 group-has-data-[size=sm]/avatar-group:[&>svg]:size-3",
        className
      )}
      {...props}
    />
  )
}

export {
  Avatar,
  AvatarImage,
  AvatarFallback,
  AvatarBadge,
  AvatarGroup,
  AvatarGroupCount,
}
</file>

<file path="src/components/ui/badge.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { Slot } from "radix-ui"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border border-transparent px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        ghost: "[a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        link: "text-primary underline-offset-4 [a&]:hover:underline",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot.Root : "span"

  return (
    <Comp
      data-slot="badge"
      data-variant={variant}
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { Slot } from "radix-ui"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        xs: "h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-xs": "size-6 rounded-md [&_svg:not([class*='size-'])]:size-3",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot.Root : "button"

  return (
    <Comp
      data-slot="button"
      data-variant={variant}
      data-size={size}
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="src/components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 outline-none sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({
  className,
  showCloseButton = false,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  showCloseButton?: boolean
}) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    >
      {children}
      {showCloseButton && (
        <DialogPrimitive.Close asChild>
          <Button variant="outline">Close</Button>
        </DialogPrimitive.Close>
      )}
    </div>
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="src/components/ui/dropdown-menu.tsx">
"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="src/components/ui/label.tsx">
"use client"

import * as React from "react"
import { Label as LabelPrimitive } from "radix-ui"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="src/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "item-aligned",
  align = "center",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        align={align}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span
        data-slot="select-item-indicator"
        className="absolute right-2 flex size-3.5 items-center justify-center"
      >
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="src/components/ui/separator.tsx">
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className
      )}
      {...props}
    />
  )
}

export { Separator }
</file>

<file path="src/components/ui/sheet.tsx">
"use client"

import * as React from "react"
import { XIcon } from "lucide-react"
import { Dialog as SheetPrimitive } from "radix-ui"

import { cn } from "@/lib/utils"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
  showCloseButton?: boolean
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
            <XIcon className="size-4" />
            <span className="sr-only">Close</span>
          </SheetPrimitive.Close>
        )}
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}
</file>

<file path="src/components/ui/sidebar.tsx">
"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { PanelLeftIcon } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContextProps = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean
  open?: boolean
  onOpenChange?: (open: boolean) => void
}) {
  const isMobile = useIsMobile()
  const [openMobile, setOpenMobile] = React.useState(false)

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen)
  const open = openProp ?? _open
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value
      if (setOpenProp) {
        setOpenProp(openState)
      } else {
        _setOpen(openState)
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
    },
    [setOpenProp, open]
  )

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)
  }, [isMobile, setOpen, setOpenMobile])

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault()
        toggleSidebar()
      }
    }

    window.addEventListener("keydown", handleKeyDown)
    return () => window.removeEventListener("keydown", handleKeyDown)
  }, [toggleSidebar])

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed"

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
  )

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  )
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right"
  variant?: "sidebar" | "floating" | "inset"
  collapsible?: "offcanvas" | "icon" | "none"
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className
        )}
        {...props}
      >
        {children}
      </div>
    )
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    )
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)"
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  )
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className
      )}
      {...props}
    />
  )
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  )
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  )
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  )
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  )
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  )
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean
  isActive?: boolean
  tooltip?: string | React.ComponentProps<typeof TooltipContent>
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button"
  const { isMobile, state } = useSidebar()

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  )

  if (!tooltip) {
    return button
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    }
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  )
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean
  showOnHover?: boolean
}) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  )
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean
  size?: "sm" | "md"
  isActive?: boolean
}) {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}
</file>

<file path="src/components/ui/skeleton.tsx">
import { cn } from "@/lib/utils"

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  )
}

export { Skeleton }
</file>

<file path="src/components/ui/table.tsx">
"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/components/ui/tabs.tsx">
"use client"

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { Tabs as TabsPrimitive } from "radix-ui"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  orientation = "horizontal",
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      data-orientation={orientation}
      orientation={orientation}
      className={cn(
        "group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",
        className
      )}
      {...props}
    />
  )
}

const tabsListVariants = cva(
  "rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",
  {
    variants: {
      variant: {
        default: "bg-muted",
        line: "gap-1 bg-transparent",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function TabsList({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List> &
  VariantProps<typeof tabsListVariants>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      data-variant={variant}
      className={cn(tabsListVariants({ variant }), className)}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        "group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent",
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground",
        "after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent, tabsListVariants }
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="src/components/ui/tooltip.tsx">
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  )
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  )
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  )
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
</file>

<file path="src/components/UpdateOrderStatusButton.tsx">
'use client'

import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
} from '@/components/ui/select'
import { updateOrderStatusAction } from '@/server-actions/orders.action'
import { useState } from 'react'

const STATUS_LABELS: Record<string, string> = {
	PENDING: '–û–∂–∏–¥–∞–Ω–∏–µ',
	PROCESSING: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
	SHIPPED: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
	DELIVERED: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ',
	CANCELED: '–û—Ç–º–µ–Ω–µ–Ω–æ',
}

const STATUS_COLORS: Record<string, string> = {
	PENDING: 'bg-yellow-100 text-yellow-800',
	PROCESSING: 'bg-blue-100 text-blue-800',
	SHIPPED: 'bg-purple-100 text-purple-800',
	DELIVERED: 'bg-green-100 text-green-800',
	CANCELED: 'bg-red-100 text-red-800',
}

interface UpdateOrderStatusButtonProps {
	orderId: number
	currentStatus: string
	disabled?: boolean
}

export function UpdateOrderStatusButton({
	orderId,
	currentStatus,
	disabled = false,
}: UpdateOrderStatusButtonProps) {
	const [isLoading, setIsLoading] = useState(false)
	const [status, setStatus] = useState<string>(currentStatus)

	const handleStatusChange = async (newStatus: string) => {
		setIsLoading(true)
		try {
			const result = await updateOrderStatusAction(orderId, newStatus)
			if (result.error) {
				alert(result.error)
				setStatus(currentStatus)
			} else {
				setStatus(newStatus)
			}
		} catch (error) {
			alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞')
			setStatus(currentStatus)
		} finally {
			setIsLoading(false)
		}
	}

	// –î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å
	const isEditable = status !== 'DELIVERED' && status !== 'CANCELED'

	return (
		<div className='flex items-center gap-2'>
			<Select
				value={status}
				onValueChange={handleStatusChange}
				disabled={!isEditable || isLoading || disabled}
			>
				<SelectTrigger className='w-auto border-none bg-transparent p-0 h-auto'>
					<span
						className={`px-2 py-1 rounded-full text-xs font-medium ${STATUS_COLORS[status]}`}
					>
						{STATUS_LABELS[status]}
					</span>
				</SelectTrigger>
				<SelectContent>
					{Object.entries(STATUS_LABELS).map(([key, label]) => (
						<SelectItem
							key={key}
							value={key}
							disabled={key === 'CANCELED' && status !== 'PENDING'}
						>
							{label}
						</SelectItem>
					))}
				</SelectContent>
			</Select>
		</div>
	)
}

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
export function OrderStatusBadge({ status }: { status: string }) {
	return (
		<span
			className={`px-2 py-1 rounded-full text-xs font-medium ${STATUS_COLORS[status]}`}
		>
			{STATUS_LABELS[status]}
		</span>
	)
}
</file>

<file path="src/hooks/use-mobile.ts">
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}
</file>

<file path="src/hooks/use-refresh-on-event.ts">
'use client'

import { useSocket } from '@/providers/socket-provider'
import { useRouter } from 'next/navigation'
import { useEffect } from 'react'

export const useRefreshOnEvent = (eventName: string) => {
	const { socket } = useSocket()
	const router = useRouter()

	useEffect(() => {
		if (!socket) return

		socket.on(eventName, () => {
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			router.refresh()
		})

		return () => {
			socket.off(eventName)
		}
	}, [socket, eventName, router])
}
</file>

<file path="src/lib/date-utils.ts">
// –ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
export function formatDate(date: Date | string): string {
	const d = typeof date === 'string' ? new Date(date) : date
	const options: Intl.DateTimeFormatOptions = {
		year: 'numeric',
		month: 'long',
		day: 'numeric',
		locale: 'ru-RU',
	}
	return d.toLocaleDateString('ru-RU', options)
}

export function formatDateTime(date: Date | string): string {
	const d = typeof date === 'string' ? new Date(date) : date
	const options: Intl.DateTimeFormatOptions = {
		year: 'numeric',
		month: 'long',
		day: 'numeric',
		hour: '2-digit',
		minute: '2-digit',
		locale: 'ru-RU',
	}
	return d.toLocaleDateString('ru-RU', options)
}

export function formatDateShort(date: Date | string): string {
	const d = typeof date === 'string' ? new Date(date) : date
	const day = String(d.getDate()).padStart(2, '0')
	const month = String(d.getMonth() + 1).padStart(2, '0')
	const year = d.getFullYear()
	return `${day}.${month}.${year}`
}
</file>

<file path="src/lib/links.ts">
import {
	BarChart3,
	FolderTree,
	LayoutDashboard,
	Package,
	ShoppingCart,
	Users,
	Warehouse,
} from 'lucide-react'

export const MENU_ADMIN = [
	{ href: '/admin', icon: LayoutDashboard, label: '–î–∞—à–±–æ—Ä–¥' },
	{ href: '/admin/dashboard/analytics', icon: BarChart3, label: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞' },
	{ href: '/admin/dashboard/categories', icon: FolderTree, label: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏' },
	{ href: '/admin/dashboard/products', icon: Package, label: '–¢–æ–≤–∞—Ä—ã' },
	{ href: '/admin/dashboard/orders', icon: ShoppingCart, label: '–ó–∞–∫–∞–∑—ã' },
	{ href: '/admin/dashboard/warehouses', icon: Warehouse, label: '–°–∫–ª–∞–¥—ã' },
	{ href: '/admin/dashboard/users', icon: Users, label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏' },
]
</file>

<file path="src/lib/prisma.ts">
import { PrismaPg } from '@prisma/adapter-pg'
import 'dotenv/config'
import { PrismaClient } from '../generated/prisma/client'

const connectionString = `${process.env.DATABASE_URL}`

const adapter = new PrismaPg({ connectionString })
const prisma = new PrismaClient({ adapter })

export { prisma }
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/pages/api/socket.ts">
import { Server as NetServer } from 'http'
import { NextApiRequest } from 'next'
import { Server as ServerIO } from 'socket.io'

export const config = {
	api: {
		bodyParser: false,
	},
}

const handler = (req: NextApiRequest, res: any) => {
	if (!res.socket.server.io) {
		console.log('--- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.io —Å–µ—Ä–≤–µ—Ä–∞ ---')
		const httpServer: NetServer = res.socket.server
		const io = new ServerIO(httpServer, {
			path: '/api/socket',
			addTrailingSlash: false,
		})
		res.socket.server.io = io

		io.on('connection', socket => {
			console.log('–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è:', socket.id)

			// –°–ª—É—à–∞–µ–º —Å–∏–≥–Ω–∞–ª –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
			socket.on('update-data', () => {
				// –†–∞—Å—Å—ã–ª–∞–µ–º –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º —Å–∏–≥–Ω–∞–ª "–ø–æ—Ä–∞ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è"
				socket.broadcast.emit('refresh')
			})
		})
	}
	res.end()
}

export default handler
</file>

<file path="src/providers/socket-provider.tsx">
'use client'

import React, { createContext, useContext, useEffect, useState } from 'react'
import { io as ClientIO } from 'socket.io-client'

type SocketContextType = {
	socket: any | null
	isConnected: boolean
}

const SocketContext = createContext<SocketContextType>({
	socket: null,
	isConnected: false,
})

export const useSocket = () => useContext(SocketContext)

export const SocketProvider = ({ children }: { children: React.ReactNode }) => {
	const [socket, setSocket] = useState<any>(null)
	const [isConnected, setIsConnected] = useState(false)

	useEffect(() => {
		const initSocket = async () => {
			// 1. –ñ–¥–µ–º, –ø–æ–∫–∞ —Å–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–∫–µ—Ç—ã
			const res = await fetch('/api/socket')

			if (res.ok) {
				// 2. –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª 200 OK, —Å–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç–∞–Ω—Å
				const socketInstance = ClientIO({
					path: '/api/socket',
					addTrailingSlash: false,
					// –î–æ–±–∞–≤–∏–º —ç—Ç–æ, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–ø–∞–º–∏–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ
					reconnectionAttempts: 5,
				})

				socketInstance.on('connect', () => {
					setIsConnected(true)
					console.log('Socket Connected')
				})

				socketInstance.on('disconnect', () => setIsConnected(false))

				setSocket(socketInstance)
			}
		}

		initSocket()

		return () => {
			socket?.disconnect()
		}
	}, [])

	return (
		<SocketContext.Provider value={{ socket, isConnected }}>
			{children}
		</SocketContext.Provider>
	)
}
</file>

<file path="src/server-actions/analytics.action.ts">
'use server'

import { analyticsService } from '@/services/analytics.service'

// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –≤—ã—Ä—É—á–∫–µ
export async function getTopCategoriesByRevenueAction() {
	try {
		return await analyticsService.getTopCategoriesByRevenue()
	} catch (error) {
		console.error('Error getting top categories:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ
export async function getAboveAverageSpendersAction() {
	try {
		return await analyticsService.getAboveAverageSpenders()
	} catch (error) {
		console.error('Error getting above average spenders:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
export async function getUnorderedProductsAction() {
	try {
		return await analyticsService.getUnorderedProducts()
	} catch (error) {
		console.error('Error getting unordered products:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
export async function getAverageRatingByCategoryAction() {
	try {
		return await analyticsService.getAverageRatingByCategory()
	} catch (error) {
		console.error('Error getting average rating by category:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º
export async function getOrdersByCityAction() {
	try {
		return await analyticsService.getOrdersByCity()
	} catch (error) {
		console.error('Error getting orders by city:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –¥–∏–Ω–∞–º–∏–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
export async function getUserRegistrationDynamicsAction() {
	try {
		return await analyticsService.getUserRegistrationDynamics()
	} catch (error) {
		console.error('Error getting user registration dynamics:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫
export async function getCriticallyLowStockAction() {
	try {
		return await analyticsService.getCriticallyLowStock()
	} catch (error) {
		console.error('Error getting critically low stock:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
export async function getWarehouseValueAction() {
	try {
		return await analyticsService.getWarehouseValue()
	} catch (error) {
		console.error('Error getting warehouse value:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—è—á–Ω—É—é –≤—ã—Ä—É—á–∫—É
export async function getMonthlyRevenueAction() {
	try {
		return await analyticsService.getMonthlyRevenue()
	} catch (error) {
		console.error('Error getting monthly revenue:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
export async function getTopProductsByCategoryAction() {
	try {
		return await analyticsService.getTopProductsByCategory()
	} catch (error) {
		console.error('Error getting top products by category:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Ü–µ–Ω–∑–µ–Ω—Ç–æ–≤
export async function getActiveReviewersAction() {
	try {
		return await analyticsService.getActiveReviewers()
	} catch (error) {
		console.error('Error getting active reviewers:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
export async function getPromoUsagePercentAction() {
	try {
		return await analyticsService.getPromoUsagePercent()
	} catch (error) {
		console.error('Error getting promo usage percent:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã VIP
export async function getVIPPaymentMethodsAction() {
	try {
		return await analyticsService.getVIPPaymentMethods()
	} catch (error) {
		console.error('Error getting VIP payment methods:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞—à–±–æ—Ä–¥–∞
export async function getDashboardStatsAction() {
	try {
		return await analyticsService.getDashboardStats()
	} catch (error) {
		console.error('Error getting dashboard stats:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–Ω–¥ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –º–µ—Å—è—Ü
export async function getOrdersTrendLastMonthAction() {
	try {
		return await analyticsService.getOrdersTrendLastMonth()
	} catch (error) {
		console.error('Error getting orders trend:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –ª—É—á—à–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
export async function getTopRatedProductsAction() {
	try {
		return await analyticsService.getTopRatedProducts()
	} catch (error) {
		console.error('Error getting top rated products:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
export async function getOrderStatusDistributionAction() {
	try {
		return await analyticsService.getOrderStatusDistribution()
	} catch (error) {
		console.error('Error getting order status distribution:', error)
		throw error
	}
}

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∑–∞–∫–∞–∑–∞
export async function getAverageOrderValueAction() {
	try {
		return await analyticsService.getAverageOrderValue()
	} catch (error) {
		console.error('Error getting average order value:', error)
		throw error
	}
}
</file>

<file path="src/server-actions/categories.action.ts">
'use server'

import { prisma } from '@/lib/prisma'
import { categoryService } from '@/services/categories.service'
import { revalidatePath } from 'next/cache'

export async function createCategoryAction(formData: FormData) {
	const name = formData.get('name') as string
	const description = formData.get('description') as string
	const parentId = formData.get('parentCategoryId')
	const imageUrl = formData.get('imageUrl') as string

	if (!name) {
		return { error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' }
	}

	try {
		await categoryService.create({
			name,
			description,
			parentCategoryId: parentId ? Number(parentId) : undefined,
			imageUrl,
		})

		// –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
		revalidatePath('/admin/categories')

		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' }
	}
}
export async function manageCategoryAction(formData: FormData) {
	const id = formData.get('id') as string | null
	const name = formData.get('name') as string
	const description = formData.get('description') as string
	const parentCategoryId = formData.get('parentCategoryId') as string
	const imageUrl = formData.get('imageUrl') as string

	if (!name) {
		return { error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ' }
	}

	try {
		const parentId = parentCategoryId === '0' ? null : Number(parentCategoryId)

		if (id) {
			// –õ–æ–≥–∏–∫–∞ –û–ë–ù–û–í–õ–ï–ù–ò–Ø
			await prisma.category.update({
				where: { id: Number(id) },
				data: {
					name,
					description,
					parentCategoryId: parentId,
					categoryImage: imageUrl
						? {
								upsert: {
									create: { url: imageUrl },
									update: { url: imageUrl },
								},
							}
						: undefined,
				},
			})
		} else {
			// –õ–æ–≥–∏–∫–∞ –°–û–ó–î–ê–ù–ò–Ø
			await prisma.category.create({
				data: {
					name,
					description,
					parentCategoryId: parentId,
					categoryImage: imageUrl
						? {
								create: { url: imageUrl },
							}
						: undefined,
				},
			})
		}

		// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
		revalidatePath('/admin/categories')
		return { success: true }
	} catch (error: any) {
		if (error.code === 'P2002') {
			return { error: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' }
		}
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' }
	}
}
export async function deleteCategoryAction(id: number) {
	try {
		await prisma.category.delete({
			where: { id },
		})

		// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å—å –∏—Å—á–µ–∑–ª–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
		revalidatePath('/admin/dashboard/categories')
		return { success: true }
	} catch (error) {
		console.error('Delete error:', error)
		return {
			error:
				'–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏.',
		}
	}
}
</file>

<file path="src/server-actions/orders.action.ts">
'use server'

import { prisma } from '@/lib/prisma'
import { orderService } from '@/services/orders.service'
import { revalidatePath } from 'next/cache'

// –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
export async function createOrderAction(
	userId: number,
	addressId: number,
	paymentMethodId?: number,
	promocodeCode?: string,
) {
	try {
		// –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
		const cart = await prisma.cart.findUnique({
			where: { userId },
			include: {
				items: {
					include: {
						product: true,
					},
				},
			},
		})

		if (!cart || cart.items.length === 0) {
			return { error: '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞' }
		}

		// –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
		const address = await prisma.address.findUnique({
			where: { id: addressId },
		})

		if (!address) {
			return { error: '–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω' }
		}

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
		let promocodeId: number | undefined
		if (promocodeCode) {
			const promo = await prisma.promocode.findUnique({
				where: { code: promocodeCode },
			})

			if (!promo) {
				return { error: '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω' }
			}

			if (new Date() > promo.validUntil) {
				return { error: '–ü—Ä–æ–º–æ–∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω' }
			}

			promocodeId = promo.id
		}

		// –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
		const order = await orderService.createFromCart({
			userId,
			addressId,
			deliveryCity: address.city,
			deliveryStreet: address.street,
			promocodeId,
			paymentMethodId,
			items: cart.items.map(item => ({
				productId: item.productId,
				quantity: item.quantity,
				priceAtPurchase: Number(item.product.basePrice),
			})),
		})

		// –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
		await prisma.cartItem.deleteMany({
			where: { cartId: cart.id },
		})

		revalidatePath('/orders')
		revalidatePath('/admin/dashboard/orders')

		return { success: true, orderId: order.id }
	} catch (error) {
		console.error('Create order error:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑' }
	}
}

// –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
export async function updateOrderStatusAction(orderId: number, status: string) {
	try {
		await orderService.updateStatus(orderId, status)
		revalidatePath('/admin/dashboard/orders')
		return { success: true }
	} catch (error) {
		console.error('Update order status error:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞' }
	}
}

// –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
export async function cancelOrderAction(orderId: number) {
	try {
		await orderService.cancel(orderId)
		revalidatePath('/orders')
		revalidatePath('/admin/dashboard/orders')
		return { success: true }
	} catch (error) {
		console.error('Cancel order error:', error)
		return {
			error:
				error instanceof Error ? error.message : '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑',
		}
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
export async function getOrderDetailsAction(orderId: number) {
	try {
		const order = await orderService.getById(orderId)
		if (!order) {
			return { error: '–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω' }
		}
		return { success: true, order }
	} catch (error) {
		console.error('Get order details error:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞' }
	}
}

// –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
export async function getUserOrdersAction(userId: number) {
	try {
		const orders = await orderService.getByUserId(userId)
		return { success: true, orders }
	} catch (error) {
		console.error('Get user orders error:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã' }
	}
}
</file>

<file path="src/server-actions/products.action.ts">
'use server'

import { prisma } from '@/lib/prisma'
import { revalidatePath } from 'next/cache'
import { productService } from '@/services/prosuct.service'

export async function toggleProductAvailabilityAction(
	id: number,
	currentStatus: boolean,
) {
	try {
		await prisma.product.update({
			where: { id },
			data: {
				isAvailable: !currentStatus,
			},
		})

		revalidatePath('/admin/dashboard/products')
		return { success: true }
	} catch (error) {
		console.error('Toggle availability error:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞' }
	}
}

export async function manageProductAction(formData: FormData) {
	const id = formData.get('id') as string | null
	const name = formData.get('name') as string
	const description = formData.get('description') as string
	const basePrice = formData.get('basePrice') as string
	const categoryId = formData.get('categoryId') as string
	const isAvailable = formData.get('isAvailable') === 'true' || formData.get('isAvailable') === 'on'
	const hasVariants = formData.get('hasVariants') === 'true' || formData.get('hasVariants') === 'on'
	const imageUrls = formData.get('imageUrls') as string | null
	const variantsJson = formData.get('variants') as string | null
	const stocksJson = formData.get('stocks') as string | null

	if (!name || !basePrice || !categoryId) {
		return { error: '–ù–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }
	}

	try {
		const imageUrlsArray = imageUrls ? JSON.parse(imageUrls) : []
		const variants = variantsJson ? JSON.parse(variantsJson) : []
		const stocks = stocksJson ? JSON.parse(stocksJson) : []

		// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
		if (hasVariants && variants.length === 0) {
			return { error: '–î–ª—è —Ç–æ–≤–∞—Ä–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç' }
		}

		// –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤
		const validStocks = stocks.filter(
			(stock: { warehouseId: number; quantity: number }) =>
				stock.warehouseId && stock.quantity !== undefined && stock.quantity >= 0,
		)

		if (id) {
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
			await productService.update(Number(id), {
				name,
				description: description || undefined,
				basePrice: Number(basePrice),
				categoryId: Number(categoryId),
				isAvailable,
				hasVariants,
				imageUrls: imageUrlsArray.length > 0 ? imageUrlsArray : undefined,
				variants: variants.length > 0 ? variants : undefined,
				stocks: validStocks.length > 0 ? validStocks : undefined,
			})
		} else {
			// –°–æ–∑–¥–∞–Ω–∏–µ
			await productService.create({
				name,
				description: description || undefined,
				basePrice: Number(basePrice),
				categoryId: Number(categoryId),
				isAvailable,
				hasVariants,
				imageUrls: imageUrlsArray.length > 0 ? imageUrlsArray : undefined,
				variants: variants.length > 0 ? variants : undefined,
				stocks: validStocks.length > 0 ? validStocks : undefined,
			})
		}

		revalidatePath('/admin/dashboard/products')
		return { success: true }
	} catch (error: any) {
		console.error('Manage product error:', error)
		if (error.code === 'P2002') {
			return { error: '–¢–æ–≤–∞—Ä —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' }
		}
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞' }
	}
}

export async function deleteProductAction(id: number) {
	try {
		await productService.delete(id)
		revalidatePath('/admin/dashboard/products')
		return { success: true }
	} catch (error: any) {
		console.error('Delete product error:', error)
		// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫—É —Ç—Ä–∏–≥–≥–µ—Ä–∞ –æ –∑–∞—â–∏—Ç–µ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è
		if (error.message?.includes('–∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–∫–∞–∑–µ')) {
			return { error: '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–∫–∞–∑–µ!' }
		}
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞' }
	}
}
</file>

<file path="src/server-actions/users.action.ts">
'use server'

import { prisma } from '@/lib/prisma'
import { usersService } from '@/services/users.service'
import bcrypt from 'bcryptjs'
import { revalidatePath } from 'next/cache'

export async function createUserAction(formData: FormData) {
	const email = formData.get('email') as string
	const password = formData.get('password') as string
	const firstName = formData.get('firstName') as string
	const lastName = formData.get('lastName') as string
	const role = formData.get('role') as string
	const avatarUrl = formData.get('avatarUrl') as string

	if (!email || !password) {
		return { error: 'Email –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }
	}

	try {
		// –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
		const existingUser = await prisma.user.findUnique({
			where: { email },
		})

		if (existingUser) {
			return { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' }
		}

		// –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
		const hashedPassword = await bcrypt.hash(password, 10)

		await usersService.create({
			email,
			password: hashedPassword,
			firstName: firstName || undefined,
			lastName: lastName || undefined,
			role: role as any,
			avatarUrl: avatarUrl || undefined,
		})

		revalidatePath('/admin/dashboard/users')
		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }
	}
}

export async function updateUserAction(formData: FormData) {
	const id = formData.get('id') as string
	const email = formData.get('email') as string
	const firstName = formData.get('firstName') as string
	const lastName = formData.get('lastName') as string
	const role = formData.get('role') as string
	const avatarUrl = formData.get('avatarUrl') as string
	const password = formData.get('password') as string

	if (!id || !email) {
		return { error: 'ID –∏ email –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }
	}

	try {
		const updateData: Record<string, any> = {
			email,
			firstName: firstName || null,
			lastName: lastName || null,
			role,
			avatarUrl: avatarUrl || null,
		}

		// –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞–Ω, —Ö–µ—à–∏—Ä—É–µ–º –µ–≥–æ
		if (password) {
			updateData.password = await bcrypt.hash(password, 10)
		}

		await usersService.update(Number(id), updateData)

		revalidatePath('/admin/dashboard/users')
		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }
	}
}

export async function deleteUserAction(id: number) {
	try {
		await usersService.delete(id)
		revalidatePath('/admin/dashboard/users')
		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)
		return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }
	}
}
</file>

<file path="src/server-actions/warehouses.action.ts">
'use server'

import { prisma } from '@/lib/prisma'
import { warehouseService } from '@/services/warehouses.service'
import { revalidatePath } from 'next/cache'

export async function manageWarehouseAction(formData: FormData) {
	const id = formData.get('id') as string | null
	const name = formData.get('name') as string
	const location = formData.get('location') as string

	if (!name || !location) {
		return { error: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }
	}

	try {
		if (id) {
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
			await warehouseService.update(Number(id), { name, location })
		} else {
			// –°–æ–∑–¥–∞–Ω–∏–µ
			await warehouseService.create({ name, location })
		}

		revalidatePath('/admin/dashboard/warehouses')
		return { success: true }
	} catch (error: any) {
		console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–∫–ª–∞–¥–∞:', error)
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–∫–ª–∞–¥–∞' }
	}
}

export async function deleteWarehouseAction(id: number) {
	try {
		await warehouseService.delete(id)
		revalidatePath('/admin/dashboard/warehouses')
		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–∞:', error)
		return {
			error:
				'–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω —Å–≤—è–∑–∞–Ω —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏.',
		}
	}
}

export async function addWorkerToWarehouseAction(
	warehouseId: number,
	userId: number,
) {
	try {
		await warehouseService.addWorker(warehouseId, userId)
		revalidatePath('/admin/dashboard/warehouses')
		return { success: true }
	} catch (error: any) {
		console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:', error)
		if (error.code === 'P2002') {
			return { error: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–∂–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω –∑–∞ —ç—Ç–∏–º —Å–∫–ª–∞–¥–æ–º' }
		}
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' }
	}
}

export async function removeWorkerFromWarehouseAction(
	warehouseId: number,
	userId: number,
) {
	try {
		await warehouseService.removeWorker(warehouseId, userId)
		revalidatePath('/admin/dashboard/warehouses')
		return { success: true }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:', error)
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' }
	}
}

export async function getWarehouseWorkersAction(warehouseId: number) {
	try {
		const workers = await warehouseService.getWarehouseWorkers(warehouseId)
		return { success: true, workers }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', error)
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤' }
	}
}

export async function getUsersWithWarehouseRoleAction() {
	try {
		const users = await prisma.user.findMany({
			where: {
				role: 'WAREHOUSE_WORKER',
			},
			select: {
				id: true,
				email: true,
				firstName: true,
				lastName: true,
				role: true,
			},
			orderBy: {
				email: 'asc',
			},
		})
		return { success: true, users }
	} catch (error) {
		console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error)
		return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π' }
	}
}
</file>

<file path="src/services/analytics.service.ts">
import { prisma } from '@/lib/prisma'

export const analyticsService = {
	// 1. –¢–æ–ø-5 —Å–∞–º—ã—Ö –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤
	getTopCategoriesByRevenue: async () => {
		return await prisma.$queryRaw<Array<{ name: string; revenue: string }>>`
			SELECT c.name, CAST(SUM(oi.price_at_purchase * oi.quantity) AS TEXT) as revenue
			FROM categories c
			JOIN products p ON c.id = p.category_id
			JOIN order_items oi ON p.id = oi.product_id
			GROUP BY c.id, c.name
			ORDER BY revenue DESC
			LIMIT 5
		`
	},

	// 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ—Ç—Ä–∞—Ç–∏–≤—à–∏–µ –±–æ–ª—å—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞
	getAboveAverageSpenders: async () => {
		return await prisma.$queryRaw<
			Array<{ first_name: string; email: string; total_spent: string }>
		>`
			SELECT u.first_name, u.email, CAST(u.total_spent AS TEXT) as total_spent
			FROM users u
			WHERE u.total_spent > (SELECT AVG(total_price) FROM orders)
			ORDER BY u.total_spent DESC
		`
	},

	// 3. –¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏ —Ä–∞–∑—É –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏ (–ø–æ–∏—Å–∫ –Ω–µ–ª–∏–∫–≤–∏–¥–∞)
	getUnorderedProducts: async () => {
		return await prisma.$queryRaw<Array<{ name: string }>>`
			SELECT p.name
			FROM products p
			LEFT JOIN order_items oi ON p.id = oi.product_id
			WHERE oi.id IS NULL
			ORDER BY p.name
		`
	},

	// 4. –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
	getAverageRatingByCategory: async () => {
		return await prisma.$queryRaw<
			Array<{ name: string; avg_cat_rating: string }>
		>`
			SELECT c.name, CAST(ROUND(AVG(p.average_rating), 2) AS TEXT) as avg_cat_rating
			FROM categories c
			JOIN products p ON c.id = p.category_id
			GROUP BY c.id, c.name
			ORDER BY avg_cat_rating DESC
		`
	},

	// 5. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º
	getOrdersByCity: async () => {
		return await prisma.$queryRaw<
			Array<{ delivery_city: string; order_count: string }>
		>`
			SELECT o.delivery_city, CAST(COUNT(*) AS TEXT) as order_count
			FROM orders o
			GROUP BY o.delivery_city
			ORDER BY order_count DESC
		`
	},

	// 6. –î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º
	getUserRegistrationDynamics: async () => {
		return await prisma.$queryRaw<Array<{ month: Date; new_users: string }>>`
			SELECT 
				DATE_TRUNC('month', created_at) as month, 
				CAST(COUNT(*) AS TEXT) as new_users
			FROM users
			GROUP BY DATE_TRUNC('month', created_at)
			ORDER BY month
		`
	},

	// 7. –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º (–º–µ–Ω—å—à–µ 5 —à—Ç —Å—É–º–º–∞—Ä–Ω–æ)
	getCriticallyLowStock: async () => {
		return await prisma.$queryRaw<Array<{ name: string; total_qty: string }>>`
			SELECT p.name, CAST(SUM(s.quantity) AS TEXT) as total_qty
			FROM products p
			JOIN stocks s ON p.id = s.product_id
			GROUP BY p.id, p.name
			HAVING SUM(s.quantity) < 5
			ORDER BY total_qty ASC
		`
	},

	// 8. –°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–∫–ª–∞–¥–µ
	getWarehouseValue: async () => {
		return await prisma.$queryRaw<
			Array<{ name: string; warehouse_value: string }>
		>`
			SELECT w.name, CAST(SUM(s.quantity * p.base_price) AS TEXT) as warehouse_value
			FROM warehouses w
			JOIN stocks s ON w.id = s.warehouse_id
			JOIN products p ON s.product_id = p.id
			GROUP BY w.id, w.name
			ORDER BY warehouse_value DESC
		`
	},

	// 9. –í—ã—Ä—É—á–∫–∞ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º (LAG - –æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
	getMonthlyRevenue: async () => {
		return await prisma.$queryRaw<
			Array<{ month: Date; revenue: string; prev_revenue: string | null }>
		>`
			SELECT
				DATE_TRUNC('month', created_at) as month,
				CAST(SUM(total_price) AS TEXT) as revenue,
				CAST(LAG(SUM(total_price)) OVER (ORDER BY DATE_TRUNC('month', created_at)) AS TEXT) as prev_revenue
			FROM orders
			GROUP BY DATE_TRUNC('month', created_at)
			ORDER BY month DESC
			LIMIT 12
		`
	},

	// 10. –¢–æ–ø-3 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–û–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è RANK)
	getTopProductsByCategory: async () => {
		return await prisma.$queryRaw<
			Array<{
				name: string
				price: string
				category_id: string
				category_name: string
			}>
		>`
			SELECT t.name, CAST(t.price AS TEXT), t.category_id, c.name as category_name
			FROM (
				SELECT p.name, p.base_price as price, p.category_id,
					RANK() OVER (PARTITION BY p.category_id ORDER BY p.base_price DESC) as r
				FROM products p
			) t
			JOIN categories c ON t.category_id = c.id
			WHERE t.r <= 3
			ORDER BY t.category_id, t.r
		`
	},

	// 11. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ—Å—Ç–∞–≤–∏–≤—à–∏–µ –±–æ–ª–µ–µ 3 –æ—Ç–∑—ã–≤–æ–≤
	getActiveReviewers: async () => {
		return await prisma.$queryRaw<
			Array<{ email: string; review_count: string }>
		>`
			SELECT u.email, CAST(COUNT(r.id) AS TEXT) as review_count
			FROM users u
			LEFT JOIN reviews r ON u.id = r.user_id
			GROUP BY u.id, u.email
			HAVING COUNT(r.id) > 3
			ORDER BY review_count DESC
		`
	},

	// 12. –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –≤ –∑–∞–∫–∞–∑–∞—Ö
	getPromoUsagePercent: async () => {
		return await prisma.$queryRaw<Array<{ promo_usage_percent: string }>>`
			SELECT
				CAST(ROUND(COUNT(promocode_id) * 100.0 / COUNT(*), 2) AS TEXT) as promo_usage_percent
			FROM orders
		`
	},

	// 13. –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã —É VIP-–∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ—Ç—Ä–∞—á–µ–Ω–æ > 1000)
	getVIPPaymentMethods: async () => {
		return await prisma.$queryRaw<Array<{ type: string; count: string }>>`
			SELECT pm.type, CAST(COUNT(*) AS TEXT) as count
			FROM payment_methods pm
			JOIN orders o ON pm.id = o.payment_method_id
			WHERE o.user_id IN (SELECT id FROM users WHERE total_spent > 1000)
			GROUP BY pm.type
			ORDER BY count DESC
		`
	},

	// 14. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ådashboard
	getDashboardStats: async () => {
		const [totalOrders, totalRevenue, totalUsers, totalProducts] =
			await Promise.all([
				prisma.order.count(),
				prisma.$queryRaw<Array<{ total: string }>>`
				SELECT CAST(COALESCE(SUM(total_price), 0) AS TEXT) as total FROM orders
			`,
				prisma.user.count({
					where: { role: 'USER' },
				}),
				prisma.product.count(),
			])

		return {
			totalOrders,
			totalRevenue: totalRevenue[0]?.total || '0',
			totalUsers,
			totalProducts,
		}
	},

	// 15. –ó–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –ø–æ –¥–Ω—è–º
	getOrdersTrendLastMonth: async () => {
		return await prisma.$queryRaw<Array<{ date: Date; count: string }>>`
			SELECT 
				DATE(created_at) as date,
				CAST(COUNT(*) AS TEXT) as count
			FROM orders
			WHERE created_at >= NOW() - INTERVAL '30 days'
			GROUP BY DATE(created_at)
			ORDER BY date ASC
		`
	},

	// 16. –¢–æ–≤–∞—Ä—ã —Å –ª—É—á—à–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
	getTopRatedProducts: async () => {
		return await prisma.$queryRaw<
			Array<{ name: string; average_rating: string; category_name: string }>
		>`
			SELECT 
				p.name,
				CAST(p.average_rating AS TEXT) as average_rating,
				c.name as category_name
			FROM products p
			JOIN categories c ON p.category_id = c.id
			WHERE p.average_rating > 0
			ORDER BY p.average_rating DESC
			LIMIT 10
		`
	},

	// 17. –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
	getOrderStatusDistribution: async () => {
		return await prisma.$queryRaw<Array<{ status: string; count: string }>>`
			SELECT 
				status::TEXT,
				CAST(COUNT(*) AS TEXT) as count
			FROM orders
			GROUP BY status
		`
	},

	// 18. –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∑–∞–∫–∞–∑–∞
	getAverageOrderValue: async () => {
		return await prisma.$queryRaw<Array<{ average_price: string }>>`
			SELECT CAST(ROUND(AVG(total_price)::numeric, 2) AS TEXT) as average_price
			FROM orders
		`
	},
}
</file>

<file path="src/services/categories.service.ts">
import { prisma } from '@/lib/prisma'

export const categoryService = {
	getAll: async () => {
		return await prisma.category.findMany({
			include: {
				categoryImage: true,
			},
		})
	},
	getById: async (id: number) => {
		return await prisma.category.findUnique({
			where: {
				id,
			},
		})
	},
	search: async (qwery: string) => {
		return await prisma.product.findMany({
			where: {
				name: {
					contains: qwery,
					mode: 'insensitive',
				},
			},
		})
	},
	create: async (data: {
		name: string
		description?: string
		parentCategoryId?: number
		imageUrl?: string // URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –æ—Ç UploadThing
	}) => {
		return await prisma.category.create({
			data: {
				name: data.name,
				description: data.description,
				parentCategoryId: data.parentCategoryId || null,

				// –ú–∞–≥–∏—è Prisma: —Å–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ category_images
				// —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω imageUrl
				categoryImage: data.imageUrl
					? {
							create: {
								url: data.imageUrl,
							},
						}
					: undefined,
			},
			// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ –æ—Ç–≤–µ—Ç, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –µ—ë —É–≤–∏–¥–µ—Ç—å
			include: {
				categoryImage: true,
			},
		})
	},
	delete: async (id: number) => {
		return await prisma.category.delete({
			where: {
				id,
			},
		})
	},
}
</file>

<file path="src/services/orders.service.ts">
import { prisma } from '@/lib/prisma'

export const orderService = {
	// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã (–¥–ª—è –∞–¥–º–∏–Ω–∞)
	getAll: async () => {
		return await prisma.order.findMany({
			include: {
				user: true,
				orderItems: {
					include: {
						product: {
							include: {
								images: {
									where: { isPrimary: true },
									take: 1,
								},
							},
						},
					},
				},
				promocode: true,
				paymentMethod: true,
			},
			orderBy: {
				createdAt: 'desc',
			},
		})
	},

	// –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
	getByUserId: async (userId: number) => {
		return await prisma.order.findMany({
			where: { userId },
			include: {
				orderItems: {
					include: {
						product: {
							include: {
								images: {
									where: { isPrimary: true },
									take: 1,
								},
							},
						},
					},
				},
				promocode: true,
				paymentMethod: true,
			},
			orderBy: {
				createdAt: 'desc',
			},
		})
	},

	// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
	getById: async (id: number) => {
		return await prisma.order.findUnique({
			where: { id },
			include: {
				user: {
					include: {
						addresses: true,
					},
				},
				orderItems: {
					include: {
						product: {
							include: {
								images: true,
								category: true,
							},
						},
					},
				},
				promocode: true,
				paymentMethod: true,
			},
		})
	},

	// –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
	createFromCart: async (data: {
		userId: number
		addressId?: number
		deliveryCity: string
		deliveryStreet: string
		promocodeId?: number
		paymentMethodId?: number
		items: {
			productId: number
			quantity: number
			priceAtPurchase: number
		}[]
	}) => {
		// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É
		const totalPrice = data.items.reduce(
			(sum, item) => sum + item.priceAtPurchase * item.quantity,
			0,
		)

		const order = await prisma.order.create({
			data: {
				userId: data.userId,
				totalPrice,
				status: 'PENDING',
				deliveryCity: data.deliveryCity,
				deliveryStreet: data.deliveryStreet,
				addressId: data.addressId,
				promocodeId: data.promocodeId,
				paymentMethodId: data.paymentMethodId,
				orderItems: {
					create: data.items.map(item => ({
						productId: item.productId,
						quantity: item.quantity,
						priceAtPurchase: item.priceAtPurchase,
					})),
				},
			},
			include: {
				orderItems: {
					include: {
						product: true,
					},
				},
				user: true,
			},
		})

		return order
	},

	// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
	updateStatus: async (orderId: number, status: string) => {
		return await prisma.order.update({
			where: { id: orderId },
			data: { status: status as any },
			include: {
				user: true,
				orderItems: {
					include: {
						product: true,
					},
				},
			},
		})
	},

	// –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
	cancel: async (orderId: number) => {
		const order = await prisma.order.findUnique({
			where: { id: orderId },
		})

		if (!order) {
			throw new Error('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω')
		}

		if (order.status !== 'PENDING' && order.status !== 'PROCESSING') {
			throw new Error('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ —Å —ç—Ç–∏–º —Å—Ç–∞—Ç—É—Å–æ–º')
		}

		return await prisma.order.update({
			where: { id: orderId },
			data: { status: 'CANCELED' },
		})
	},

	// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤
	getStatistics: async () => {
		const [totalOrders, ordersByStatus, totalRevenue, averageOrderValue] =
			await Promise.all([
				// –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤
				prisma.order.count(),
				// –ó–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
				prisma.order.groupBy({
					by: ['status'],
					_count: {
						id: true,
					},
				}),
				// –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
				prisma.order.aggregate({
					_sum: {
						totalPrice: true,
					},
				}),
				// –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
				prisma.order.aggregate({
					_avg: {
						totalPrice: true,
					},
				}),
			])

		return {
			totalOrders,
			ordersByStatus,
			totalRevenue: totalRevenue._sum.totalPrice || 0,
			averageOrderValue: averageOrderValue._avg.totalPrice || 0,
		}
	},

	// –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
	search: async (query: string) => {
		// –ü—ã—Ç–∞–µ–º—Å—è –ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ —á–∏—Å–ª–æ (ID –∑–∞–∫–∞–∑–∞)
		const orderId = parseInt(query, 10)

		return await prisma.order.findMany({
			where: {
				OR: [
					{
						id: !isNaN(orderId) ? orderId : undefined,
					},
					{
						user: {
							email: {
								contains: query,
								mode: 'insensitive',
							},
						},
					},
					{
						user: {
							firstName: {
								contains: query,
								mode: 'insensitive',
							},
						},
					},
					{
						user: {
							lastName: {
								contains: query,
								mode: 'insensitive',
							},
						},
					},
				],
			},
			include: {
				user: true,
				orderItems: {
					include: {
						product: true,
					},
				},
			},
		})
	},
}
</file>

<file path="src/services/prosuct.service.ts">
import { prisma } from '@/lib/prisma'

export const productService = {
	getAll: async () => {
		try {
			return await prisma.product.findMany({
				orderBy: { createdAt: 'desc' },
				include: {
					category: true,
					images: true,
					stocks: {
						include: {
							warehouse: true,
						},
					},
					 productVariants: true, // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma –∫–ª–∏–µ–Ω—Ç–∞
				},
			})
		} catch (error) {
			console.error('Error fetching products:', error)
			throw error
		}
	},
	getById: async (id: number) => {
		try {
			return await prisma.product.findUnique({
				where: { id },
				include: {
					category: true,
					images: true,
					stocks: {
						include: {
							warehouse: true,
						},
					},
					productVariants: {
						include: {
							variantAttributeValues: {
								include: {
									attributeValue: {
										include: {
											attribute: true,
										},
									},
								},
							},
						},
					},
					attributeValues: {
						include: {
							attribute: true,
						},
					},
				},
			})
		} catch (error) {
			console.error('Error fetching product:', error)
			throw error
		}
	},
	create: async (data: {
		name: string
		description?: string
		basePrice: number
		categoryId: number
		isAvailable?: boolean
		hasVariants?: boolean
		imageUrls?: string[]
		variants?: Array<{
			name: string
			additionalPrice: number
			stock: number
			price: number
		}>
		stocks?: Array<{
			warehouseId: number
			quantity: number
		}>
	}) => {
		try {
			return await prisma.product.create({
				data: {
					name: data.name,
					description: data.description,
					basePrice: data.basePrice,
					categoryId: data.categoryId,
					isAvailable: data.isAvailable ?? true,
					hasVariants: data.hasVariants ?? false,
					averageRating: 0, // –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –µ—â–µ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–∑—ã–≤–æ–≤
					images: data.imageUrls
						? {
								create: data.imageUrls.map((url, index) => ({
									url,
									isPrimary: index === 0,
								})),
							}
						: undefined,
					productVariants: data.variants
						? {
								create: data.variants.map(variant => ({
									name: variant.name,
									additionalPrice: variant.additionalPrice,
									stock: variant.stock,
									price: variant.price,
								})),
							}
						: undefined,
					stocks: data.stocks
						? {
								create: data.stocks.map(stock => ({
									warehouseId: stock.warehouseId,
									quantity: stock.quantity,
								})),
							}
						: undefined,
				},
				include: {
					category: true,
					images: true,
					stocks: {
						include: {
							warehouse: true,
						},
					},
					productVariants: true,
				},
			})
		} catch (error) {
			console.error('Error creating product:', error)
			throw error
		}
	},
	update: async (
		id: number,
		data: {
			name?: string
			description?: string
			basePrice?: number
			categoryId?: number
			isAvailable?: boolean
			hasVariants?: boolean
			imageUrls?: string[]
			variants?: Array<{
				id?: number
				name: string
				additionalPrice: number
				stock: number
				price: number
			}>
			stocks?: Array<{
				warehouseId: number
				quantity: number
			}>
		},
	) => {
		try {
			// –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ
			if (data.imageUrls !== undefined) {
				await prisma.productImage.deleteMany({
					where: { productId: id },
				})
			}

			// –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã, —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ
			if (data.variants !== undefined) {
				await prisma.productVariant.deleteMany({
					where: { productId: id },
				})
			}

			// –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –æ—Å—Ç–∞—Ç–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö —á–µ—Ä–µ–∑ upsert
			if (data.stocks !== undefined) {
				// –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ—Å—Ç–∞—Ç–∫–∏
				await prisma.stock.deleteMany({
					where: { productId: id },
				})
			}

			return await prisma.product.update({
				where: { id },
				data: {
					name: data.name,
					description: data.description,
					basePrice: data.basePrice,
					categoryId: data.categoryId,
					isAvailable: data.isAvailable,
					hasVariants: data.hasVariants,
					images:
						data.imageUrls && data.imageUrls.length > 0
							? {
									create: data.imageUrls.map((url, index) => ({
										url,
										isPrimary: index === 0,
									})),
								}
							: undefined,
					productVariants:
						data.variants && data.variants.length > 0
							? {
									create: data.variants.map(variant => ({
										name: variant.name,
										additionalPrice: variant.additionalPrice,
										stock: variant.stock,
										price: variant.price,
									})),
								}
							: undefined,
					stocks:
						data.stocks && data.stocks.length > 0
							? {
									create: data.stocks.map(stock => ({
										warehouseId: stock.warehouseId,
										quantity: stock.quantity,
									})),
								}
							: undefined,
				},
				include: {
					category: true,
					images: true,
					stocks: {
						include: {
							warehouse: true,
						},
					},
					productVariants: true,
				},
			})
		} catch (error) {
			console.error('Error updating product:', error)
			throw error
		}
	},
	delete: async (id: number) => {
		try {
			return await prisma.product.delete({
				where: { id },
			})
		} catch (error) {
			console.error('Error deleting product:', error)
			throw error
		}
	},
}
</file>

<file path="src/services/users.service.ts">
import { Role } from '@/generated/prisma/client'
import { prisma } from '@/lib/prisma'

export const usersService = {
	getAll: async () => {
		return await prisma.user.findMany({
			select: {
				id: true,
				email: true,
				firstName: true,
				lastName: true,
				role: true,
				avatarUrl: true,
				createdAt: true,
				updatedAt: true,
			},
			orderBy: { createdAt: 'desc' },
		})
	},
	getById: async (id: number) => {
		return await prisma.user.findUnique({
			where: { id },
			select: {
				id: true,
				email: true,
				firstName: true,
				lastName: true,
				role: true,
				avatarUrl: true,
				createdAt: true,
				updatedAt: true,
			},
		})
	},
	create: async (data: {
		email: string
		password: string
		firstName?: string
		lastName?: string
		role: Role
		avatarUrl?: string
	}) => {
		return await prisma.user.create({
			data: {
				email: data.email,
				password: data.password, // –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º
				firstName: data.firstName,
				lastName: data.lastName,
				role: data.role,
				avatarUrl: data.avatarUrl,
			},
			select: {
				id: true,
				email: true,
				firstName: true,
				lastName: true,
				role: true,
				avatarUrl: true,
			},
		})
	},
	update: async (
		id: number,
		data: {
			email?: string
			firstName?: string
			lastName?: string
			role?: Role
			avatarUrl?: string
			password?: string // —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
		},
	) => {
		return await prisma.user.update({
			where: { id },
			data,
			select: {
				id: true,
				email: true,
				firstName: true,
				lastName: true,
				role: true,
				avatarUrl: true,
			},
		})
	},
	delete: async (id: number) => {
		return await prisma.user.delete({
			where: { id },
		})
	},
}
</file>

<file path="src/services/warehouses.service.ts">
import { prisma } from '@/lib/prisma'

export const warehouseService = {
	getAll: async () => {
		try {
			return await prisma.warehouse.findMany({
				orderBy: { name: 'asc' },
				include: {
					workers: {
						include: {
							user: true,
						},
					},
					stocks: true,
				},
			})
		} catch (error) {
			console.error('Error fetching warehouses:', error)
			throw error
		}
	},
	getById: async (id: number) => {
		try {
			return await prisma.warehouse.findUnique({
				where: { id },
				include: {
					stocks: {
						include: {
							product: true,
						},
					},
					workers: {
						include: {
							user: true,
						},
					},
				},
			})
		} catch (error) {
			console.error('Error fetching warehouse:', error)
			throw error
		}
	},
	create: async (data: { name: string; location: string }) => {
		try {
			return await prisma.warehouse.create({
				data: {
					name: data.name,
					location: data.location,
				},
			})
		} catch (error) {
			console.error('Error creating warehouse:', error)
			throw error
		}
	},
	update: async (id: number, data: { name?: string; location?: string }) => {
		try {
			return await prisma.warehouse.update({
				where: { id },
				data,
			})
		} catch (error) {
			console.error('Error updating warehouse:', error)
			throw error
		}
	},
	delete: async (id: number) => {
		try {
			return await prisma.warehouse.delete({
				where: { id },
			})
		} catch (error) {
			console.error('Error deleting warehouse:', error)
			throw error
		}
	},
	addWorker: async (warehouseId: number, userId: number) => {
		try {
			return await prisma.warehouseWorker.create({
				data: {
					warehouseId,
					userId,
				},
				include: {
					user: true,
					warehouse: true,
				},
			})
		} catch (error) {
			console.error('Error adding worker to warehouse:', error)
			throw error
		}
	},
	removeWorker: async (warehouseId: number, userId: number) => {
		try {
			return await prisma.warehouseWorker.delete({
				where: {
					userId_warehouseId: {
						userId,
						warehouseId,
					},
				},
			})
		} catch (error) {
			console.error('Error removing worker from warehouse:', error)
			throw error
		}
	},
	getWarehouseWorkers: async (warehouseId: number) => {
		try {
			return await prisma.warehouseWorker.findMany({
				where: { warehouseId },
				include: {
					user: true,
				},
			})
		} catch (error) {
			console.error('Error fetching warehouse workers:', error)
			throw error
		}
	},
}
</file>

<file path="src/utils/uploadthing.ts">
import {
	generateUploadButton,
	generateUploadDropzone,
} from '@uploadthing/react'

// –í–∞–∂–Ω–æ: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¢–ò–ü –Ω–∞—à–µ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞, –∞ –Ω–µ —Å–∞–º—É –ª–æ–≥–∏–∫—É
import type { OurFileRouter } from '@/app/api/uploadthing/core'

export const UploadButton = generateUploadButton<OurFileRouter>()
export const UploadDropzone = generateUploadDropzone<OurFileRouter>()
</file>

<file path="tsconfig.json">
{
	"compilerOptions": {
		"target": "ES2017",
		"lib": ["dom", "dom.iterable", "esnext"],
		"allowJs": true,
		"skipLibCheck": true,
		"strict": true,
		"noEmit": true,
		"esModuleInterop": true,
		"module": "esnext",
		"moduleResolution": "bundler",
		"resolveJsonModule": true,
		"isolatedModules": true,
		"jsx": "react-jsx",
		"incremental": true,
		"plugins": [
			{
				"name": "next"
			}
		],
		"paths": {
			"@/*": ["./src/*"]
		}
	},
	"include": [
		"next-env.d.ts",
		"**/*.ts",
		"**/*.tsx",
		".next/types/**/*.ts",
		".next/dev/types/**/*.ts",
		"**/*.mts"
	],
	"exclude": ["node_modules"],

	"module": "ESNext",
	"moduleResolution": "bundler",
	"target": "ES2023",
	"strict": true,
	"esModuleInterop": true,
	"ignoreDeprecations": "6.0"
}
</file>

</files>
