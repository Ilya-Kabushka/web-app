# Инструкция по применению изменений для страницы складов

## Что было сделано:

1. ✅ Добавлена связь many-to-many между User и Warehouse через промежуточную таблицу WarehouseWorker
2. ✅ Расширен сервис warehouses.service.ts для работы с пользователями
3. ✅ Созданы server actions для управления складами и закрепления пользователей
4. ✅ Созданы компоненты для управления складами:
   - AddWarehouseButton - создание/редактирование складов
   - DeleteWarehouseButton - удаление складов
   - ManageWarehouseWorkersButton - управление сотрудниками склада
5. ✅ Создана страница складов `/admin/dashboard/warehouses`
6. ✅ Улучшена страница товаров - добавлена колонка "Склады" с информацией о складах, где есть товар

## Что нужно сделать:

### 1. Применить миграцию базы данных

Выполните команду для применения миграции:

```bash
npx prisma migrate deploy
```

Или если вы используете dev режим:

```bash
npx prisma migrate dev
```

Это создаст таблицу `warehouse_workers` в базе данных.

### 2. Перегенерировать Prisma клиент

После применения миграции перегенерируйте Prisma клиент:

```bash
npx prisma generate
```

### 3. Проверить работу

1. Откройте страницу складов: `/admin/dashboard/warehouses`
2. Создайте новый склад
3. Добавьте сотрудников с ролью `WAREHOUSE_WORKER` к складу
4. Проверьте страницу товаров - должна появиться колонка "Склады"

## Особенности реализации:

- Пользователи с ролью `WAREHOUSE_WORKER` могут быть закреплены за несколькими складами
- На каждом складе может работать несколько сотрудников
- При удалении склада все связи с сотрудниками удаляются автоматически (CASCADE)
- При удалении пользователя все его связи со складами удаляются автоматически (CASCADE)
- На странице товаров отображается количество складов, где есть товар, и их названия

## Структура базы данных:

```
User (1) ──< WarehouseWorker >── (1) Warehouse
```

- Один пользователь может быть закреплен за несколькими складами
- Один склад может иметь несколько сотрудников
- Связь реализована через промежуточную таблицу `warehouse_workers`

## Файлы, которые были созданы/изменены:

### Новые файлы:
- `src/app/admin/dashboard/warehouses/page.tsx` - страница складов
- `src/components/AddWarehouseButton.tsx` - компонент создания/редактирования складов
- `src/components/DeleteWarehouseButton.tsx` - компонент удаления складов
- `src/components/ManageWarehouseWorkersButton.tsx` - компонент управления сотрудниками
- `src/server-actions/warehouses.action.ts` - server actions для складов
- `prisma/migrations/20250201000000_add_warehouse_workers/migration.sql` - миграция БД

### Измененные файлы:
- `prisma/schema.prisma` - добавлена модель WarehouseWorker и связи
- `src/services/warehouses.service.ts` - расширен функционал работы с пользователями
- `src/app/admin/dashboard/products/page.tsx` - добавлена колонка "Склады"

