# üì¶ –°–∏—Å—Ç–µ–º–∞ –ó–∞–∫–∞–∑–æ–≤

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –∫–æ—Ä–∑–∏–Ω–æ–π –ø–æ–∫—É–ø–æ–∫.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤**

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ä–æ–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏—è
- –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤**

- **PENDING** (–û–∂–∏–¥–∞–Ω–∏–µ)
- **PROCESSING** (–í –æ–±—Ä–∞–±–æ—Ç–∫–µ)
- **SHIPPED** (–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **DELIVERED** (–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
- **CANCELED** (–û—Ç–º–µ–Ω–µ–Ω–æ)

–°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å.

### 3. **–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤, –≤—ã—Ä—É—á–∫–∞, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

### 4. **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ (—Ç–æ–≤–∞—Ä—ã, –∞–¥—Ä–µ—Å, —Å—É–º–º–∞)
- –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤ (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å PENDING –∏–ª–∏ PROCESSING)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ orders.service.ts           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
‚îú‚îÄ‚îÄ server-actions/
‚îÇ   ‚îî‚îÄ‚îÄ orders.action.ts             # Server Actions –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∑–∞–∫–∞–∑–∞–º–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ UpdateOrderStatusButton.tsx   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ CancelOrderButton.tsx         # –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îî‚îÄ‚îÄ CreateOrderButton.tsx         # –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ date-utils.ts                # –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ admin/dashboard/orders/
    ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–∞–¥–º–∏–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ [id]/page.tsx            # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–∞–¥–º–∏–Ω)
    ‚îî‚îÄ‚îÄ orders/
        ‚îú‚îÄ‚îÄ page.tsx                 # –ú–æ–∏ –∑–∞–∫–∞–∑—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        ‚îî‚îÄ‚îÄ [id]/page.tsx            # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```typescript
import { createOrderAction } from '@/server-actions/orders.action'

// –í Client Component
const result = await createOrderAction(
	userId,
	addressId,
	paymentMethodId,
	promocodeCode,
)

if (result.success) {
	// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–∞
	window.location.href = `/orders/${result.orderId}`
}
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

```typescript
import { UpdateOrderStatusButton } from '@/components/UpdateOrderStatusButton'

<UpdateOrderStatusButton
  orderId={order.id}
  currentStatus={order.status}
/>
```

### 3. –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

```typescript
import { CancelOrderButton } from '@/components/CancelOrderButton'

<CancelOrderButton
  orderId={order.id}
  canCancel={order.status === 'PENDING'}
/>
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

```typescript
import { orderService } from '@/services/orders.service'

// –í—Å–µ –∑–∞–∫–∞–∑—ã (–∞–¥–º–∏–Ω)
const orders = await orderService.getAll()

// –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userOrders = await orderService.getByUserId(userId)

// –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
const order = await orderService.getById(orderId)
```

## üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ë–î —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏:

### –§—É–Ω–∫—Ü–∏–∏:

- `get_cart_total()` - –†–∞—Å—á–µ—Ç —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
- `get_full_address()` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- `is_user_vip()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ VIP —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_promo_active()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `get_total_stock()` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
- `format_price()` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
- `estimate_delivery_days()` - –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### –ü—Ä–æ—Ü–µ–¥—É—Ä—ã:

- `create_order_from_cart()` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- `cancel_stale_orders()` - –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

### –¢—Ä–∏–≥–≥–µ—Ä—ã:

- `trg_check_promo` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞
- `trg_recalc_order` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `trg_user_spending` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ
- `trg_stock_availability` - –°–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤ –Ω–∞–ª–∏—á–∏–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –≤–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ (GDPR)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ total_spent –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ
- ‚úÖ –ó–∞–ø—Ä–µ—Ç –Ω–∞ –æ—Ç–º–µ–Ω—É –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö/–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:

1. –ë–µ—Ä—É—Ç—Å—è —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞—é—Ç—Å—è orderItems —Å —Ç–µ–∫—É—â–∏–º–∏ —Ü–µ–Ω–∞–º–∏
3. –ö–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è
4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `revalidatePath`

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **–¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤** - —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- **–ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤** - –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è** - —Å –≤—ã–±–æ—Ä–æ–º –∞–¥—Ä–µ—Å–∞ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä** - —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

- –î–∞—Ç–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä—É—Å—Å–∫—É—é –ª–æ–∫–∞–ª—å
- –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –∏ –≤–∞–ª—é—Ç—ã (BYN)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `basePrice` —Ç–æ–≤–∞—Ä–∞ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ –≤ –±—É–¥—É—â–µ–º, —Ü–µ–Ω—ã –≤ —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–∞–∑–∞—Ö –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏
- `address_id` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤ `delivery_city` –∏ `delivery_street`
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ userId)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `order.service.ts` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

- –£—Å–ª–æ–≤–∏—è –¥–ª—è VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–∫—É—â–∏–π –ø–æ—Ä–æ–≥: 1000 BYN)
- –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `estimate_delivery_days`
- –ü–µ—Ä–∏–æ–¥ –æ—Ç–º–µ–Ω—ã –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (—Ç–µ–∫—É—â–∏–π: 3 –¥–Ω—è)
